!function(r,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):r.yim=t()}(this,function(){var g="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{};function r(r,t){return r(t={exports:{}},t.exports),t.exports}var t,f=r(function(r,t){r.exports=function(){var i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,t){r.__proto__=t}||function(r,t){for(var n in t)t.hasOwnProperty(n)&&(r[n]=t[n])};function e(r,t){function n(){this.constructor=r}i(r,t),r.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}var t=r;function r(){}r.mixin=function(r){var t=r.prototype||r;t.isWildEmitter=!0,t.on=function(r,t,n){this.callbacks=this.callbacks||{};var i=3===arguments.length,e=i?t:void 0,o=i?n:t;return o.t=e,(this.callbacks[r]=this.callbacks[r]||[]).push(o),this},t.once=function(t,r,n){var i=this,e=3===arguments.length,o=e?r:void 0,s=e?n:r;return this.on(t,o,function r(){i.off(t,r),s.apply(this,arguments)}),this},t.releaseGroup=function(r){var t,n,i,e;for(t in this.callbacks=this.callbacks||{},this.callbacks)for(n=0,i=(e=this.callbacks[t]).length;n<i;n++)e[n].t===r&&(e.splice(n,1),n--,i--);return this},t.off=function(r,t){this.callbacks=this.callbacks||{};var n,i=this.callbacks[r];return i&&(1===arguments.length?delete this.callbacks[r]:(n=i.indexOf(t),i.splice(n,1),0===i.length&&delete this.callbacks[r])),this},t.emit=function(r){this.callbacks=this.callbacks||{};var t,n,i,e=[].slice.call(arguments,1),o=this.callbacks[r],s=this.getWildcardCallbacks(r);if(o)for(t=0,n=(i=o.slice()).length;t<n&&i[t];++t)i[t].apply(this,e);if(s)for(n=s.length,t=0,n=(i=s.slice()).length;t<n&&i[t];++t)i[t].apply(this,[r].concat(e));return this},t.getWildcardCallbacks=function(r){this.callbacks=this.callbacks||{};var t,n,i=[];for(t in this.callbacks)n=t.split("*"),("*"===t||2===n.length&&r.slice(0,n[0].length)===n[0])&&(i=i.concat(this.callbacks[t]));return i}},r.mixin(r);var n,m,o=function(t){function r(){var r=t.call(this)||this;return r.i={appKey:"",userId:"",token:""},r}return e(r,t),r.prototype.set=function(r,t){this.i[r]=t,this.emit("change:"+r,r,t)},r.prototype.get=function(r){return this.i[r]},r}(t),s=function(i){function r(r,t){var n=i.call(this)||this;return n.n=r,n.r=t,n.e=!1,n.s=!1,n.o="",n.u="",n.h="",n.f=6,n.r.on("message:7",function(){n.r.close(),n.s=!1,n.emit("kickoff")}),n}return e(r,i),r.prototype.login=function(r,t,n){var i=this;return this.s?t!==this.u?(this.logout(),new Promise(function(r){setTimeout(function(){return r()},100)}).then(function(){return i.login(r,t,n)})):Promise.resolve():(this.e=!0,this.n.set("appKey",r),this.n.set("userId",t),this.n.set("token",n),this.o=r,this.u=t,this.h=n,this.emit("logging"),this.r.send(1,{appkey:r,userid:t+"",session:n+"",notify:1,base:{os_type:this.f,ip:"",port:0}}).then(function(){i.e=!1,i.s=!0,i.emit("login")}).catch(function(r){throw i.e=!1,i.s=!1,i.r.close(),i.emit("error:"+r.name,r),r}))},r.prototype.logout=function(){this.r.close(),this.s=!1,this.emit("logout")},r.prototype.isLogging=function(){return this.e},r.prototype.isLogged=function(){return this.s},r.prototype.doIfLogged=function(){var e=this;return new Promise(function(r,t){if(e.s)r();else{var n=setTimeout(function(){e.off("login",i);var r=new Error;r.name="NotLoginError",t(r)},1e4),i=function(){r(),clearTimeout(n)};e.once("login",i)}})},r.prototype.getMyUserId=function(){return this.u},r.prototype.reconnect=function(){return this.s=!1,this.login(this.o,this.u,this.h)},r}(t),a=function(i){function r(r,t){var n=i.call(this)||this;return n.n=r,n.r=t,n.c={},n.r.on("status:ended",function(){return n.clear()}),n}return e(r,i),r.prototype.joinRoom=function(t){var n=this;return t+="",this.c[t]||(this.c[t]=[this.n.get("userId")]),this.emit("joining:"+t,t),this.r.send(3,{roomid:t}).then(function(r){return n.emit("join:"+t,t),t}).catch(function(r){throw n.emit("join-error:"+r.name,r,t),delete n.c[t],r})},r.prototype.leaveRoom=function(t){var n=this;return t+="",this.r.send(4,{roomid:t}).then(function(){delete n.c[t],n.emit("leave:"+t,t)}).catch(function(r){throw n.emit("leave-error:"+r.name,r,t),r})},r.prototype.leaveAllRoom=function(){for(var r=[],t=0,n=Object.keys(this.c);t<n.length;t++){var i=n[t];r.push(this.leaveRoom(i))}return Promise.all(r).then(function(){})},r.prototype.clear=function(){for(var r=0,t=Object.keys(this.c);r<t.length;r++){var n=t[r];this.emit("leave:"+n,n)}this.c={}},r.prototype.doIfJoinedRoom=function(t){var n=this;return new Promise(function(r){t+="",n.inRoom(t)?r():n.once("join:"+t,function(){return r()})})},r.prototype.inRoom=function(r){return r+="",!!this.c[r]},r.prototype.getRoomIdList=function(){return Object.keys(this.c)},r.prototype.reconnect=function(){for(var t=this,r=function(r){n.r.send(4,{roomid:r}).then(function(){return t.r.send(3,{roomid:r})})},n=this,i=0,e=this.getRoomIdList();i<e.length;i++)r(e[i])},r}(t),f="disconnected",h="connected",u="reconnecting",c="ended",v={0:"OK",20001:"NotLoginError",20002:"InvalidParamError",20003:"InvalidLoginError",20004:"UsernameOrTokenError",20005:"LoginTimeoutError",20006:"ServiceOverloadError",20007:"MessageTooLongError"},l=function(n){function r(r){var t=n.call(this)||this;return t.n=r,t.a=1,t.f=6,t.v=null,t.l="wss://webrtctest.youme.im",t.d=f,t.w=[],t.g={},t.m={},t.y={},t.p=!1,t.b=[],t.A=[],t.j=1530625445318,t.T=0,t}return e(r,n),r.prototype.init=function(r){return r||(t=this.n.get("appKey"),r=t?"wss://"+t.substr(t.length-8).toLowerCase()+".h5.youme.im:443":""),r&&(this.l=r,this.P(),this.k("connecting")),this;var t},r.prototype.send=function(n,r){var i=this;if(this.d!==f&&this.d!==c||(this.init(),this.d!==f&&this.d!==c))return this.j++,r.base=r.base||{},r.base=Object.assign(r.base,{msgtype:n,seq:this.j+"",version:this.a,os_type:this.f}),this.w.push(r),this.I(),this.T&&clearTimeout(this.T),this.T=setTimeout(function(){return i.O()},6e4),new Promise(function(r,t){i.g[i.j]=r,i.m[i.j]=t,i.y[n]=i.j});var t=new Error;return t.name="NotLoginError",Promise.reject(t)},r.prototype.getStatus=function(){return this.d},r.prototype.close=function(){this.k(c),this.v&&(this.v.close(),this.v=null),this.w=[],this.g={},this.j=0,this.T&&(clearTimeout(this.T),this.T=0)},r.prototype.checkNetwork=function(){var n=this;return new Promise(function(r,t){n.b.push(r),n.A.push(t),n.p||n.O()})},r.prototype.P=function(){this.v&&this.v.close(),this.v=new WebSocket(this.l),this.B()},r.prototype.C=function(){var r=this;if(this.d!==c){if(this.d!==u){for(var t in this.m)this.m.hasOwnProperty(t)&&this.m[t](new DOMException("Socket was closed.","NetworkError"));this.g={},this.m={},this.k(u)}this.v=null,setTimeout(function(){r.d===u&&r.P()},1e3)}this.T&&(clearTimeout(this.T),this.T=0)},r.prototype.B=function(){var a=this;this.v&&(this.v.addEventListener("open",function(){a.k(h),a.emit("ready"),a.I()}),this.v.addEventListener("error",function(r){a.emit("error",r)}),this.v.addEventListener("close",function(){a.C()}),this.v.addEventListener("message",function(r){var t=JSON.parse(r.data),n=t.ret,i=t.base,e=i.msgtype,o=i.seq;if(o||(o=a.y[e]),o&&a.g[o]){if(n&&"0"!==n){var s=new Error;s.name=v[n]||"Error-"+n,a.m[o](s)}else a.g[o](t);delete a.g[o],delete a.m[o]}a.emit("message:"+e,t)}))},r.prototype.k=function(r){this.d!==r&&(this.d=r,this.emit("status:"+r,r))},r.prototype.I=function(){if(this.d===h&&this.v){for(var r=0,t=this.w;r<t.length;r++){var n=t[r];this.v.send(JSON.stringify(n));var i=n.base;this.emit("send:"+i.msgtype,n)}this.w=[]}},r.prototype.O=function(){var r=this;if(!this.p){this.p=!0;var t=setTimeout(function(){r.U(!1),r.v&&r.v.close(),r.C()},1e4);this.send(0,{}).then(function(){clearTimeout(t),r.U(!0)}).catch(function(){clearTimeout(t),r.U(!1)})}},r.prototype.U=function(r){if(r)for(var t=0,n=this.b;t<n.length;t++){var i=n[t];i&&i()}else for(var e=0,o=this.A;e<o.length;e++){var s=o[e];s&&s()}this.b=[],this.A=[],this.p=!1},r}(t),_="undefined"!=typeof window?window:void 0!==g?g:"undefined"!=typeof self?self:{},d=(m=n={exports:{}},function(){var h="input is invalid type",r="object"==typeof window,t=r?window:{};t.JS_MD5_NO_WINDOW&&(r=!1);var n=!r&&"object"==typeof self,s=!t.JS_MD5_NO_NODE_JS&&"object"==typeof process&&process.versions&&process.versions.node;s?t=_:n&&(t=self);var i,e=!t.JS_MD5_NO_COMMON_JS&&m.exports,u=!t.JS_MD5_NO_ARRAY_BUFFER&&"undefined"!=typeof ArrayBuffer,o="0123456789abcdef".split(""),a=[128,32768,8388608,-2147483648],c=[0,8,16,24],f=["hex","array","digest","buffer","arrayBuffer","base64"],v="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".split(""),l=[];if(u){var d=new ArrayBuffer(68);i=new Uint8Array(d),l=new Uint32Array(d)}!t.JS_MD5_NO_NODE_JS&&Array.isArray||(Array.isArray=function(r){return"[object Array]"===Object.prototype.toString.call(r)}),!u||!t.JS_MD5_NO_ARRAY_BUFFER_IS_VIEW&&ArrayBuffer.isView||(ArrayBuffer.isView=function(r){return"object"==typeof r&&r.buffer&&r.buffer.constructor===ArrayBuffer});var w=function(t){return function(r){return new M(!0).update(r)[t]()}};function M(r){if(r)l[0]=l[16]=l[1]=l[2]=l[3]=l[4]=l[5]=l[6]=l[7]=l[8]=l[9]=l[10]=l[11]=l[12]=l[13]=l[14]=l[15]=0,this.blocks=l,this.buffer8=i;else if(u){var t=new ArrayBuffer(68);this.buffer8=new Uint8Array(t),this.blocks=new Uint32Array(t)}else this.blocks=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];this.h0=this.h1=this.h2=this.h3=this.start=this.bytes=this.hBytes=0,this.finalized=this.hashed=!1,this.first=!0}M.prototype.update=function(r){if(!this.finalized){var t,n=typeof r;if("string"!==n){if("object"!==n)throw h;if(null===r)throw h;if(u&&r.constructor===ArrayBuffer)r=new Uint8Array(r);else if(!(Array.isArray(r)||u&&ArrayBuffer.isView(r)))throw h;t=!0}for(var i,e,o=0,s=r.length,a=this.blocks,f=this.buffer8;o<s;){if(this.hashed&&(this.hashed=!1,a[0]=a[16],a[16]=a[1]=a[2]=a[3]=a[4]=a[5]=a[6]=a[7]=a[8]=a[9]=a[10]=a[11]=a[12]=a[13]=a[14]=a[15]=0),t)if(u)for(e=this.start;o<s&&e<64;++o)f[e++]=r[o];else for(e=this.start;o<s&&e<64;++o)a[e>>2]|=r[o]<<c[3&e++];else if(u)for(e=this.start;o<s&&e<64;++o)(i=r.charCodeAt(o))<128?f[e++]=i:(i<2048?f[e++]=192|i>>6:(i<55296||57344<=i?f[e++]=224|i>>12:(i=65536+((1023&i)<<10|1023&r.charCodeAt(++o)),f[e++]=240|i>>18,f[e++]=128|i>>12&63),f[e++]=128|i>>6&63),f[e++]=128|63&i);else for(e=this.start;o<s&&e<64;++o)(i=r.charCodeAt(o))<128?a[e>>2]|=i<<c[3&e++]:(i<2048?a[e>>2]|=(192|i>>6)<<c[3&e++]:(i<55296||57344<=i?a[e>>2]|=(224|i>>12)<<c[3&e++]:(i=65536+((1023&i)<<10|1023&r.charCodeAt(++o)),a[e>>2]|=(240|i>>18)<<c[3&e++],a[e>>2]|=(128|i>>12&63)<<c[3&e++]),a[e>>2]|=(128|i>>6&63)<<c[3&e++]),a[e>>2]|=(128|63&i)<<c[3&e++]);this.lastByteIndex=e,this.bytes+=e-this.start,64<=e?(this.start=e-64,this.hash(),this.hashed=!0):this.start=e}return 4294967295<this.bytes&&(this.hBytes+=this.bytes/4294967296<<0,this.bytes=this.bytes%4294967296),this}},M.prototype.finalize=function(){if(!this.finalized){this.finalized=!0;var r=this.blocks,t=this.lastByteIndex;r[t>>2]|=a[3&t],56<=t&&(this.hashed||this.hash(),r[0]=r[16],r[16]=r[1]=r[2]=r[3]=r[4]=r[5]=r[6]=r[7]=r[8]=r[9]=r[10]=r[11]=r[12]=r[13]=r[14]=r[15]=0),r[14]=this.bytes<<3,r[15]=this.hBytes<<3|this.bytes>>>29,this.hash()}},M.prototype.hash=function(){var r,t,n,i,e,o,s=this.blocks;this.first?t=((t=((r=((r=s[0]-680876937)<<7|r>>>25)-271733879<<0)^(n=((n=(-271733879^(i=((i=(-1732584194^2004318071&r)+s[1]-117830708)<<12|i>>>20)+r<<0)&(-271733879^r))+s[2]-1126478375)<<17|n>>>15)+i<<0)&(i^r))+s[3]-1316259209)<<22|t>>>10)+n<<0:(r=this.h0,t=this.h1,n=this.h2,t=((t+=((r=((r+=((i=this.h3)^t&(n^i))+s[0]-680876936)<<7|r>>>25)+t<<0)^(n=((n+=(t^(i=((i+=(n^r&(t^n))+s[1]-389564586)<<12|i>>>20)+r<<0)&(r^t))+s[2]+606105819)<<17|n>>>15)+i<<0)&(i^r))+s[3]-1044525330)<<22|t>>>10)+n<<0),t=((t+=((r=((r+=(i^t&(n^i))+s[4]-176418897)<<7|r>>>25)+t<<0)^(n=((n+=(t^(i=((i+=(n^r&(t^n))+s[5]+1200080426)<<12|i>>>20)+r<<0)&(r^t))+s[6]-1473231341)<<17|n>>>15)+i<<0)&(i^r))+s[7]-45705983)<<22|t>>>10)+n<<0,t=((t+=((r=((r+=(i^t&(n^i))+s[8]+1770035416)<<7|r>>>25)+t<<0)^(n=((n+=(t^(i=((i+=(n^r&(t^n))+s[9]-1958414417)<<12|i>>>20)+r<<0)&(r^t))+s[10]-42063)<<17|n>>>15)+i<<0)&(i^r))+s[11]-1990404162)<<22|t>>>10)+n<<0,t=((t+=((r=((r+=(i^t&(n^i))+s[12]+1804603682)<<7|r>>>25)+t<<0)^(n=((n+=(t^(i=((i+=(n^r&(t^n))+s[13]-40341101)<<12|i>>>20)+r<<0)&(r^t))+s[14]-1502002290)<<17|n>>>15)+i<<0)&(i^r))+s[15]+1236535329)<<22|t>>>10)+n<<0,t=((t+=((i=((i+=(t^n&((r=((r+=(n^i&(t^n))+s[1]-165796510)<<5|r>>>27)+t<<0)^t))+s[6]-1069501632)<<9|i>>>23)+r<<0)^r&((n=((n+=(r^t&(i^r))+s[11]+643717713)<<14|n>>>18)+i<<0)^i))+s[0]-373897302)<<20|t>>>12)+n<<0,t=((t+=((i=((i+=(t^n&((r=((r+=(n^i&(t^n))+s[5]-701558691)<<5|r>>>27)+t<<0)^t))+s[10]+38016083)<<9|i>>>23)+r<<0)^r&((n=((n+=(r^t&(i^r))+s[15]-660478335)<<14|n>>>18)+i<<0)^i))+s[4]-405537848)<<20|t>>>12)+n<<0,t=((t+=((i=((i+=(t^n&((r=((r+=(n^i&(t^n))+s[9]+568446438)<<5|r>>>27)+t<<0)^t))+s[14]-1019803690)<<9|i>>>23)+r<<0)^r&((n=((n+=(r^t&(i^r))+s[3]-187363961)<<14|n>>>18)+i<<0)^i))+s[8]+1163531501)<<20|t>>>12)+n<<0,t=((t+=((i=((i+=(t^n&((r=((r+=(n^i&(t^n))+s[13]-1444681467)<<5|r>>>27)+t<<0)^t))+s[2]-51403784)<<9|i>>>23)+r<<0)^r&((n=((n+=(r^t&(i^r))+s[7]+1735328473)<<14|n>>>18)+i<<0)^i))+s[12]-1926607734)<<20|t>>>12)+n<<0,t=((t+=((o=(i=((i+=((e=t^n)^(r=((r+=(e^i)+s[5]-378558)<<4|r>>>28)+t<<0))+s[8]-2022574463)<<11|i>>>21)+r<<0)^r)^(n=((n+=(o^t)+s[11]+1839030562)<<16|n>>>16)+i<<0))+s[14]-35309556)<<23|t>>>9)+n<<0,t=((t+=((o=(i=((i+=((e=t^n)^(r=((r+=(e^i)+s[1]-1530992060)<<4|r>>>28)+t<<0))+s[4]+1272893353)<<11|i>>>21)+r<<0)^r)^(n=((n+=(o^t)+s[7]-155497632)<<16|n>>>16)+i<<0))+s[10]-1094730640)<<23|t>>>9)+n<<0,t=((t+=((o=(i=((i+=((e=t^n)^(r=((r+=(e^i)+s[13]+681279174)<<4|r>>>28)+t<<0))+s[0]-358537222)<<11|i>>>21)+r<<0)^r)^(n=((n+=(o^t)+s[3]-722521979)<<16|n>>>16)+i<<0))+s[6]+76029189)<<23|t>>>9)+n<<0,t=((t+=((o=(i=((i+=((e=t^n)^(r=((r+=(e^i)+s[9]-640364487)<<4|r>>>28)+t<<0))+s[12]-421815835)<<11|i>>>21)+r<<0)^r)^(n=((n+=(o^t)+s[15]+530742520)<<16|n>>>16)+i<<0))+s[2]-995338651)<<23|t>>>9)+n<<0,t=((t+=((i=((i+=(t^((r=((r+=(n^(t|~i))+s[0]-198630844)<<6|r>>>26)+t<<0)|~n))+s[7]+1126891415)<<10|i>>>22)+r<<0)^((n=((n+=(r^(i|~t))+s[14]-1416354905)<<15|n>>>17)+i<<0)|~r))+s[5]-57434055)<<21|t>>>11)+n<<0,t=((t+=((i=((i+=(t^((r=((r+=(n^(t|~i))+s[12]+1700485571)<<6|r>>>26)+t<<0)|~n))+s[3]-1894986606)<<10|i>>>22)+r<<0)^((n=((n+=(r^(i|~t))+s[10]-1051523)<<15|n>>>17)+i<<0)|~r))+s[1]-2054922799)<<21|t>>>11)+n<<0,t=((t+=((i=((i+=(t^((r=((r+=(n^(t|~i))+s[8]+1873313359)<<6|r>>>26)+t<<0)|~n))+s[15]-30611744)<<10|i>>>22)+r<<0)^((n=((n+=(r^(i|~t))+s[6]-1560198380)<<15|n>>>17)+i<<0)|~r))+s[13]+1309151649)<<21|t>>>11)+n<<0,t=((t+=((i=((i+=(t^((r=((r+=(n^(t|~i))+s[4]-145523070)<<6|r>>>26)+t<<0)|~n))+s[11]-1120210379)<<10|i>>>22)+r<<0)^((n=((n+=(r^(i|~t))+s[2]+718787259)<<15|n>>>17)+i<<0)|~r))+s[9]-343485551)<<21|t>>>11)+n<<0,this.first?(this.h0=r+1732584193<<0,this.h1=t-271733879<<0,this.h2=n-1732584194<<0,this.h3=i+271733878<<0,this.first=!1):(this.h0=this.h0+r<<0,this.h1=this.h1+t<<0,this.h2=this.h2+n<<0,this.h3=this.h3+i<<0)},M.prototype.toString=M.prototype.hex=function(){this.finalize();var r=this.h0,t=this.h1,n=this.h2,i=this.h3;return o[r>>4&15]+o[15&r]+o[r>>12&15]+o[r>>8&15]+o[r>>20&15]+o[r>>16&15]+o[r>>28&15]+o[r>>24&15]+o[t>>4&15]+o[15&t]+o[t>>12&15]+o[t>>8&15]+o[t>>20&15]+o[t>>16&15]+o[t>>28&15]+o[t>>24&15]+o[n>>4&15]+o[15&n]+o[n>>12&15]+o[n>>8&15]+o[n>>20&15]+o[n>>16&15]+o[n>>28&15]+o[n>>24&15]+o[i>>4&15]+o[15&i]+o[i>>12&15]+o[i>>8&15]+o[i>>20&15]+o[i>>16&15]+o[i>>28&15]+o[i>>24&15]},M.prototype.array=M.prototype.digest=function(){this.finalize();var r=this.h0,t=this.h1,n=this.h2,i=this.h3;return[255&r,r>>8&255,r>>16&255,r>>24&255,255&t,t>>8&255,t>>16&255,t>>24&255,255&n,n>>8&255,n>>16&255,n>>24&255,255&i,i>>8&255,i>>16&255,i>>24&255]},M.prototype.buffer=M.prototype.arrayBuffer=function(){this.finalize();var r=new ArrayBuffer(16),t=new Uint32Array(r);return t[0]=this.h0,t[1]=this.h1,t[2]=this.h2,t[3]=this.h3,r},M.prototype.base64=function(){for(var r,t,n,i="",e=this.array(),o=0;o<15;)r=e[o++],t=e[o++],n=e[o++],i+=v[r>>>2]+v[63&(r<<4|t>>>4)]+v[63&(t<<2|n>>>6)]+v[63&n];return r=e[o],i+=v[r>>>2]+v[r<<4&63]+"=="};var E=function(){var t,n,i,e=w("hex");s&&(t=e,n=[eval][0]("require('crypto')"),i=[eval][0]("require('buffer').Buffer"),e=function(r){if("string"==typeof r)return n.createHash("md5").update(r,"utf8").digest("hex");if(null==r)throw h;return r.constructor===ArrayBuffer&&(r=new Uint8Array(r)),Array.isArray(r)||ArrayBuffer.isView(r)||r.constructor===i?n.createHash("md5").update(new i(r)).digest("hex"):t(r)}),e.create=function(){return new M},e.update=function(r){return e.create().update(r)};for(var r=0;r<f.length;++r){var o=f[r];e[o]=w(o)}return e}();e?m.exports=E:t.md5=E}(),n.exports),w=(d.hex,d.array,d.digest,d.arrayBuffer,d.buffer,d.create),M=(d.update,d.base64,function(r){function u(){var t=null!==r&&r.apply(this,arguments)||this;return t.__isReady=!1,t.__isCanceled=!1,t.__reqUpTk=null,t.__reqWXTk=null,t.__onReadyQueue=[],t.__onCancelQueue=[],t.__onSetUpTkFn=[],t.__onSetWXTkFn=[],t.__content="",t.typeId=0,t.__controls={initWithContent:function(r){return t.initWithContent(r).then(function(){return t.setContent(r)})},getContent:function(){return t.getContent()},getTypeId:function(){return t.getTypeId()},getType:function(){return t.getType()},onRequestUploadToken:function(r){return t.__onReqUpTk(r)},onRequestWechatToken:function(r){return t.__onReqWXTk(r)},waitForContent:function(){return t.__waitForContent()}},t}return e(u,r),u.prototype.setContent=function(r){this.__content="string"==typeof r?r:JSON.stringify(r),this.__isReady=!0;for(var t=0,n=this.__onReadyQueue;t<n.length;t++)(0,n[t])(this.__content);this.__onReadyQueue=[]},u.prototype.setCanceled=function(){this.__isCanceled=!0;for(var r=0,t=this.__onCancelQueue;r<t.length;r++){var n=t[r],i=new Error("Message Canceled.");i.name="CanceledError",n(i)}this.__onCancelQueue=[]},u.prototype.uploadFile=function(f){var h=this;return new Promise(function(o,s){var e,a=new FileReader;a.onload=function(){if(!(e=a.result)){var r=new Error;return r.name="UploadFileError",s(r)}var t=w();t.update(e);var n=t.hex(),i=function(n){var i=new XMLHttpRequest;i.ontimeout=function(r){s(r)},i.onerror=function(r){s(r)},i.onreadystatechange=function(){if(4==i.readyState&&200==i.status){var r=n.downloadUrl,t=r.indexOf(":");-1<t&&t<7&&(r=r.substr(t+1)),o(r)}};var r=n.uploadUrl,t=r.indexOf(":");for(var e in-1<t&&t<7&&(r=r.substr(t+1)),i.open("PUT",r,!0),i.timeout=6e4,n.headers)"host"!==e&&n.headers.hasOwnProperty(e)&&i.setRequestHeader(e,n.headers[e]);i.send(f)};h.__reqUpTk?h.__reqUpTk(f.size,n,n,f.type.split("/")[1]).then(i).catch(function(r){return s(r)}):u.__gControls.reqUpTk?u.__gControls.reqUpTk(f.size,n,n,f.type.split("/")[1]).then(i).catch(function(r){return s(r)}):new Promise(function(r){h.__onSetUpTkFn.push(r)}).then(function(){h.__reqUpTk(f.size,n,n,f.type.split("/")[1]).then(i).catch(function(r){return s(r)})})},a.readAsArrayBuffer(f)})},u.prototype.requestWechatToken=function(){var t=this;return this.__reqWXTk?this.__reqWXTk():u.__gControls.reqWXTk?u.__gControls.reqWXTk():new Promise(function(r){t.__onSetWXTkFn.push(r)}).then(function(){return t.__reqWXTk()})},u.prototype.isReady=function(){return this.__isReady},u.prototype.isCanceled=function(){return this.__isCanceled},u.prototype.onReady=function(r,t){if(this.__isReady)return r();this.__isCanceled?t&&t():this.__waitForContent().then(function(){r()}).catch(function(r){"CanceledError"===r.name&&t&&t()})},u.prototype.getContent=function(){var r;if(this.__isCanceled)throw(r=new Error("Message Canceled.")).name="CanceledError",r;if(!this.__isReady)throw(r=new Error("Content is not ready yet.")).name="ContentNotReadyError",r;return this.__content},u.prototype.getTypeId=function(){return this.typeId},u.prototype.getType=function(){return this.typeName},u.prototype.__onReqUpTk=function(r){this.__reqUpTk=r;for(var t=0,n=this.__onSetUpTkFn;t<n.length;t++)(0,n[t])();this.__onSetUpTkFn=[]},u.prototype.__onReqWXTk=function(r){this.__reqWXTk=r;for(var t=0,n=this.__onSetWXTkFn;t<n.length;t++)(0,n[t])();this.__onSetWXTkFn=[]},u.prototype.__waitForContent=function(){var n=this;if(this.__isReady)return Promise.resolve(this.__content);if(this.__isCanceled){var r=new Error("Message Canceled.");return r.name="CanceledError",Promise.reject(r)}return new Promise(function(r,t){n.__onReadyQueue.push(r),n.__onCancelQueue.push(t)})},u.__gControls={},u}(t)),E=function(i){function o(r,t){var n=i.call(this)||this;return n.n=r,n.r=t,n.x={},n.M={},n.N=new Set,n._={},n.L={},n.S="",n.q=new Date(0),n.r.on("message:9",function(r){r&&"object"==typeof r.args&&n.r.send(10,{msgid:"0"}).then(function(r){n.D(r)})}),M.__gControls.reqUpTk=n.F.bind(n),M.__gControls.reqWXTk=n.R.bind(n),n}return e(o,i),o.prototype.registerMessageType=function(r){var t=new r,n=t.__controls.getTypeId(),i=t.__controls.getType();0===n&&"text"!==i?this.L[i]=r:this._[n]=r},o.prototype.sendToRoom=function(n,i){var e=this;return n+="",this.K(i).then(function(t){var r=o.J(n,"group",t);return e.W(r).then(function(r){var t=e.z(n,"group",r.svr_msgid,i);return e.H(t),e.emit("send:group:"+n,t),t}).catch(function(r){throw e.emit("send-failed:"+r.name+":group:"+n+":"+r.name,t,r),r})})},o.prototype.sendToUser=function(n,i){var e=this;return this.K(i).then(function(t){var r=o.J(n,"user",t);return e.W(r).then(function(r){var t=e.z(n,"user",r.svr_msgid,i);return e.H(t),e.emit("send:user:"+n,t),t}).catch(function(r){throw e.emit("send-failed:"+r.name+":user:"+n,t,r),r})})},o.prototype.requestHistoryMessage=function(r,t,n,i){var s=this;return this.r.send(11,{interlocutor:r,min_msgid:t,max_msgid:n,day_interval:i}).then(function(r){for(var t=[],n=0,i=r.msg_list;n<i.length;n++){var e=i[n],o=s.X(e);t.push(o)}return t})},o.prototype.clear=function(){this.x={},this.M={},this.N.clear()},o.prototype.D=function(r){for(var e=this,t=r.msg_list,n=function(r){var t=o.X(r),n=t.withPeer,i=t.chatType;o.H(t)&&o.K(t.message).then(function(){e.emit("receive:"+i+":"+n,t)})},o=this,i=0,s=t;i<s.length;i++)n(s[i])},o.prototype.X=function(r){var t,n=this,i=r.sender,e=r.receiver,o=r.sender===this.n.get("userId");switch(r.chattype){case 1:default:t="user";break;case 2:t="group"}var s,a=new Date(1e3*r.timespan),f=r.msgtype,h=r.content;if(0===f){var u=h.match(/^(.+?)!/),c=u?u[1]:null;c?(h=h.replace(/^(.+?)!/,""),s=this.L[c]):s=this._[0]}else s=this._[f];if(!s){var v=new Error;throw v.name="MessageTypeMissingError",v}var l=new s;return l.__controls.initWithContent(h).catch(function(r){n.emit("error:"+r.name,r)}),{senderId:i,receiverId:e,withPeer:o||"group"===t?e:i,isFromMe:o,chatType:t,time:a,serial:r.serial,serverId:r.svr_msgid,message:l}},o.J=function(r,t,n){var i,e;switch(t){case"user":default:i=1;break;case"group":i=2}return e=0===n.getTypeId()&&"text"!==n.getType()?n.getType()+"!"+n.getContent():n.getContent(),{msgbodytype:n.getTypeId(),chattype:i,receiver:r,content:e}},o.prototype.z=function(r,t,n,i){return{senderId:this.n.get("userId"),receiverId:r,withPeer:r,isFromMe:!0,chatType:t,time:new Date,serverId:n,message:i}},o.prototype.H=function(r){if(this.N.has(r.serverId))return!1;var t=r.withPeer;switch(r.chatType){case"group":for(this.M[t]=this.M[t]||[],this.M[t].push(r),this.N.add(r.serverId);30<this.M[t].length;)(n=this.M[t].shift())&&this.N.delete(n.serverId);break;case"user":for(this.x[t]=this.x[t]||[],this.x[t].push(r),this.N.add(r.serverId);30<this.x[t].length;){var n;(n=this.x[t].shift())&&this.N.delete(n.serverId)}}return!0},o.prototype.W=function(r){return this.r.send(5,r)},o.prototype.K=function(r){var e=this;return r.__controls.onRequestUploadToken(function(r,t,n,i){return e.F(r,t,n,i)}),r.__controls.onRequestWechatToken(function(){return e.R()}),r.__controls.waitForContent().then(function(){return r}).catch(function(r){throw"CanceledError"===r.name&&e.emit("error:"+r.name,r),r})},o.prototype.F=function(r,t,n,i){return this.r.send(8,{filename:n,filesize:r,filemd5:t,filesuffix:i}).then(function(r){return{headers:r.headers,uploadUrl:r.token,downloadUrl:r.downloadurl}})},o.prototype.R=function(){var t=this,r=+new Date-+this.q;return this.S&&r<3e5?Promise.resolve(this.S):this.r.send(12,{}).then(function(r){return t.S=r.token,t.q=new Date,t.S})},o}(t);return function(n){function r(r){var t=n.call(this)||this;return t.o="",t.n=new o,t.r=new l(t.n),t.G=new s(t.n,t.r),t.Q=new a(t.n,t.r),t.V=new E(t.n,t.r),t.Y(),t.Z(),t.$(),t.tt(),t.it(),r&&t.init(r).then(),t}return e(r,n),r.prototype.init=function(r){var t=[];if(this.o=r.appKey,r.userId&&r.token&&t.push(this.login(r.userId,r.token,!0).then(function(){})),r.roomId){r.roomId instanceof Array||(r.roomId=[r.roomId]);for(var n=0,i=r.roomId;n<i.length;n++){var e=i[n];t.push(this.joinRoom(e).then(function(){}))}}return r.useMessageType&&this.registerMessageType(r.useMessageType),r.userId&&r.token?Promise.all(t).then(function(){}):Promise.resolve()},r.prototype.uninit=function(){this.logout()},r.prototype.login=function(r,t,n){return void 0===n&&(n=!1),this.G.login(this.o,r,t).catch(function(r){if(!n)throw r})},r.prototype.logout=function(){this.Q.clear(),this.V.clear(),this.G.logout()},r.prototype.isLogging=function(){return this.G.isLogging()},r.prototype.isLogged=function(){return this.G.isLogged()},r.prototype.getMyUserId=function(){return this.G.getMyUserId()},r.prototype.joinRoom=function(r){var t=this;return this.G.doIfLogged().then(function(){return t.Q.joinRoom(r)})},r.prototype.leaveRoom=function(r){var t=this;return this.G.doIfLogged().then(function(){return r?t.Q.leaveRoom(r):t.Q.leaveAllRoom()})},r.prototype.inRoom=function(r){return this.Q.inRoom(r)},r.prototype.getRoomIdList=function(){return this.Q.getRoomIdList()},r.prototype.registerMessageType=function(r){if(r instanceof Array)for(var t=0,n=r;t<n.length;t++){var i=n[t];this.V.registerMessageType(i)}else this.V.registerMessageType(r)},r.prototype.sendToRoom=function(r,t,n){var i=this;return void 0===n&&(n=!1),this.G.doIfLogged().then(function(){return i.Q.doIfJoinedRoom(r)}).then(function(){return i.V.sendToRoom(r,t)}).catch(function(r){if(!n&&(n=!0,!t.isCanceled()))throw r})},r.prototype.sendToUser=function(r,t,n){var i=this;return void 0===n&&(n=!1),this.G.doIfLogged().then(function(){return i.V.sendToUser(r,t)}).catch(function(r){if(!n&&(n=!0,!t.isCanceled()))throw r})},r.prototype.requestHistoryMessage=function(r,t,n,i){return this.V.requestHistoryMessage(r,t,n,i)},r.prototype.Y=function(){var r=this;this.r.on("status:reconnecting",function(){return r.G.reconnect().then(function(){return r.Q.reconnect()})})},r.prototype.Z=function(){var n=this;this.G.on("login",function(){return n.emit("account.login")}),this.G.on("logging",function(){return n.emit("account.logging")}),this.G.on("logout",function(){return n.emit("account.logout")}),this.G.on("kickoff",function(){return n.emit("account.kickoff")}),this.G.on("error:*",function(r,t){return n.emit("account."+r,t)})},r.prototype.$=function(){var i=this;this.Q.on("join:*",function(r,t){return i.emit("room.join:"+t,t)}),this.Q.on("joining:*",function(r,t){return i.emit("room.joining:"+t,t)}),this.Q.on("leave:*",function(r,t){return i.emit("room.leave:"+t,t)}),this.Q.on("join-error:*",function(r,t,n){return i.emit("room.join-error:"+t.name,t,n)}),this.Q.on("leave-error:*",function(r,t,n){return i.emit("room.leave-error:"+t.name,t,n)})},r.prototype.tt=function(){var i=this;this.V.on("send:*",function(r,t){return i.emit("message:send:"+t.chatType+":"+t.withPeer,t)}),this.V.on("send-failed:*",function(r,t,n){return i.emit("message:"+r,t,n)}),this.V.on("receive:*",function(r,t){return i.emit("message:receive:"+t.chatType+":"+t.withPeer,t)})},r.prototype.it=function(){var n=this;this.r.on("status:*",function(r,t){return n.emit("signaling.status:"+t,t)}),this.r.on("ready",function(){return n.emit("signaling.ready")}),this.r.on("message:*",function(r,t){return n.emit("signaling.receive:"+t.base.msgtype,t)}),this.r.on("send:*",function(r,t){return n.emit("signaling.send:"+t.base.msgtype,t)}),this.r.on("error",function(r){return n.emit("signaling.error",r)})},r.Message=M,r.WildEmitter=t,r}(t)}()}),h=r(function(r,t){r.exports=function(r){r=r&&r.hasOwnProperty("default")?r.default:r;var i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,t){r.__proto__=t}||function(r,t){for(var n in t)t.hasOwnProperty(n)&&(r[n]=t[n])};return function(n){function r(r){var t=n.call(this)||this;return t.n="",t.typeId=0,t.typeName="text",void 0!==r&&t.setText(r),t}return function(r,t){function n(){this.constructor=r}i(r,t),r.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}(r,n),r.prototype.setText=function(r){this.n=r.toString(),this.setContent(this.n)},r.prototype.getText=function(){return this.n},r.prototype.initWithContent=function(r){return this.n=r.toString(),Promise.resolve()},r.filterDirty=function(r,t){return void 0===t&&(t="**"),this.t?r.replace(this.t,t):r},r.setDirtyWords=function(r){this.t=r?new RegExp(r.join("|"),"ig"):null},r.t=null,r}(r.Message)}(f)}),u=r(function(r,t){r.exports=function(r){r=r&&r.hasOwnProperty("default")?r.default:r;var i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,t){r.__proto__=t}||function(r,t){for(var n in t)t.hasOwnProperty(n)&&(r[n]=t[n])},n=function(){function r(){var i=this;this.__uploadFn=null,this.__onSetUploadFn=[],this.__getWXTkFn=null,this.__onSetWXTkFn=[],this.__controls={setUploadFunc:function(r){i.__uploadFn=r;for(var t=0,n=i.__onSetUploadFn;t<n.length;t++)(0,n[t])();i.__onSetUploadFn=[]},setWechatTokenFunc:function(r){i.__getWXTkFn=r;for(var t=0,n=i.__onSetWXTkFn;t<n.length;t++)(0,n[t])();i.__onSetWXTkFn=[]}}}return r.prototype.getTypeId=function(){return this.typeId},r.prototype.getType=function(){return this.typeName},r.prototype.uploadFile=function(r){var t=this;return this.__uploadFn?this.__uploadFn(r):new Promise(function(r){t.__onSetUploadFn.push(r)}).then(function(){return t.__uploadFn(r)})},r.prototype.requestWechatToken=function(){var t=this;return this.__getWXTkFn?this.__getWXTkFn():new Promise(function(r){t.__onSetWXTkFn.push(r)}).then(function(){return t.__getWXTkFn()})},r}();return function(t){function o(){var r=null!==t&&t.apply(this,arguments)||this;return r.typeId=1,r.typeName="voice",r.t=null,r.i=null,r.r=!1,r.n=0,r}return function(r,t){function n(){this.constructor=r}i(r,t),r.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}(o,t),o.registerRecorder=function(r){for(var t=0,n=r;t<n.length;t++){var i=n[t],e=new i;e.isEnvSupport()&&(this.s.push(i),this.o.push(e))}},o.isEnvSupport=function(){return!!this.s.length},o.initRecorder=function(){return(new o).initRecord()},o.h=function(){var r=this;if(this.e[0]){var t=this.e[0];this.u.emit("begin-play",t),t.play(),t.on("end-play",function(){r.u.emit("end-play",t),r.e.shift(),r.e[0]&&r.u.emit("next",r.e[0]),r.h()})}else this.u.emit("all-ended")},o.addToAutoPlayQueue=function(r){this.e.push(r),this.u.emit("add",r),1===this.e.length&&this.h()},o.getAutoPlayQueueLength=function(){return this.e.length},o.getCurrentAutoPlayingMessage=function(){return this.e[0]},o.nextAutoPlay=function(){this.e.length&&(this.e[0].stop(),this.e.shift(),this.e[0]&&this.u.emit("next",this.e[0]),this.h())},o.stopAndClearAutoPlayQueue=function(){this.e.length&&(this.e[0].stop(),this.e=[],this.h())},o.bindAutoPlayEvent=function(r,t){this.u.on(""+r,t)},o.unbindAutoPlayEvent=function(r,t){this.u.off(""+r,t)},o.prototype.initWithContent=function(r){var t,n=this;try{t=JSON.parse(r)}catch(n){t=r}for(var i=0,e=o.s.length;i<e;i++)if(o.o[i].isSupportMsg(t))return this.t=new o.s[i],this.t.__controls.setUploadFunc(this.uploadFile.bind(this)),this.t.__controls.setWechatTokenFunc(this.requestWechatToken.bind(this)),this.t.initWithJsonMsg(t).then(function(){n.t.onPlayEnd(function(){n.emit("end-play")}),n.setContent(r)});return this.i=new Error("Unsupported voice message format."),this.i.name="UnsupportedVoiceFormatError",Promise.reject(this.i)},o.prototype.initRecord=function(){return o.isEnvSupport()?this.isReady()?(this.i=new Error,this.i.name="AlreadyReadyError"):this.isCanceled()&&(this.i=new Error,this.i.name="CanceledError"):(this.i=new Error,this.i.name="DeviceNotSupportedError"),this.i?(this.emit("error:"+this.i.name,this.i),Promise.reject(this.i)):this.t?Promise.resolve():(this.t=new o.s[0],this.t.__controls.setUploadFunc(this.uploadFile.bind(this)),this.t.__controls.setWechatTokenFunc(this.requestWechatToken.bind(this)),this.t.initRecord().catch(function(r){throw"NotSupportedError"===r.name&&(r.name="DeviceNotSupportedError"),r}))},o.prototype.startRecord=function(t){var n=this;return void 0===t&&(t=!1),this.r=!0,this.isCanceled()?(this.i=new Error,this.i.name="CanceledError",t?Promise.resolve():Promise.reject(this.i)):(this.i=null,this.initRecord().then(function(){if(!n.isCanceled())return n.t.onPlayEnd(function(){n.emit("end-play")}),n.t.onRecordEnd(function(){n.setContent(n.t.getJsonMsg()),n.emit("finish-record")}),n.t.startRecord()}).then(function(){if(n.isError()){if(n.t&&n.t.cancelRecord(),t)return;throw n.i}n.n=setTimeout(function(){n.r=!1},1e3),n.emit("start-record")}).catch(function(r){if(n.i=r,n.emit("error:"+r.name,r),n.cancelRecord(),!t)throw n.i}))},o.prototype.finishRecord=function(t){var n=this;return void 0===t&&(t=!1),this.i||(this.t?this.isCanceled()&&(this.i=new Error,this.i.name="CanceledError"):(this.i=new Error,this.i.name="RecorderNotStartedError")),this.i?(this.emit("error:"+this.i.name),t?Promise.resolve():Promise.reject(this.i)):this.r?(this.t&&this.t.cancelRecord(),this.setCanceled(),this.i=new Error,this.i.name="RecordTooShortError",this.emit("error:"+this.i.name),clearTimeout(this.n),t?Promise.resolve():Promise.reject(this.i)):(this.emit("finishing-record"),this.t.finishRecord().catch(function(r){if(n.setCanceled(),(n.i=r)&&r.name&&n.emit("error:"+r.name),!t)throw r}))},o.prototype.cancelRecord=function(){this.t&&this.t.cancelRecord(),this.setCanceled(),this.emit("cancel-record")},o.prototype.isRecording=function(){return!!this.t&&this.t.isRecording()},o.prototype.isError=function(){return!!this.i},o.prototype.getErrorName=function(){return this.i?this.i.name:""},o.prototype.play=function(){var r=this;this.onReady(function(){r.t.play(),r.emit("play")})},o.prototype.stop=function(){this.isReady()&&this.t&&this.t.isPlaying()&&(this.t.stop(),this.emit("stop"))},o.prototype.isPlaying=function(){return!!this.t&&this.t.isPlaying()},o.prototype.getDuration=function(){return this.t?this.t.getDuration():0},o.s=[],o.o=[],o.Recorder=n,o.e=[],o.u=new r.WildEmitter,o}(r.Message)}(f)}),c=r(function(r,t){r.exports=function(r){r=r&&r.hasOwnProperty("default")?r.default:r;var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,t){r.__proto__=t}||function(r,t){for(var n in t)t.hasOwnProperty(n)&&(r[n]=t[n])};return function(t){function i(){var r=null!==t&&t.apply(this,arguments)||this;return r.n="",r.t="",r.i=0,r.o=0,r.r=!1,r.e=!1,r.u=!1,r.s=function(){},r.c=function(){},r.f=function(){},r.typeId=1,r.typeName="wechat",r}return function(r,t){function n(){this.constructor=r}e(r,t),r.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}(i,t),i.h=function(){var i=this;if(this.a)return Promise.resolve();if(this.l)return new Promise(function(r,t){i.m.push(r),i.v.push(t),300<i.m.length&&(i.m.unshift(),i.v.unshift())});var n=this.d;if(n)return this.l=!0,new Promise(function(r){n.ready(function(){r()})}).then(function(){return new Promise(function(a,f){var h=["startRecord","stopRecord","playVoice","pauseVoice","stopVoice","uploadVoice","downloadVoice"];n.checkJsApi({jsApiList:h,success:function(r){if(!r||!r.checkResult)return(t=new Error).name="WXObjectNoConfigError",void f(t);for(var t,n=r.checkResult,i=[],e=0,o=h;e<o.length;e++){var s=o[e];n[s]||i.push(s)}if(i.length)return(t=new Error).name="WXNoPermissionError",void f(t);a()}})})}).then(function(){return new Promise(function(r,t){n.startRecord({success:function(){setTimeout(function(){n.stopRecord({success:function(){},complete:function(){setTimeout(function(){return r()},100)}})},200)},fail:function(){var r=new Error;r.name="NotAllowedError",t(r)}})})}).then(function(){i.a=!0,i.l=!1;for(var r=0,t=i.m;r<t.length;r++)(0,t[r])();return i.m.splice(0,333),i.v.splice(0,333),i.d.onVoiceRecordEnd({complete:function(r){i.w&&i.p.call(i.w,r)}}),i.d.onVoicePlayEnd({success:function(r){i.P.call(i.y,r)}}),Promise.resolve()}).catch(function(r){for(var t=0,n=i.v;t<n.length;t++)(0,n[t])(r);throw r});var r=new Error;return r.name="WXObjectIsEmptyError",Promise.reject(r)},i.b=function(t,r,n){var i=this;if(this.w){var e=new Error("Recorder is busy.");throw e.name="RecorderBusyError",e}this.y&&this.j(),this.w=r,this.p=n,this.T=!0,this.d.startRecord(Object.assign({},t,{success:function(r){t&&t.success&&t.success(r),setTimeout(function(){i.T=!1},900)}}))},i.g=function(){var t=this;this.T?setTimeout(function(){return t.g()},500):this.d.stopRecord({success:function(r){t.w&&t.p.call(t.w,r),t.w=null,t.p=function(){}}})},i.O=function(r,t,n){var i=this;if(this.y)return this.j(),void setTimeout(function(){return i.O(r,t,n)},100);this.d.playVoice(r),this.y=t,this.V=r,this.P=n},i.j=function(){this.d.stopVoice(this.V),this.y&&this.P.call(this.y),this.y=null,this.V={},this.P=function(){}},i.D=function(r){var n=this;return new Promise(function(t){n.d.downloadVoice({serverId:r,isShowProgressTips:0,success:function(r){t(r.localId||"")}})})},i.I=function(r){var n=this;return new Promise(function(t){n.d.uploadVoice({localId:r,isShowProgressTips:0,success:function(r){t(r.serverId)}})})},i.setWXObject=function(r){this.d=r},i.isWechat=function(){return!!navigator.userAgent.toLowerCase().match(/micromessenger/i)},i.prototype.isEnvSupport=function(){return i.isWechat()},i.prototype.isSupportMsg=function(r){return"object"==typeof r&&"string"==typeof r.mediaid&&0<r.mediaid.length},i.prototype.initRecord=function(){return i.h().then(function(){})},i.prototype.startRecord=function(){var n=this;return this.o=+new Date,new Promise(function(r,t){i.b({success:function(){n.o=+new Date,r()}},n,n.R),n.r=!0,n.u=!1})},i.prototype.finishRecord=function(){var n=this;return new Promise(function(r,t){n.c=r,i.g(),n.i=(+new Date-n.o)/1e3})},i.prototype.cancelRecord=function(){this.u=!0,i.g()},i.prototype.isRecording=function(){return this.r},i.prototype.onRecordEnd=function(r){this.s=r},i.prototype.getJsonMsg=function(){return{voicetime:this.getDuration().toFixed(2),mediaid:this.t,recordmode:this.getTypeId()}},i.prototype.initWithJsonMsg=function(r){var t=this;return this.i=r.voicetime,this.t=r.mediaid,i.h().then(function(){return i.D(t.t)}).then(function(r){t.n=r})},i.prototype.play=function(){i.O({localId:this.n},this,this._),this.e=!0,i.y=this},i.prototype.stop=function(){i.j(),this.e=!1,i.y=null},i.prototype.isPlaying=function(){return this.e},i.prototype.onPlayEnd=function(r){this.f=r},i.prototype.getDuration=function(){return this.i},i.prototype._=function(){this.e=!1,this.f()},i.prototype.R=function(r){var t=this,n=r.localId;this.u||(this.i=this.i<.1?(+new Date-this.o)/1e3:this.i,i.I(n).then(function(r){t.n=n,t.t=r,t.c(),t.s(),t.c=function(){},t.r=!1}))},i.d=null,i.a=!1,i.l=!1,i.T=!1,i.m=[],i.v=[],i.w=null,i.y=null,i.V={},i}(r.Recorder)}(u)}),v=r(function(r,t){r.exports=function(r){r=r&&r.hasOwnProperty("default")?r.default:r;var i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,t){r.__proto__=t}||function(r,t){for(var n in t)t.hasOwnProperty(n)&&(r[n]=t[n])};"undefined"!=typeof window?window:void 0!==g||"undefined"!=typeof self&&self;var t,e=(function(r,t){r.exports=function(){function o(r){return new Int16Array(r)}function s(r){return new Int32Array(r)}function a(r){return new Float32Array(r)}var r={fill:function(r,t,n,i){if(2==arguments.length)for(var e=0;e<r.length;e++)r[e]=t;else for(var e=t;e<n;e++)r[e]=i}},t={arraycopy:function(r,t,n,i,e){for(var o=t+e;t<o;)n[i++]=r[t++]}},n={};function i(r){this.ordinal=r}n.SQRT2=1.4142135623730951,n.FAST_LOG10=function(r){return Math.log10(r)},n.FAST_LOG10_X=function(r,t){return Math.log10(r)*t},i.short_block_allowed=new i(0),i.short_block_coupled=new i(1),i.short_block_dispensed=new i(2),i.short_block_forced=new i(3);var e={};function f(r){this.ordinal=r}e.MAX_VALUE=34028235e31,f.vbr_off=new f(0),f.vbr_mt=new f(1),f.vbr_rh=new f(2),f.vbr_abr=new f(3),f.vbr_mtrh=new f(4),f.vbr_default=f.vbr_mtrh;var h={System:t,VbrMode:f,Float:e,ShortBlock:i,Util:n,Arrays:r,new_array_n:function r(t){if(1==t.length)return new Array(t[0]);var n=t[0];t=t.slice(1);for(var i=[],e=0;e<n;e++)i.push(r(t));return i},new_byte:function(r){return new Int8Array(r)},new_double:function(r){return new Float64Array(r)},new_float:a,new_float_n:function r(t){if(1==t.length)return a(t[0]);var n=t[0];t=t.slice(1);for(var i=[],e=0;e<n;e++)i.push(r(t));return i},new_int:s,new_int_n:function r(t){if(1==t.length)return s(t[0]);var n=t[0];t=t.slice(1);for(var i=[],e=0;e<n;e++)i.push(r(t));return i},new_short:o,new_short_n:function r(t){if(1==t.length)return o(t[0]);var n=t[0];t=t.slice(1);for(var i=[],e=0;e<n;e++)i.push(r(t));return i},assert:function(r){}},N=h.System,l=h.Util,S=h.Arrays,Y=h.new_float,u=function(){var v=[-.1482523854003001,32.308141959636465,296.40344946382766,883.1344870032432,11113.947376231741,1057.2713659324597,305.7402417275812,30.825928907280012,3.8533188138216365,59.42900443849514,709.5899960123345,5281.91112291017,-5829.66483675846,-817.6293103748613,-76.91656988279972,-4.594269939176596,.9063471690191471,.1960342806591213,-.15466694054279598,34.324387823855965,301.8067566458425,817.599602898885,11573.795901679885,1181.2520595540152,321.59731579894424,31.232021761053772,3.7107095756221318,53.650946155329365,684.167428119626,5224.56624370173,-6366.391851890084,-908.9766368219582,-89.83068876699639,-5.411397422890401,.8206787908286602,.3901806440322567,-.16070888947830023,36.147034243915876,304.11815768187864,732.7429163887613,11989.60988270091,1300.012278487897,335.28490093152146,31.48816102859945,3.373875931311736,47.232241542899175,652.7371796173471,5132.414255594984,-6909.087078780055,-1001.9990371107289,-103.62185754286375,-6.104916304710272,.7416505462720353,.5805693545089249,-.16636367662261495,37.751650073343995,303.01103387567713,627.9747488785183,12358.763425278165,1412.2779918482834,346.7496836825721,31.598286663170416,3.1598635433980946,40.57878626349686,616.1671130880391,5007.833007176154,-7454.040671756168,-1095.7960341867115,-118.24411666465777,-6.818469345853504,.6681786379192989,.7653668647301797,-.1716176790982088,39.11551877123304,298.3413246578966,503.5259106886539,12679.589408408976,1516.5821921214542,355.9850766329023,31.395241710249053,2.9164211881972335,33.79716964664243,574.8943997801362,4853.234992253242,-7997.57021486075,-1189.7624067269965,-133.6444792601766,-7.7202770609839915,.5993769336819237,.9427934736519954,-.17645823955292173,40.21879108166477,289.9982036694474,359.3226160751053,12950.259102786438,1612.1013903507662,362.85067106591504,31.045922092242872,2.822222032597987,26.988862316190684,529.8996541764288,4671.371946949588,-8535.899136645805,-1282.5898586244496,-149.58553632943463,-8.643494270763135,.5345111359507916,1.111140466039205,-.36174739330527045,41.04429910497807,277.5463268268618,195.6386023135583,13169.43812144731,1697.6433561479398,367.40983966190305,30.557037410382826,2.531473372857427,20.070154905927314,481.50208566532336,4464.970341588308,-9065.36882077239,-1373.62841526722,-166.1660487028118,-9.58289321133207,.4729647758913199,1.268786568327291,-.36970682634889585,41.393213350082036,261.2935935556502,12.935476055240873,13336.131683328815,1772.508612059496,369.76534388639965,29.751323653701338,2.4023193045459172,13.304795348228817,430.5615775526625,4237.0568611071185,-9581.931701634761,-1461.6913552409758,-183.12733958476446,-10.718010163869403,.41421356237309503,1.414213562373095,-.37677560326535325,41.619486213528496,241.05423794991074,-187.94665032361226,13450.063605744153,1836.153896465782,369.4908799925761,29.001847876923147,2.0714759319987186,6.779591200894186,377.7767837205709,3990.386575512536,-10081.709459700915,-1545.947424837898,-200.3762958015653,-11.864482073055006,.3578057213145241,1.546020906725474,-.3829366947518991,41.1516456456653,216.47684307105183,-406.1569483347166,13511.136535077321,1887.8076599260432,367.3025214564151,28.136213436723654,1.913880671464418,.3829366947518991,323.85365704338597,3728.1472257487526,-10561.233882199509,-1625.2025997821418,-217.62525175416,-13.015432208941645,.3033466836073424,1.66293922460509,-.5822628872992417,40.35639251440489,188.20071124269245,-640.2706748618148,13519.21490106562,1927.6022433578062,362.8197642637487,26.968821921868447,1.7463817695935329,-5.62650678237171,269.3016715297017,3453.386536448852,-11016.145278780888,-1698.6569643425091,-234.7658734267683,-14.16351421663124,.2504869601913055,1.76384252869671,-.5887180101749253,39.23429103868072,155.76096234403798,-889.2492977967378,13475.470561874661,1955.0535223723712,356.4450994756727,25.894952980042156,1.5695032905781554,-11.181939564328772,214.80884394039484,3169.1640829158237,-11443.321309975563,-1765.1588461316153,-251.68908574481912,-15.49755935939164,.198912367379658,1.847759065022573,-.7912582233652842,37.39369355329111,119.699486012458,-1151.0956593239027,13380.446257078214,1970.3952110853447,348.01959814116185,24.731487364283044,1.3850130831637748,-16.421408865300393,161.05030052864092,2878.3322807850063,-11838.991423510031,-1823.985884688674,-268.2854986386903,-16.81724543849939,.1483359875383474,1.913880671464418,-.7960642926861912,35.2322109610459,80.01928065061526,-1424.0212633405113,13235.794061869668,1973.804052543835,337.9908651258184,23.289159354463873,1.3934255946442087,-21.099669467133474,108.48348407242611,2583.700758091299,-12199.726194855148,-1874.2780658979746,-284.2467154529415,-18.11369784385905,.09849140335716425,1.961570560806461,-.998795456205172,32.56307803611191,36.958364584370486,-1706.075448829146,13043.287458812016,1965.3831106103316,326.43182772364605,22.175018750622293,1.198638339011324,-25.371248002043963,57.53505923036915,2288.41886619975,-12522.674544337233,-1914.8400385312243,-299.26241273417224,-19.37805630698734,.04912684976946725,1.990369453344394,.035780907*l.SQRT2*.5/2384e-9,.017876148*l.SQRT2*.5/2384e-9,.003134727*l.SQRT2*.5/2384e-9,.002457142*l.SQRT2*.5/2384e-9,971317e-9*l.SQRT2*.5/2384e-9,218868e-9*l.SQRT2*.5/2384e-9,101566e-9*l.SQRT2*.5/2384e-9,13828e-9*l.SQRT2*.5/2384e-9,12804.797818791945,1945.5515939597317,313.4244966442953,49591e-9/2384e-9,1995.1556208053692,21458e-9/2384e-9,-69618e-9/2384e-9],y=[[2382191739347913e-28,6423305872147834e-28,9400849094049688e-28,1122435026096556e-27,1183840321267481e-27,1122435026096556e-27,940084909404969e-27,6423305872147839e-28,2382191739347918e-28,5456116108943412e-27,4878985199565852e-27,4240448995017367e-27,3559909094758252e-27,2858043359288075e-27,2156177623817898e-27,1475637723558783e-27,8371015190102974e-28,2599706096327376e-28,-5456116108943412e-27,-4878985199565852e-27,-4240448995017367e-27,-3559909094758252e-27,-2858043359288076e-27,-2156177623817898e-27,-1475637723558783e-27,-8371015190102975e-28,-2599706096327376e-28,-2382191739347923e-28,-6423305872147843e-28,-9400849094049696e-28,-1122435026096556e-27,-1183840321267481e-27,-1122435026096556e-27,-9400849094049694e-28,-642330587214784e-27,-2382191739347918e-28],[2382191739347913e-28,6423305872147834e-28,9400849094049688e-28,1122435026096556e-27,1183840321267481e-27,1122435026096556e-27,9400849094049688e-28,6423305872147841e-28,2382191739347918e-28,5456116108943413e-27,4878985199565852e-27,4240448995017367e-27,3559909094758253e-27,2858043359288075e-27,2156177623817898e-27,1475637723558782e-27,8371015190102975e-28,2599706096327376e-28,-5461314069809755e-27,-4921085770524055e-27,-4343405037091838e-27,-3732668368707687e-27,-3093523840190885e-27,-2430835727329465e-27,-1734679010007751e-27,-974825365660928e-27,-2797435120168326e-28,0,0,0,0,0,0,-2283748241799531e-28,-4037858874020686e-28,-2146547464825323e-28],[.1316524975873958,.414213562373095,.7673269879789602,1.091308501069271,1.303225372841206,1.56968557711749,1.920982126971166,2.414213562373094,3.171594802363212,4.510708503662055,7.595754112725146,22.90376554843115,.984807753012208,.6427876096865394,.3420201433256688,.9396926207859084,-.1736481776669303,-.7660444431189779,.8660254037844387,.5,-.5144957554275265,-.4717319685649723,-.3133774542039019,-.1819131996109812,-.09457419252642064,-.04096558288530405,-.01419856857247115,-.003699974673760037,.8574929257125442,.8817419973177052,.9496286491027329,.9833145924917901,.9955178160675857,.9991605581781475,.999899195244447,.9999931550702802],[0,0,0,0,0,0,2283748241799531e-28,4037858874020686e-28,2146547464825323e-28,5461314069809755e-27,4921085770524055e-27,4343405037091838e-27,3732668368707687e-27,3093523840190885e-27,2430835727329466e-27,1734679010007751e-27,974825365660928e-27,2797435120168326e-28,-5456116108943413e-27,-4878985199565852e-27,-4240448995017367e-27,-3559909094758253e-27,-2858043359288075e-27,-2156177623817898e-27,-1475637723558782e-27,-8371015190102975e-28,-2599706096327376e-28,-2382191739347913e-28,-6423305872147834e-28,-9400849094049688e-28,-1122435026096556e-27,-1183840321267481e-27,-1122435026096556e-27,-9400849094049688e-28,-6423305872147841e-28,-2382191739347918e-28]],A=y[yr.SHORT_TYPE],b=y[yr.SHORT_TYPE],k=y[yr.SHORT_TYPE],R=y[yr.SHORT_TYPE],T=[0,1,16,17,8,9,24,25,4,5,20,21,12,13,28,29,2,3,18,19,10,11,26,27,6,7,22,23,14,15,30,31];function O(r,t,n){for(var i,e,o,s=10,a=t+238-14-286,f=-15;f<0;f++){var h,u,c;h=v[s+-10],u=r[a+-224]*h,c=r[t+224]*h,h=v[s+-9],u+=r[a+-160]*h,c+=r[t+160]*h,h=v[s+-8],u+=r[a+-96]*h,c+=r[t+96]*h,h=v[s+-7],u+=r[a+-32]*h,c+=r[t+32]*h,h=v[s+-6],u+=r[a+32]*h,c+=r[t+-32]*h,h=v[s+-5],u+=r[a+96]*h,c+=r[t+-96]*h,h=v[s+-4],u+=r[a+160]*h,c+=r[t+-160]*h,h=v[s+-3],u+=r[a+224]*h,c+=r[t+-224]*h,h=v[s+-2],u+=r[t+-256]*h,c-=r[a+256]*h,h=v[s+-1],u+=r[t+-192]*h,c-=r[a+192]*h,h=v[s+0],u+=r[t+-128]*h,c-=r[a+128]*h,h=v[s+1],u+=r[t+-64]*h,c-=r[a+64]*h,h=v[s+2],u+=r[t+0]*h,c-=r[a+0]*h,h=v[s+3],u+=r[t+64]*h,c-=r[a+-64]*h,h=v[s+4],u+=r[t+128]*h,c-=r[a+-128]*h,h=v[s+5],u+=r[t+192]*h,c-=r[a+-192]*h,u*=v[s+6],h=c-u,n[30+2*f]=c+u,n[31+2*f]=v[s+7]*h,s+=18,t--,a++}c=r[t+-16]*v[s+-10],u=r[t+-32]*v[s+-2],c+=(r[t+-48]-r[t+16])*v[s+-9],u+=r[t+-96]*v[s+-1],c+=(r[t+-80]+r[t+48])*v[s+-8],u+=r[t+-160]*v[s+0],c+=(r[t+-112]-r[t+80])*v[s+-7],u+=r[t+-224]*v[s+1],c+=(r[t+-144]+r[t+112])*v[s+-6],u-=r[t+32]*v[s+2],c+=(r[t+-176]-r[t+144])*v[s+-5],u-=r[t+96]*v[s+3],c+=(r[t+-208]+r[t+176])*v[s+-4],u-=r[t+160]*v[s+4],c+=(r[t+-240]-r[t+208])*v[s+-3],u-=r[t+224],i=u-c,e=u+c,c=n[14],u=n[15]-c,n[31]=e+c,n[30]=i+u,n[15]=i-u,n[14]=e-c,o=n[28]-n[0],n[0]+=n[28],n[28]=o*v[s+-36+7],o=n[29]-n[1],n[1]+=n[29],n[29]=o*v[s+-36+7],o=n[26]-n[2],n[2]+=n[26],n[26]=o*v[s+-72+7],o=n[27]-n[3],n[3]+=n[27],n[27]=o*v[s+-72+7],o=n[24]-n[4],n[4]+=n[24],n[24]=o*v[s+-108+7],o=n[25]-n[5],n[5]+=n[25],n[25]=o*v[s+-108+7],o=n[22]-n[6],n[6]+=n[22],n[22]=o*l.SQRT2,o=n[23]-n[7],n[7]+=n[23],n[23]=o*l.SQRT2-n[7],n[7]-=n[6],n[22]-=n[7],n[23]-=n[22],o=n[6],n[6]=n[31]-o,n[31]=n[31]+o,o=n[7],n[7]=n[30]-o,n[30]=n[30]+o,o=n[22],n[22]=n[15]-o,n[15]=n[15]+o,o=n[23],n[23]=n[14]-o,n[14]=n[14]+o,o=n[20]-n[8],n[8]+=n[20],n[20]=o*v[s+-180+7],o=n[21]-n[9],n[9]+=n[21],n[21]=o*v[s+-180+7],o=n[18]-n[10],n[10]+=n[18],n[18]=o*v[s+-216+7],o=n[19]-n[11],n[11]+=n[19],n[19]=o*v[s+-216+7],o=n[16]-n[12],n[12]+=n[16],n[16]=o*v[s+-252+7],o=n[17]-n[13],n[13]+=n[17],n[17]=o*v[s+-252+7],o=-n[20]+n[24],n[20]+=n[24],n[24]=o*v[s+-216+7],o=-n[21]+n[25],n[21]+=n[25],n[25]=o*v[s+-216+7],o=n[4]-n[8],n[4]+=n[8],n[8]=o*v[s+-216+7],o=n[5]-n[9],n[5]+=n[9],n[9]=o*v[s+-216+7],o=n[0]-n[12],n[0]+=n[12],n[12]=o*v[s+-72+7],o=n[1]-n[13],n[1]+=n[13],n[13]=o*v[s+-72+7],o=n[16]-n[28],n[16]+=n[28],n[28]=o*v[s+-72+7],o=-n[17]+n[29],n[17]+=n[29],n[29]=o*v[s+-72+7],o=l.SQRT2*(n[2]-n[10]),n[2]+=n[10],n[10]=o,o=l.SQRT2*(n[3]-n[11]),n[3]+=n[11],n[11]=o,o=l.SQRT2*(-n[18]+n[26]),n[18]+=n[26],n[26]=o-n[18],o=l.SQRT2*(-n[19]+n[27]),n[19]+=n[27],n[27]=o-n[19],o=n[2],n[19]-=n[3],n[3]-=o,n[2]=n[31]-o,n[31]+=o,o=n[3],n[11]-=n[19],n[18]-=o,n[3]=n[30]-o,n[30]+=o,o=n[18],n[27]-=n[11],n[19]-=o,n[18]=n[15]-o,n[15]+=o,o=n[19],n[10]-=o,n[19]=n[14]-o,n[14]+=o,o=n[10],n[11]-=o,n[10]=n[23]-o,n[23]+=o,o=n[11],n[26]-=o,n[11]=n[22]-o,n[22]+=o,o=n[26],n[27]-=o,n[26]=n[7]-o,n[7]+=o,o=n[27],n[27]=n[6]-o,n[6]+=o,o=l.SQRT2*(n[0]-n[4]),n[0]+=n[4],n[4]=o,o=l.SQRT2*(n[1]-n[5]),n[1]+=n[5],n[5]=o,o=l.SQRT2*(n[16]-n[20]),n[16]+=n[20],n[20]=o,o=l.SQRT2*(n[17]-n[21]),n[17]+=n[21],n[21]=o,o=-l.SQRT2*(n[8]-n[12]),n[8]+=n[12],n[12]=o-n[8],o=-l.SQRT2*(n[9]-n[13]),n[9]+=n[13],n[13]=o-n[9],o=-l.SQRT2*(n[25]-n[29]),n[25]+=n[29],n[29]=o-n[25],o=-l.SQRT2*(n[24]+n[28]),n[24]-=n[28],n[28]=o-n[24],o=n[24]-n[16],n[24]=o,o=n[20]-o,n[20]=o,o=n[28]-o,n[28]=o,o=n[25]-n[17],n[25]=o,o=n[21]-o,n[21]=o,o=n[29]-o,n[29]=o,o=n[17]-n[1],n[17]=o,o=n[9]-o,n[9]=o,o=n[25]-o,n[25]=o,o=n[5]-o,n[5]=o,o=n[21]-o,n[21]=o,o=n[13]-o,n[13]=o,o=n[29]-o,n[29]=o,o=n[1]-n[0],n[1]=o,o=n[16]-o,n[16]=o,o=n[17]-o,n[17]=o,o=n[8]-o,n[8]=o,o=n[9]-o,n[9]=o,o=n[24]-o,n[24]=o,o=n[25]-o,n[25]=o,o=n[4]-o,n[4]=o,o=n[5]-o,n[5]=o,o=n[20]-o,n[20]=o,o=n[21]-o,n[21]=o,o=n[12]-o,n[12]=o,o=n[13]-o,n[13]=o,o=n[28]-o,n[28]=o,o=n[29]-o,n[29]=o,o=n[0],n[0]+=n[31],n[31]-=o,o=n[1],n[1]+=n[30],n[30]-=o,o=n[16],n[16]+=n[15],n[15]-=o,o=n[17],n[17]+=n[14],n[14]-=o,o=n[8],n[8]+=n[23],n[23]-=o,o=n[9],n[9]+=n[22],n[22]-=o,o=n[24],n[24]+=n[7],n[7]-=o,o=n[25],n[25]+=n[6],n[6]-=o,o=n[4],n[4]+=n[27],n[27]-=o,o=n[5],n[5]+=n[26],n[26]-=o,o=n[20],n[20]+=n[11],n[11]-=o,o=n[21],n[21]+=n[10],n[10]-=o,o=n[12],n[12]+=n[19],n[19]-=o,o=n[13],n[13]+=n[18],n[18]-=o,o=n[28],n[28]+=n[3],n[3]-=o,o=n[29],n[29]+=n[2],n[2]-=o}function P(r,t){for(var n=0;n<3;n++){var i,e,o,s,a,f;s=r[t+6]*y[yr.SHORT_TYPE][0]-r[t+15],i=r[t+0]*y[yr.SHORT_TYPE][2]-r[t+9],e=s+i,o=s-i,s=r[t+15]*y[yr.SHORT_TYPE][0]+r[t+6],i=r[t+9]*y[yr.SHORT_TYPE][2]+r[t+0],a=s+i,f=-s+i,i=2069978111953089e-26*(r[t+3]*y[yr.SHORT_TYPE][1]-r[t+12]),s=2069978111953089e-26*(r[t+12]*y[yr.SHORT_TYPE][1]+r[t+3]),r[t+0]=190752519173728e-25*e+i,r[t+15]=190752519173728e-25*-a+s,o=.8660254037844387*o*1907525191737281e-26,a=.5*a*1907525191737281e-26+s,r[t+3]=o-a,r[t+6]=o+a,e=.5*e*1907525191737281e-26-i,f=.8660254037844387*f*1907525191737281e-26,r[t+9]=e+f,r[t+12]=e-f,t++}}function L(r,t,n){var i,e,o,s,a,f,h,u,c,v,l,d,w,M,E,m,_,g;o=n[17]-n[9],a=n[15]-n[11],f=n[14]-n[12],h=n[0]+n[8],u=n[1]+n[7],c=n[2]+n[6],v=n[3]+n[5],r[t+17]=h+c-v-(u-n[4]),e=(h+c-v)*b[19]+(u-n[4]),i=(o-a-f)*b[18],r[t+5]=i+e,r[t+6]=i-e,s=(n[16]-n[10])*b[18],u=u*b[19]+n[4],i=o*b[12]+s+a*b[13]+f*b[14],e=-h*b[16]+u-c*b[17]+v*b[15],r[t+1]=i+e,r[t+2]=i-e,i=o*b[13]-s-a*b[14]+f*b[12],e=-h*b[17]+u-c*b[15]+v*b[16],r[t+9]=i+e,r[t+10]=i-e,i=o*b[14]-s+a*b[12]-f*b[13],e=h*b[15]-u+c*b[16]-v*b[17],r[t+13]=i+e,r[t+14]=i-e,l=n[8]-n[0],w=n[6]-n[2],M=n[5]-n[3],E=n[17]+n[9],m=n[16]+n[10],_=n[15]+n[11],g=n[14]+n[12],r[t+0]=E+_+g+(m+n[13]),i=(E+_+g)*b[19]-(m+n[13]),e=(l-w+M)*b[18],r[t+11]=i+e,r[t+12]=i-e,d=(n[7]-n[1])*b[18],m=n[13]-m*b[19],i=E*b[15]-m+_*b[16]+g*b[17],e=l*b[14]+d+w*b[12]+M*b[13],r[t+3]=i+e,r[t+4]=i-e,i=-E*b[17]+m-_*b[15]-g*b[16],e=l*b[13]+d-w*b[14]-M*b[12],r[t+7]=i+e,r[t+8]=i-e,i=-E*b[16]+m-_*b[17]-g*b[15],e=l*b[12]-d+w*b[13]-M*b[14],r[t+15]=i+e,r[t+16]=i-e}this.mdct_sub48=function(r,t,n){for(var i=t,e=286,o=0;o<r.channels_out;o++){for(var s=0;s<r.mode_gr;s++){for(var a,f=r.l3_side.tt[s][o],h=f.xr,u=0,c=r.sb_sample[o][1-s],v=0,l=0;l<9;l++)for(O(i,e,c[v]),O(i,e+32,c[v+1]),v+=2,e+=64,a=1;a<32;a+=2)c[v-1][a]*=-1;for(a=0;a<32;a++,u+=18){var d=f.block_type,w=r.sb_sample[o][s],M=r.sb_sample[o][1-s];if(0!=f.mixed_block_flag&&a<2&&(d=0),r.amp_filter[a]<1e-12)S.fill(h,u+0,u+18,0);else{if(r.amp_filter[a]<1)for(var l=0;l<18;l++)M[l][T[a]]*=r.amp_filter[a];if(d==yr.SHORT_TYPE){for(var l=-3;l<0;l++){var E=y[yr.SHORT_TYPE][l+3];h[u+3*l+9]=w[9+l][T[a]]*E-w[8-l][T[a]],h[u+3*l+18]=w[14-l][T[a]]*E+w[15+l][T[a]],h[u+3*l+10]=w[15+l][T[a]]*E-w[14-l][T[a]],h[u+3*l+19]=M[2-l][T[a]]*E+M[3+l][T[a]],h[u+3*l+11]=M[3+l][T[a]]*E-M[2-l][T[a]],h[u+3*l+20]=M[8-l][T[a]]*E+M[9+l][T[a]]}P(h,u)}else{for(var m=Y(18),l=-9;l<0;l++){var _,g;_=y[d][l+27]*M[l+9][T[a]]+y[d][l+36]*M[8-l][T[a]],g=y[d][l+9]*w[l+9][T[a]]-y[d][l+18]*w[8-l][T[a]],m[l+9]=_-g*A[3+l+9],m[l+18]=_*A[3+l+9]+g}L(h,u,m)}}if(d!=yr.SHORT_TYPE&&0!=a)for(var l=7;0<=l;--l){var b,p;b=h[u+l]*k[20+l]+h[u+-1-l]*R[28+l],p=h[u+l]*R[28+l]-h[u+-1-l]*k[20+l],h[u+-1-l]=b,h[u+l]=p}}}if(i=n,e=286,1==r.mode_gr)for(var I=0;I<18;I++)N.arraycopy(r.sb_sample[o][1][I],0,r.sb_sample[o][0][I],0,32)}}},c=h.System,v=h.new_float,d=h.new_float_n,w=function(){this.l=v(yr.SBMAX_l),this.s=d([yr.SBMAX_s,3]);var i=this;this.assign=function(r){c.arraycopy(r.l,0,i.l,0,yr.SBMAX_l);for(var t=0;t<yr.SBMAX_s;t++)for(var n=0;n<3;n++)i.s[t][n]=r.s[t][n]}},M=function(){this.thm=new w,this.en=new w},C=h.System,j=h.VbrMode,G=h.new_array_n,U=h.new_float,X=h.new_float_n,x=h.new_int,V=h.assert;function H(){var r=u,P=M,L=H.FFTOFFSET,N=H.MPG_MD_MS_LR,S=null,Y=this.psy=null,D=null,B=null;this.setModules=function(r,t,n,i){S=r,this.psy=t,Y=t,D=i,B=n};var F=new r;this.lame_encode_mp3_frame=function(r,t,n,i,e,o){var s,a=G([2,2]);a[0][0]=new P,a[0][1]=new P,a[1][0]=new P,a[1][1]=new P;var f,h=G([2,2]);h[0][0]=new P,h[0][1]=new P,h[1][0]=new P,h[1][1]=new P;var u,c,v,l=[null,null],d=r.internal_flags,w=X([2,4]),M=[.5,.5],E=[[0,0],[0,0]],m=[[0,0],[0,0]];if(l[0]=t,l[1]=n,0==d.lame_encode_frame_init&&function(r,t){var n,i,e=r.internal_flags;if(0==e.lame_encode_frame_init){var o,s,a=U(2014),f=U(2014);for(e.lame_encode_frame_init=1,s=o=0;o<286+576*(1+e.mode_gr);++o)o<576*e.mode_gr?(a[o]=0,2==e.channels_out&&(f[o]=0)):(a[o]=t[0][s],2==e.channels_out&&(f[o]=t[1][s]),++s);for(i=0;i<e.mode_gr;i++)for(n=0;n<e.channels_out;n++)e.l3_side.tt[i][n].block_type=H.SHORT_TYPE;F.mdct_sub48(e,a,f),V(e.mf_size>=H.BLKSIZE+r.framesize-H.FFTOFFSET),V(e.mf_size>=512+r.framesize-32)}}(r,l),d.padding=0,(d.slot_lag-=d.frac_SpF)<0&&(d.slot_lag+=r.out_samplerate,d.padding=1),0!=d.psymodel){var _=[null,null],g=0,b=x(2);for(v=0;v<d.mode_gr;v++){for(c=0;c<d.channels_out;c++)_[c]=l[c],g=576+576*v-H.FFTOFFSET;if(0!=(r.VBR==j.vbr_mtrh||r.VBR==j.vbr_mt?Y.L3psycho_anal_vbr(r,_,g,v,a,h,E[v],m[v],w[v],b):Y.L3psycho_anal_ns(r,_,g,v,a,h,E[v],m[v],w[v],b)))return-4;for(r.mode==MPEGMode.JOINT_STEREO&&(M[v]=w[v][2]+w[v][3],0<M[v]&&(M[v]=w[v][3]/M[v])),c=0;c<d.channels_out;c++){var p=d.l3_side.tt[v][c];p.block_type=b[c],p.mixed_block_flag=0}}}else for(v=0;v<d.mode_gr;v++)for(c=0;c<d.channels_out;c++)d.l3_side.tt[v][c].block_type=H.NORM_TYPE,d.l3_side.tt[v][c].mixed_block_flag=0,m[v][c]=E[v][c]=700;if(function(r){var t,n;if(0==r.ATH.useAdjust)return r.ATH.adjust=1;if(n=r.loudness_sq[0][0],t=r.loudness_sq[1][0],2==r.channels_out?(n+=r.loudness_sq[0][1],t+=r.loudness_sq[1][1]):(n+=n,t+=t),2==r.mode_gr&&(n=Math.max(n,t)),n*=.5,.03125<(n*=r.ATH.aaSensitivityP))1<=r.ATH.adjust?r.ATH.adjust=1:r.ATH.adjust<r.ATH.adjustLimit&&(r.ATH.adjust=r.ATH.adjustLimit),r.ATH.adjustLimit=1;else{var i=31.98*n+625e-6;r.ATH.adjust>=i?(r.ATH.adjust*=.075*i+.925,r.ATH.adjust<i&&(r.ATH.adjust=i)):r.ATH.adjustLimit>=i?r.ATH.adjust=i:r.ATH.adjust<r.ATH.adjustLimit&&(r.ATH.adjust=r.ATH.adjustLimit),r.ATH.adjustLimit=i}}(d),F.mdct_sub48(d,l[0],l[1]),d.mode_ext=H.MPG_MD_LR_LR,r.force_ms)d.mode_ext=H.MPG_MD_MS_LR;else if(r.mode==MPEGMode.JOINT_STEREO){var I=0,y=0;for(v=0;v<d.mode_gr;v++)for(c=0;c<d.channels_out;c++)I+=m[v][c],y+=E[v][c];if(I<=1*y){var A=d.l3_side.tt[0],k=d.l3_side.tt[d.mode_gr-1];A[0].block_type==A[1].block_type&&k[0].block_type==k[1].block_type&&(d.mode_ext=H.MPG_MD_MS_LR)}}if(d.mode_ext==N?(f=h,u=m):(f=a,u=E),r.analysis&&null!=d.pinfo)for(v=0;v<d.mode_gr;v++)for(c=0;c<d.channels_out;c++)d.pinfo.ms_ratio[v]=d.ms_ratio[v],d.pinfo.ms_ener_ratio[v]=M[v],d.pinfo.blocktype[v][c]=d.l3_side.tt[v][c].block_type,d.pinfo.pe[v][c]=u[v][c],C.arraycopy(d.l3_side.tt[v][c].xr,0,d.pinfo.xr[v][c],0,576),d.mode_ext==N&&(d.pinfo.ers[v][c]=d.pinfo.ers[v][c+2],C.arraycopy(d.pinfo.energy[v][c+2],0,d.pinfo.energy[v][c],0,d.pinfo.energy[v][c].length));if(r.VBR==j.vbr_off||r.VBR==j.vbr_abr){var R,T;for(R=0;R<18;R++)d.nsPsy.pefirbuf[R]=d.nsPsy.pefirbuf[R+1];for(v=T=0;v<d.mode_gr;v++)for(c=0;c<d.channels_out;c++)T+=u[v][c];for(d.nsPsy.pefirbuf[18]=T,T=d.nsPsy.pefirbuf[9],R=0;R<9;R++)T+=(d.nsPsy.pefirbuf[R]+d.nsPsy.pefirbuf[18-R])*H.fircoef[R];for(T=3350*d.mode_gr*d.channels_out/T,v=0;v<d.mode_gr;v++)for(c=0;c<d.channels_out;c++)u[v][c]*=T}if(d.iteration_loop.iteration_loop(r,u,M,f),S.format_bitstream(r),s=S.copy_buffer(d,i,e,o,1),r.bWriteVbrTag&&D.addVbrFrame(r),r.analysis&&null!=d.pinfo){for(c=0;c<d.channels_out;c++){var O;for(O=0;O<L;O++)d.pinfo.pcmdata[c][O]=d.pinfo.pcmdata[c][O+r.framesize];for(O=L;O<1600;O++)d.pinfo.pcmdata[c][O]=l[c][O-L]}B.set_frame_pinfo(r,f)}return function(r){var t,n;for(V(0<=r.bitrate_index&&r.bitrate_index<16),V(0<=r.mode_ext&&r.mode_ext<4),r.bitrate_stereoMode_Hist[r.bitrate_index][4]++,r.bitrate_stereoMode_Hist[15][4]++,2==r.channels_out&&(r.bitrate_stereoMode_Hist[r.bitrate_index][r.mode_ext]++,r.bitrate_stereoMode_Hist[15][r.mode_ext]++),t=0;t<r.mode_gr;++t)for(n=0;n<r.channels_out;++n){var i=0|r.l3_side.tt[t][n].block_type;0!=r.l3_side.tt[t][n].mixed_block_flag&&(i=4),r.bitrate_blockType_Hist[r.bitrate_index][i]++,r.bitrate_blockType_Hist[r.bitrate_index][5]++,r.bitrate_blockType_Hist[15][i]++,r.bitrate_blockType_Hist[15][5]++}}(d),s}}H.ENCDELAY=576,H.POSTDELAY=1152,H.FFTOFFSET=224+(H.MDCTDELAY=48),H.DECDELAY=528,H.SBLIMIT=32,H.CBANDS=64,H.SBPSY_l=21,H.SBPSY_s=12,H.SBMAX_l=22,H.SBMAX_s=13,H.PSFB21=6,H.PSFB12=6,H.HBLKSIZE=(H.BLKSIZE=1024)/2+1,H.HBLKSIZE_s=(H.BLKSIZE_s=256)/2+1,H.NORM_TYPE=0,H.START_TYPE=1,H.SHORT_TYPE=2,H.STOP_TYPE=3,H.MPG_MD_LR_LR=0,H.MPG_MD_LR_I=1,H.MPG_MD_MS_LR=2,H.MPG_MD_MS_I=3,H.fircoef=[-.1039435,-.1892065,5*-.0432472,-.155915,3898045e-23,.0467745*5,.50455,.756825,.187098*5];var yr=H,T=h.Util,m=h.new_float,p=function(){var l=m(yr.BLKSIZE),w=m(yr.BLKSIZE_s/2),R=[.9238795325112867,.3826834323650898,.9951847266721969,.0980171403295606,.9996988186962042,.02454122852291229,.9999811752826011,.006135884649154475];function M(r,t,n){var i,e,o,s=0,a=t+(n<<=1);i=4;do{var f,h,u,c,v,l,d;for(d=i>>1,l=(v=(c=i)<<1)+c,i=v<<1,o=(e=t)+d;b=r[e+0]-r[e+c],g=r[e+0]+r[e+c],A=r[e+v]-r[e+l],I=r[e+v]+r[e+l],r[e+v]=g-I,r[e+0]=g+I,r[e+l]=b-A,r[e+c]=b+A,b=r[o+0]-r[o+c],g=r[o+0]+r[o+c],A=T.SQRT2*r[o+l],I=T.SQRT2*r[o+v],r[o+v]=g-I,r[o+0]=g+I,r[o+l]=b-A,r[o+c]=b+A,o+=i,(e+=i)<a;);for(h=R[s+0],f=R[s+1],u=1;u<d;u++){var w,M;w=1-2*f*f,M=2*f*h,e=t+u,o=t+c-u;do{var E,m,_,g,b,p,I,y,A,k;m=M*r[e+c]-w*r[o+c],E=w*r[e+c]+M*r[o+c],b=r[e+0]-E,g=r[e+0]+E,p=r[o+0]-m,_=r[o+0]+m,m=M*r[e+l]-w*r[o+l],E=w*r[e+l]+M*r[o+l],A=r[e+v]-E,I=r[e+v]+E,k=r[o+v]-m,y=r[o+v]+m,m=f*I-h*k,E=h*I+f*k,r[e+v]=g-E,r[e+0]=g+E,r[o+l]=p-m,r[o+c]=p+m,m=h*y-f*A,E=f*y+h*A,r[o+v]=_-E,r[o+0]=_+E,r[e+l]=b-m,r[e+c]=b+m,o+=i,e+=i}while(e<a);h=(w=h)*R[s+0]-f*R[s+1],f=w*R[s+1]+f*R[s+0]}s+=2}while(i<n)}var E=[0,128,64,192,32,160,96,224,16,144,80,208,48,176,112,240,8,136,72,200,40,168,104,232,24,152,88,216,56,184,120,248,4,132,68,196,36,164,100,228,20,148,84,212,52,180,116,244,12,140,76,204,44,172,108,236,28,156,92,220,60,188,124,252,2,130,66,194,34,162,98,226,18,146,82,210,50,178,114,242,10,138,74,202,42,170,106,234,26,154,90,218,58,186,122,250,6,134,70,198,38,166,102,230,22,150,86,214,54,182,118,246,14,142,78,206,46,174,110,238,30,158,94,222,62,190,126,254];this.fft_short=function(r,t,n,i,e){for(var o=0;o<3;o++){var s=yr.BLKSIZE_s/2,a=65535&192*(o+1),f=yr.BLKSIZE_s/8-1;do{var h,u,c,v,l,d=255&E[f<<2];h=w[d]*i[n][e+d+a],l=w[127-d]*i[n][e+d+a+128],u=h-l,h+=l,c=w[d+64]*i[n][e+d+a+64],l=w[63-d]*i[n][e+d+a+192],v=c-l,c+=l,s-=4,t[o][s+0]=h+c,t[o][s+2]=h-c,t[o][s+1]=u+v,t[o][s+3]=u-v,h=w[d+1]*i[n][e+d+a+1],l=w[126-d]*i[n][e+d+a+129],u=h-l,h+=l,c=w[d+65]*i[n][e+d+a+65],l=w[62-d]*i[n][e+d+a+193],v=c-l,c+=l,t[o][s+yr.BLKSIZE_s/2+0]=h+c,t[o][s+yr.BLKSIZE_s/2+2]=h-c,t[o][s+yr.BLKSIZE_s/2+1]=u+v,t[o][s+yr.BLKSIZE_s/2+3]=u-v}while(0<=--f);M(t[o],s,yr.BLKSIZE_s/2)}},this.fft_long=function(r,t,n,i,e){var o=yr.BLKSIZE/8-1,s=yr.BLKSIZE/2;do{var a,f,h,u,c,v=255&E[o];a=l[v]*i[n][e+v],c=l[v+512]*i[n][e+v+512],f=a-c,a+=c,h=l[v+256]*i[n][e+v+256],c=l[v+768]*i[n][e+v+768],u=h-c,h+=c,t[0+(s-=4)]=a+h,t[s+2]=a-h,t[s+1]=f+u,t[s+3]=f-u,a=l[v+1]*i[n][e+v+1],c=l[v+513]*i[n][e+v+513],f=a-c,a+=c,h=l[v+257]*i[n][e+v+257],c=l[v+769]*i[n][e+v+769],u=h-c,h+=c,t[s+yr.BLKSIZE/2+0]=a+h,t[s+yr.BLKSIZE/2+2]=a-h,t[s+yr.BLKSIZE/2+1]=f+u,t[s+yr.BLKSIZE/2+3]=f-u}while(0<=--o);M(t,s,yr.BLKSIZE/2)},this.init_fft=function(r){for(var t=0;t<yr.BLKSIZE;t++)l[t]=.42-.5*Math.cos(2*Math.PI*(t+.5)/yr.BLKSIZE)+.08*Math.cos(4*Math.PI*(t+.5)/yr.BLKSIZE);for(var t=0;t<yr.BLKSIZE_s/2;t++)w[t]=.5*(1-Math.cos(2*Math.PI*(t+.5)/yr.BLKSIZE_s))}},Ar=h.VbrMode,W=h.Float,kr=h.ShortBlock,I=h.Util,Rr=h.Arrays,Tr=h.new_float,Or=h.new_float_n,Pr=h.new_int,Lr=h.assert,K=function(){var A=new p,k=2.302585092994046,fr=2,hr=16,E=2,m=16,P=.34,e=1/217621504/(yr.BLKSIZE/2),ur=.3,cr=21,o=.2302585093;function _(r){return r}function g(r,t){for(var n=0,i=0;i<yr.BLKSIZE/2;++i)n+=r[i]*t.ATH.eql_w[i];return n*=e}function vr(r,t,n,i,e,o,s,a,f,h,u){var c=r.internal_flags;if(f<2)A.fft_long(c,i[e],f,h,u),A.fft_short(c,o[s],f,h,u);else if(2==f){for(var v=yr.BLKSIZE-1;0<=v;--v){var l=i[e+0][v],d=i[e+1][v];i[e+0][v]=(l+d)*I.SQRT2*.5,i[e+1][v]=(l-d)*I.SQRT2*.5}for(var w=2;0<=w;--w)for(var v=yr.BLKSIZE_s-1;0<=v;--v){var l=o[s+0][w][v],d=o[s+1][w][v];o[s+0][w][v]=(l+d)*I.SQRT2*.5,o[s+1][w][v]=(l-d)*I.SQRT2*.5}}t[0]=_(i[e+0][0]),t[0]*=t[0];for(var v=yr.BLKSIZE/2-1;0<=v;--v){var M=i[e+0][yr.BLKSIZE/2-v],E=i[e+0][yr.BLKSIZE/2+v];t[yr.BLKSIZE/2-v]=_(.5*(M*M+E*E))}for(var w=2;0<=w;--w){n[w][0]=o[s+0][w][0],n[w][0]*=n[w][0];for(var v=yr.BLKSIZE_s/2-1;0<=v;--v){var M=o[s+0][w][yr.BLKSIZE_s/2-v],E=o[s+0][w][yr.BLKSIZE_s/2+v];n[w][yr.BLKSIZE_s/2-v]=_(.5*(M*M+E*E))}}for(var m=0,v=11;v<yr.HBLKSIZE;v++)m+=t[v];if(c.tot_ener[f]=m,r.analysis){for(var v=0;v<yr.HBLKSIZE;v++)c.pinfo.energy[a][f][v]=c.pinfo.energy_save[f][v],c.pinfo.energy_save[f][v]=t[v];c.pinfo.pe[a][f]=c.pe[f]}2==r.athaa_loudapprox&&f<2&&(c.loudness_sq[a][f]=c.loudness_sq_save[f],c.loudness_sq_save[f]=g(t,c))}var R,T,O,L=8,N=23,S=15,lr=[1,.79433,.63096,.63096,.63096,.63096,.63096,.25119,.11749],u=[3.3246*3.3246,3.23837*3.23837,9.9500500969,9.0247369744,8.1854926609,7.0440875649,2.46209*2.46209,2.284*2.284,4.4892710641,1.96552*1.96552,1.82335*1.82335,1.69146*1.69146,2.4621061921,2.1508568964,1.37074*1.37074,1.31036*1.31036,1.5691069696,1.4555939904,1.16203*1.16203,1.2715945225,1.09428*1.09428,1.0659*1.0659,1.0779838276,1.0382591025,1],c=[1.7782755904,1.35879*1.35879,1.38454*1.38454,1.39497*1.39497,1.40548*1.40548,1.3537*1.3537,1.6999465924,1.22321*1.22321,1.3169398564,1],v=[5.5396212496,2.29259*2.29259,4.9868695969,2.12675*2.12675,2.02545*2.02545,1.87894*1.87894,1.74303*1.74303,1.61695*1.61695,2.2499700001,1.39148*1.39148,1.29083*1.29083,1.19746*1.19746,1.2339655056,1.0779838276];function dr(r,t,n,i,e,o){var s;if(r<t){if(!(t<r*T))return r+t;s=t/r}else{if(t*T<=r)return r+t;s=r/t}if(r+=t,i+3<=6){if(R<=s)return r;var a=0|I.FAST_LOG10_X(s,16);return r*c[a]}var f,h,a=0|I.FAST_LOG10_X(s,16);return t=0!=o?e.ATH.cb_s[n]*e.ATH.adjust:e.ATH.cb_l[n]*e.ATH.adjust,r<O*t?t<r?(f=1,a<=13&&(f=v[a]),h=I.FAST_LOG10_X(r/t,10/15),r*((u[a]-f)*h+f)):13<a?r:r*v[a]:r*u[a]}var s=[1.7782755904,1.35879*1.35879,1.38454*1.38454,1.39497*1.39497,1.40548*1.40548,1.3537*1.3537,1.6999465924,1.22321*1.22321,1.3169398564,1];function y(r,t,n){var i;if(r<0&&(r=0),t<0&&(t=0),r<=0)return t;if(t<=0)return r;if(i=r<t?t/r:r/t,-2<=n&&n<=2){if(R<=i)return r+t;var e=0|I.FAST_LOG10_X(i,16);return(r+t)*s[e]}return i<T?r+t:(r<t&&(r=t),r)}function wr(r,t,n,i,e){var o,s,a=0,f=0;for(o=s=0;o<yr.SBMAX_s;++s,++o){for(var h=r.bo_s[o],u=r.npart_s,c=h<u?h:u;s<c;)Lr(0<=t[s]),Lr(0<=n[s]),a+=t[s],f+=n[s],s++;if(r.en[i].s[o][e]=a,r.thm[i].s[o][e]=f,u<=s){++o;break}Lr(0<=t[s]),Lr(0<=n[s]);var v=r.PSY.bo_s_weight[o],l=1-v;a=v*t[s],f=v*n[s],r.en[i].s[o][e]+=a,r.thm[i].s[o][e]+=f,a=l*t[s],f=l*n[s]}for(;o<yr.SBMAX_s;++o)r.en[i].s[o][e]=0,r.thm[i].s[o][e]=0}function Mr(r,t,n,i){var e,o,s=0,a=0;for(e=o=0;e<yr.SBMAX_l;++o,++e){for(var f=r.bo_l[e],h=r.npart_l,u=f<h?f:h;o<u;)Lr(0<=t[o]),Lr(0<=n[o]),s+=t[o],a+=n[o],o++;if(r.en[i].l[e]=s,r.thm[i].l[e]=a,h<=o){++e;break}Lr(0<=t[o]),Lr(0<=n[o]);var c=r.PSY.bo_l_weight[e],v=1-c;s=c*t[o],a=c*n[o],r.en[i].l[e]+=s,r.thm[i].l[e]+=a,s=v*t[o],a=v*n[o]}for(;e<yr.SBMAX_l;++e)r.en[i].l[e]=0,r.thm[i].l[e]=0}function Er(r,t,n,i,e,o){var s,a,f=r.internal_flags;for(a=s=0;a<f.npart_s;++a){for(var h=0,u=f.numlines_s[a],c=0;c<u;++c,++s){var v=t[o][s];h+=v}n[a]=h}for(Lr(a==f.npart_s),s=a=0;a<f.npart_s;a++){var l=f.s3ind_s[a][0],d=f.s3_ss[s++]*n[l];for(++l;l<=f.s3ind_s[a][1];)d+=f.s3_ss[s]*n[l],++s,++l;var w=E*f.nb_s1[e][a];if(i[a]=Math.min(d,w),f.blocktype_old[1&e]==yr.SHORT_TYPE){var w=m*f.nb_s2[e][a],M=i[a];i[a]=Math.min(w,M)}f.nb_s2[e][a]=f.nb_s1[e][a],f.nb_s1[e][a]=d,Lr(0<=i[a])}for(;a<=yr.CBANDS;++a)n[a]=0,i[a]=0}function mr(r,t,n){return 1<=n?r:n<=0?t:0<t?Math.pow(r/t,n)*t:0}var f=[11.8,13.6,17.2,32,46.5,51.3,57.5,67.1,71.5,84.6,97.6,130];function _r(r,t){for(var n=309.07,i=0;i<yr.SBMAX_s-1;i++)for(var e=0;e<3;e++){var o=r.thm.s[i][e];if(0<o){var s=o*t,a=r.en.s[i][e];s<a&&(n+=1e10*s<a?f[i]*(10*k):f[i]*I.FAST_LOG10(a/s))}}return n}var a=[6.8,5.8,5.8,6.4,6.5,9.9,12.1,14.4,15,18.9,21.6,26.9,34.2,40.2,46.8,56.5,60.7,73.9,85.7,93.4,126.1];function gr(r,t){for(var n=281.0575,i=0;i<yr.SBMAX_l-1;i++){var e=r.thm.l[i];if(0<e){var o=e*t,s=r.en.l[i];o<s&&(n+=1e10*o<s?a[i]*(10*k):a[i]*I.FAST_LOG10(s/o))}}return n}function br(r,t,n,i,e){var o,s;for(o=s=0;o<r.npart_l;++o){var a,f=0,h=0;for(a=0;a<r.numlines_l[o];++a,++s){var u=t[s];f+=u,h<u&&(h=u)}n[o]=f,i[o]=h,e[o]=f*r.rnumlines_l[o],Lr(0<=r.rnumlines_l[o]),Lr(0<=n[o]),Lr(0<=i[o]),Lr(0<=e[o])}}function pr(r,t,n,i){var e=lr.length-1,o=0,s=n[o]+n[o+1];if(0<s){var a=t[o];a<t[o+1]&&(a=t[o+1]),Lr(0<r.numlines_l[o]+r.numlines_l[o+1]-1);var f=0|(s=20*(2*a-s)/(s*(r.numlines_l[o]+r.numlines_l[o+1]-1)));e<f&&(f=e),i[o]=f}else i[o]=0;for(o=1;o<r.npart_l-1;o++)if(0<(s=n[o-1]+n[o]+n[o+1])){var a=t[o-1];a<t[o]&&(a=t[o]),a<t[o+1]&&(a=t[o+1]),Lr(0<r.numlines_l[o-1]+r.numlines_l[o]+r.numlines_l[o+1]-1);var f=0|(s=20*(3*a-s)/(s*(r.numlines_l[o-1]+r.numlines_l[o]+r.numlines_l[o+1]-1)));e<f&&(f=e),i[o]=f}else i[o]=0;if(Lr(o==r.npart_l-1),0<(s=n[o-1]+n[o])){var a=t[o-1];a<t[o]&&(a=t[o]),Lr(0<r.numlines_l[o-1]+r.numlines_l[o]-1);var f=0|(s=20*(2*a-s)/(s*(r.numlines_l[o-1]+r.numlines_l[o]-1)));e<f&&(f=e),i[o]=f}else i[o]=0;Lr(o==r.npart_l-1)}var Ir=[-1730326e-23,-.01703172,-1349528e-23,.0418072,-673278e-22,-.0876324,-30835e-21,.1863476,-1104424e-22,-.627638];function Y(r,t,n,i,e,o,s,a){var f=r.internal_flags;if(i<2)A.fft_long(f,s[a],i,t,n);else if(2==i)for(var h=yr.BLKSIZE-1;0<=h;--h){var u=s[a+0][h],c=s[a+1][h];s[a+0][h]=(u+c)*I.SQRT2*.5,s[a+1][h]=(u-c)*I.SQRT2*.5}o[0]=_(s[a+0][0]),o[0]*=o[0];for(var h=yr.BLKSIZE/2-1;0<=h;--h){var v=s[a+0][yr.BLKSIZE/2-h],l=s[a+0][yr.BLKSIZE/2+h];o[yr.BLKSIZE/2-h]=_(.5*(v*v+l*l))}for(var d=0,h=11;h<yr.HBLKSIZE;h++)d+=o[h];if(f.tot_ener[i]=d,r.analysis){for(var h=0;h<yr.HBLKSIZE;h++)f.pinfo.energy[e][i][h]=f.pinfo.energy_save[i][h],f.pinfo.energy_save[i][h]=o[h];f.pinfo.pe[e][i]=f.pe[i]}}function D(r,t,n,i,e,o,s,a){var f=r.internal_flags;if(0==e&&i<2&&A.fft_short(f,s[a],i,t,n),2==i)for(var h=yr.BLKSIZE_s-1;0<=h;--h){var u=s[a+0][e][h],c=s[a+1][e][h];s[a+0][e][h]=(u+c)*I.SQRT2*.5,s[a+1][e][h]=(u-c)*I.SQRT2*.5}o[e][0]=s[a+0][e][0],o[e][0]*=o[e][0];for(var h=yr.BLKSIZE_s/2-1;0<=h;--h){var v=s[a+0][e][yr.BLKSIZE_s/2-h],l=s[a+0][e][yr.BLKSIZE_s/2+h];o[e][yr.BLKSIZE_s/2-h]=_(.5*(v*v+l*l))}}function B(r,t,n,i){var e=r.internal_flags;2==r.athaa_loudapprox&&n<2&&(e.loudness_sq[t][n]=e.loudness_sq_save[n],e.loudness_sq_save[n]=g(i,e))}this.L3psycho_anal_ns=function(r,t,n,i,e,o,s,a,f,h){var u,c,v,l,d,w,M,E,m,_,g=r.internal_flags,b=Or([2,yr.BLKSIZE]),p=Or([2,3,yr.BLKSIZE_s]),I=Tr(yr.CBANDS+1),y=Tr(yr.CBANDS+1),A=Tr(yr.CBANDS+2),k=Pr(2),R=Pr(2),T=Or([2,576]),O=Pr(yr.CBANDS+2),P=Pr(yr.CBANDS+2);for(Rr.fill(P,0),u=g.channels_out,r.mode==MPEGMode.JOINT_STEREO&&(u=4),m=r.VBR==Ar.vbr_off?0==g.ResvMax?0:g.ResvSize/g.ResvMax*.5:r.VBR==Ar.vbr_rh||r.VBR==Ar.vbr_mtrh||r.VBR==Ar.vbr_mt?.6:1,c=0;c<g.channels_out;c++){var L=t[c],N=n+576-350-cr+192;for(l=0;l<576;l++){var S,Y;for(S=L[N+l+10],d=Y=0;d<(cr-1)/2-1;d+=2)S+=Ir[d]*(L[N+l+d]+L[N+l+cr-d]),Y+=Ir[d+1]*(L[N+l+d+1]+L[N+l+cr-d-1]);T[c][l]=S+Y}e[i][c].en.assign(g.en[c]),e[i][c].thm.assign(g.thm[c]),2<u&&(o[i][c].en.assign(g.en[c+2]),o[i][c].thm.assign(g.thm[c+2]))}for(c=0;c<u;c++){var D,B=Tr(12),F=[0,0,0,0],C=Tr(12),j=1,G=Tr(yr.CBANDS),U=Tr(yr.CBANDS),X=[0,0,0,0],x=Tr(yr.HBLKSIZE),V=Or([3,yr.HBLKSIZE_s]);for(Lr(g.npart_s<=yr.CBANDS),Lr(g.npart_l<=yr.CBANDS),l=0;l<3;l++)B[l]=g.nsPsy.last_en_subshort[c][l+6],Lr(0<g.nsPsy.last_en_subshort[c][l+4]),C[l]=B[l]/g.nsPsy.last_en_subshort[c][l+4],F[0]+=B[l];if(2==c)for(l=0;l<576;l++){var H,K;H=T[0][l],K=T[1][l],T[0][l]=H+K,T[1][l]=H-K}var W=T[1&c],z=0;for(l=0;l<9;l++){for(var Q=z+64,q=1;z<Q;z++)q<Math.abs(W[z])&&(q=Math.abs(W[z]));g.nsPsy.last_en_subshort[c][l]=B[l+3]=q,F[1+l/3]+=q,q>B[l+3-2]?q/=B[l+3-2]:q=B[l+3-2]>10*q?B[l+3-2]/(10*q):0,C[l+3]=q}if(r.analysis){var J=C[0];for(l=1;l<12;l++)J<C[l]&&(J=C[l]);g.pinfo.ers[i][c]=g.pinfo.ers_save[c],g.pinfo.ers_save[c]=J}for(D=3==c?g.nsPsy.attackthre_s:g.nsPsy.attackthre,l=0;l<12;l++)0==X[l/3]&&C[l]>D&&(X[l/3]=l%3+1);for(l=1;l<4;l++)(F[l-1]>F[l]?F[l-1]/F[l]:F[l]/F[l-1])<1.7&&(X[l]=0,1==l&&(X[0]=0));for(0!=X[0]&&0!=g.nsPsy.lastAttacks[c]&&(X[0]=0),3!=g.nsPsy.lastAttacks[c]&&X[0]+X[1]+X[2]+X[3]==0||((j=0)!=X[1]&&0!=X[0]&&(X[1]=0),0!=X[2]&&0!=X[1]&&(X[2]=0),0!=X[3]&&0!=X[2]&&(X[3]=0)),c<2?R[c]=j:0==j&&(R[0]=R[1]=0),f[c]=g.tot_ener[c],vr(r,x,V,b,1&c,p,1&c,i,c,t,n),br(g,x,I,G,U),pr(g,G,U,O),E=0;E<3;E++){var Z,$;for(Er(r,V,y,A,c,E),wr(g,y,A,c,E),M=0;M<yr.SBMAX_s;M++){if($=g.thm[c].s[M][E],$*=.8,2<=X[E]||1==X[E+1]){var rr=0!=E?E-1:2,q=mr(g.thm[c].s[M][rr],$,.6*m);$=Math.min($,q)}if(1==X[E]){var rr=0!=E?E-1:2,q=mr(g.thm[c].s[M][rr],$,ur*m);$=Math.min($,q)}else if(0!=E&&3==X[E-1]||0==E&&3==g.nsPsy.lastAttacks[c]){var rr=2!=E?E+1:0,q=mr(g.thm[c].s[M][rr],$,ur*m);$=Math.min($,q)}Z=B[3*E+3]+B[3*E+4]+B[3*E+5],6*B[3*E+5]<Z&&($*=.5,6*B[3*E+4]<Z&&($*=.5)),g.thm[c].s[M][E]=$}}for(g.nsPsy.lastAttacks[c]=X[2],v=w=0;v<g.npart_l;v++){for(var tr=g.s3ind[v][0],nr=I[tr]*lr[O[tr]],ir=g.s3_ll[w++]*nr;++tr<=g.s3ind[v][1];)nr=I[tr]*lr[O[tr]],ir=dr(ir,g.s3_ll[w++]*nr,tr,tr-v,g,0);ir*=.158489319246111,g.blocktype_old[1&c]==yr.SHORT_TYPE?A[v]=ir:A[v]=mr(Math.min(ir,Math.min(fr*g.nb_1[c][v],hr*g.nb_2[c][v])),ir,m),g.nb_2[c][v]=g.nb_1[c][v],g.nb_1[c][v]=ir}for(;v<=yr.CBANDS;++v)I[v]=0,A[v]=0;Mr(g,I,A,c)}for(r.mode!=MPEGMode.STEREO&&r.mode!=MPEGMode.JOINT_STEREO||0<r.interChRatio&&function(r,t){var n=r.internal_flags;if(1<n.channels_out){for(var i=0;i<yr.SBMAX_l;i++){var e=n.thm[0].l[i],o=n.thm[1].l[i];n.thm[0].l[i]+=o*t,n.thm[1].l[i]+=e*t}for(var i=0;i<yr.SBMAX_s;i++)for(var s=0;s<3;s++){var e=n.thm[0].s[i][s],o=n.thm[1].s[i][s];n.thm[0].s[i][s]+=o*t,n.thm[1].s[i][s]+=e*t}}}(r,r.interChRatio),r.mode==MPEGMode.JOINT_STEREO&&(function(r){for(var t=0;t<yr.SBMAX_l;t++)if(!(r.thm[0].l[t]>1.58*r.thm[1].l[t]||r.thm[1].l[t]>1.58*r.thm[0].l[t])){var n=r.mld_l[t]*r.en[3].l[t],i=Math.max(r.thm[2].l[t],Math.min(r.thm[3].l[t],n));n=r.mld_l[t]*r.en[2].l[t];var e=Math.max(r.thm[3].l[t],Math.min(r.thm[2].l[t],n));r.thm[2].l[t]=i,r.thm[3].l[t]=e}for(var t=0;t<yr.SBMAX_s;t++)for(var o=0;o<3;o++)if(!(r.thm[0].s[t][o]>1.58*r.thm[1].s[t][o]||r.thm[1].s[t][o]>1.58*r.thm[0].s[t][o])){var n=r.mld_s[t]*r.en[3].s[t][o],i=Math.max(r.thm[2].s[t][o],Math.min(r.thm[3].s[t][o],n));n=r.mld_s[t]*r.en[2].s[t][o];var e=Math.max(r.thm[3].s[t][o],Math.min(r.thm[2].s[t][o],n));r.thm[2].s[t][o]=i,r.thm[3].s[t][o]=e}}(g),_=r.msfix,0<Math.abs(_)&&function(r,t,n){var i=t,e=Math.pow(10,n);t*=2,i*=2;for(var o=0;o<yr.SBMAX_l;o++){if(c=r.ATH.cb_l[r.bm_l[o]]*e,f=Math.min(Math.max(r.thm[0].l[o],c),Math.max(r.thm[1].l[o],c)),h=Math.max(r.thm[2].l[o],c),u=Math.max(r.thm[3].l[o],c),f*t<h+u){var s=f*i/(h+u);h*=s,u*=s}r.thm[2].l[o]=Math.min(h,r.thm[2].l[o]),r.thm[3].l[o]=Math.min(u,r.thm[3].l[o])}e*=yr.BLKSIZE_s/yr.BLKSIZE;for(var o=0;o<yr.SBMAX_s;o++)for(var a=0;a<3;a++){var f,h,u,c;if(c=r.ATH.cb_s[r.bm_s[o]]*e,f=Math.min(Math.max(r.thm[0].s[o][a],c),Math.max(r.thm[1].s[o][a],c)),h=Math.max(r.thm[2].s[o][a],c),u=Math.max(r.thm[3].s[o][a],c),f*t<h+u){var s=f*t/(h+u);h*=s,u*=s}r.thm[2].s[o][a]=Math.min(r.thm[2].s[o][a],h),r.thm[3].s[o][a]=Math.min(r.thm[3].s[o][a],u)}}(g,_,r.ATHlower*g.ATH.adjust)),function(r,t,n,i){var e=r.internal_flags;r.short_blocks!=kr.short_block_coupled||0!=t[0]&&0!=t[1]||(t[0]=t[1]=0);for(var o=0;o<e.channels_out;o++)i[o]=yr.NORM_TYPE,r.short_blocks==kr.short_block_dispensed&&(t[o]=1),r.short_blocks==kr.short_block_forced&&(t[o]=0),0!=t[o]?(Lr(e.blocktype_old[o]!=yr.START_TYPE),e.blocktype_old[o]==yr.SHORT_TYPE&&(i[o]=yr.STOP_TYPE)):(i[o]=yr.SHORT_TYPE,e.blocktype_old[o]==yr.NORM_TYPE&&(e.blocktype_old[o]=yr.START_TYPE),e.blocktype_old[o]==yr.STOP_TYPE&&(e.blocktype_old[o]=yr.SHORT_TYPE)),n[o]=e.blocktype_old[o],e.blocktype_old[o]=i[o]}(r,R,h,k),c=0;c<u;c++){var er,or,sr,ar=0;1<c?(er=a,ar=-2,or=yr.NORM_TYPE,h[0]!=yr.SHORT_TYPE&&h[1]!=yr.SHORT_TYPE||(or=yr.SHORT_TYPE),sr=o[i][c-2]):(er=s,ar=0,or=h[c],sr=e[i][c]),or==yr.SHORT_TYPE?er[ar+c]=_r(sr,g.masking_lower):er[ar+c]=gr(sr,g.masking_lower),r.analysis&&(g.pinfo.pe[i][c]=er[ar+c])}return 0};var F=[-1730326e-23,-.01703172,-1349528e-23,.0418072,-673278e-22,-.0876324,-30835e-21,.1863476,-1104424e-22,-.627638];function C(r,t,n){if(0==n)for(var i=0;i<r.npart_s;i++)r.nb_s2[t][i]=r.nb_s1[t][i],r.nb_s1[t][i]=0}function j(r,t){for(var n=0;n<r.npart_l;n++)r.nb_2[t][n]=r.nb_1[t][n],r.nb_1[t][n]=0}function G(r,t,n,i,e,o){var s,a,f,h=r.internal_flags,u=new float[yr.CBANDS],c=Tr(yr.CBANDS),v=new int[yr.CBANDS];for(f=a=0;f<h.npart_s;++f){var l=0,d=0,w=h.numlines_s[f];for(s=0;s<w;++s,++a){var M=t[o][a];l+=M,d<M&&(d=M)}n[f]=l,u[f]=d,c[f]=l/w}for(Lr(f==h.npart_s);f<yr.CBANDS;++f)u[f]=0,c[f]=0;for(function(r,t,n,i){var e=lr.length-1,o=0,s=n[o]+n[o+1];if(0<s){var a=t[o];a<t[o+1]&&(a=t[o+1]),Lr(0<r.numlines_s[o]+r.numlines_s[o+1]-1);var f=0|(s=20*(2*a-s)/(s*(r.numlines_s[o]+r.numlines_s[o+1]-1)));e<f&&(f=e),i[o]=f}else i[o]=0;for(o=1;o<r.npart_s-1;o++)if(s=n[o-1]+n[o]+n[o+1],Lr(o+1<r.npart_s),0<s){var a=t[o-1];a<t[o]&&(a=t[o]),a<t[o+1]&&(a=t[o+1]),Lr(0<r.numlines_s[o-1]+r.numlines_s[o]+r.numlines_s[o+1]-1);var f=0|(s=20*(3*a-s)/(s*(r.numlines_s[o-1]+r.numlines_s[o]+r.numlines_s[o+1]-1)));e<f&&(f=e),i[o]=f}else i[o]=0;if(Lr(o==r.npart_s-1),0<(s=n[o-1]+n[o])){var a=t[o-1];a<t[o]&&(a=t[o]),Lr(0<r.numlines_s[o-1]+r.numlines_s[o]-1);var f=0|(s=20*(2*a-s)/(s*(r.numlines_s[o-1]+r.numlines_s[o]-1)));e<f&&(f=e),i[o]=f}else i[o]=0;Lr(o==r.npart_s-1)}(h,u,c,v),a=f=0;f<h.npart_s;f++){var E,m,_,g,b,p=h.s3ind_s[f][0],I=h.s3ind_s[f][1];for(E=v[p],m=1,g=h.s3_ss[a]*n[p]*lr[v[p]],++a,++p;p<=I;)E+=v[p],m+=1,_=h.s3_ss[a]*n[p]*lr[v[p]],g=y(g,_,p-f),++a,++p;b=.5*lr[E=(1+2*E)/(2*m)],g*=b,i[f]=g,h.nb_s2[e][f]=h.nb_s1[e][f],h.nb_s1[e][f]=g,_=u[f],_*=h.minval_s[f],_*=b,i[f]>_&&(i[f]=_),1<h.masking_lower&&(i[f]*=h.masking_lower),i[f]>n[f]&&(i[f]=n[f]),h.masking_lower<1&&(i[f]*=h.masking_lower),Lr(0<=i[f])}for(;f<yr.CBANDS;++f)n[f]=0,i[f]=0}function U(r,t,n,i,e){var o,s=Tr(yr.CBANDS),a=Tr(yr.CBANDS),f=Pr(yr.CBANDS+2);br(r,t,n,s,a),pr(r,s,a,f);var h=0;for(o=0;o<r.npart_l;o++){var u,c,v,l,d=r.s3ind[o][0],w=r.s3ind[o][1],M=0,E=0;for(M=f[d],E+=1,c=r.s3_ll[h]*n[d]*lr[f[d]],++h,++d;d<=w;)M+=f[d],E+=1,u=r.s3_ll[h]*n[d]*lr[f[d]],l=y(c,u,d-o),c=l,++h,++d;if(v=.5*lr[M=(1+2*M)/(2*E)],c*=v,r.blocktype_old[1&e]==yr.SHORT_TYPE){var m=fr*r.nb_1[e][o];i[o]=0<m?Math.min(c,m):Math.min(c,n[o]*ur)}else{var _=hr*r.nb_2[e][o],g=fr*r.nb_1[e][o];_<=0&&(_=c),g<=0&&(g=c),m=r.blocktype_old[1&e]==yr.NORM_TYPE?Math.min(g,_):g,i[o]=Math.min(c,m)}r.nb_2[e][o]=r.nb_1[e][o],r.nb_1[e][o]=c,u=s[o],u*=r.minval_l[o],u*=v,i[o]>u&&(i[o]=u),1<r.masking_lower&&(i[o]*=r.masking_lower),i[o]>n[o]&&(i[o]=n[o]),r.masking_lower<1&&(i[o]*=r.masking_lower),Lr(0<=i[o])}for(;o<yr.CBANDS;++o)n[o]=0,i[o]=0}function X(r,t,n,i,e,o,s){for(var a,f,h=2*o,u=0<o?Math.pow(10,e):1,c=0;c<s;++c){var v=r[2][c],l=r[3][c],d=t[0][c],w=t[1][c],M=t[2][c],E=t[3][c];if(d<=1.58*w&&w<=1.58*d){var m=n[c]*l,_=n[c]*v;f=Math.max(M,Math.min(E,m)),a=Math.max(E,Math.min(M,_))}else f=M,a=E;if(0<o){var g,b,p=i[c]*u;if(g=Math.min(Math.max(d,p),Math.max(w,p)),M=Math.max(f,p),E=Math.max(a,p),0<(b=M+E)&&g*h<b){var I=g*h/b;M*=I,E*=I}f=Math.min(M,f),a=Math.min(E,a)}v<f&&(f=v),l<a&&(a=l),t[2][c]=f,t[3][c]=a}}function w(r,t){var n,i=r;return(n=0<=i?27*-i:i*t)<=-72?0:Math.exp(n*o)}function M(r){var t=0,n=0,i=0;for(i=0;1e-20<w(i,r);i-=1);for(e=i,o=0;1e-12<Math.abs(o-e);)0<w(i=(o+e)/2,r)?o=i:e=i;t=e;var e,o,i=0;for(i=0;1e-20<w(i,r);i+=1);for(e=0,o=i;1e-12<Math.abs(o-e);)0<w(i=(o+e)/2,r)?e=i:o=i;n=o;var s,a=0;for(s=0;s<=1e3;++s){var i=t+s*(n-t)/1e3,f=w(i,r);a+=f}var h=1001/(a*(n-t));return h}function b(r){var t,n,i,e;return t=r,n=.5<=(t*=0<=t?3:1.5)&&t<=2.5?8*((e=t-.5)*e-2*e):0,(i=15.811389+7.5*(t+=.474)-17.5*Math.sqrt(1+t*t))<=-60?0:(t=Math.exp((n+i)*o),t/=.6609193)}function x(r){return r<0&&(r=0),r*=.001,13*Math.atan(.76*r)+3.5*Math.atan(r*r/56.25)}function V(r,t,n,i,e,o,s,a,f,h,u,c){var v,l=Tr(yr.CBANDS+1),d=a/(15<c?1152:384),w=Pr(yr.HBLKSIZE);a/=f;var M=0,E=0;for(v=0;v<yr.CBANDS;v++){var m;for(R=x(a*M),l[v]=a*M,m=M;x(a*m)-R<P&&m<=f/2;m++);for(r[v]=m-M,E=v+1;M<m;)w[M++]=v;if(f/2<M){M=f/2,++v;break}}l[v]=a*M;for(var _=0;_<c;_++){var g,b,p,I,y;p=h[_],I=h[_+1],(g=0|Math.floor(.5+u*(p-.5)))<0&&(g=0),b=0|Math.floor(.5+u*(I-.5)),f/2<b&&(b=f/2),n[_]=(w[g]+w[b])/2,t[_]=w[b];var A=d*I;s[_]=(A-l[t[_]])/(l[t[_]+1]-l[t[_]]),s[_]<0?s[_]=0:1<s[_]&&(s[_]=1),y=x(a*h[_]*u),y=Math.min(y,15.5)/15.5,o[_]=Math.pow(10,1.25*(1-Math.cos(Math.PI*y))-2.5)}for(var k=M=0;k<E;k++){var R,T,O=r[k];R=x(a*M),T=x(a*(M+O-1)),i[k]=.5*(R+T),R=x(a*(M-.5)),T=x(a*(M+O-.5)),e[k]=T-R,M+=O}return E}function H(r,t,n,i,e,o){var s,a=Or([yr.CBANDS,yr.CBANDS]),f=0;if(o)for(var h=0;h<t;h++)for(s=0;s<t;s++){var u=b(n[h]-n[s])*i[s];a[h][s]=u*e[h]}else for(s=0;s<t;s++)for(var c=15+Math.min(21/n[s],12),v=M(c),h=0;h<t;h++){var u=v*w(n[h]-n[s],c)*i[s];a[h][s]=u*e[h]}for(var h=0;h<t;h++){for(s=0;s<t&&!(0<a[h][s]);s++);for(r[h][0]=s,s=t-1;0<s&&!(0<a[h][s]);s--);r[h][1]=s,f+=r[h][1]-r[h][0]+1}for(var l=Tr(f),d=0,h=0;h<t;h++)for(s=r[h][0];s<=r[h][1];s++)l[d++]=a[h][s];return l}function K(r){var t=x(r);return t=Math.min(t,15.5)/15.5,Math.pow(10,1.25*(1-Math.cos(Math.PI*t))-2.5)}function i(r,t){r<-.3&&(r=3410),r/=1e3,r=Math.max(.1,r);var n=3.64*Math.pow(r,-.8)-6.8*Math.exp(-.6*Math.pow(r-3.4,2))+6*Math.exp(-.15*Math.pow(r-8.7,2))+.001*(.6+.04*t)*Math.pow(r,4);return n}this.L3psycho_anal_vbr=function(r,t,n,i,e,o,s,a,f,h){var u=r.internal_flags,c=Tr(yr.HBLKSIZE),v=Or([3,yr.HBLKSIZE_s]),l=Or([2,yr.BLKSIZE]),d=Or([2,3,yr.BLKSIZE_s]),w=Or([4,yr.CBANDS]),M=Or([4,yr.CBANDS]),E=Or([4,3]),m=[[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0]],_=Pr(2),g=r.mode==MPEGMode.JOINT_STEREO?4:u.channels_out;!function(r,t,n,i,e,o,s,a,f,h){for(var u=Or([2,576]),c=r.internal_flags,v=c.channels_out,l=r.mode==MPEGMode.JOINT_STEREO?4:v,d=0;d<v;d++){firbuf=t[d];for(var w=n+576-350-cr+192,M=0;M<576;M++){var E,m;E=firbuf[w+M+10];for(var _=m=0;_<(cr-1)/2-1;_+=2)E+=F[_]*(firbuf[w+M+_]+firbuf[w+M+cr-_]),m+=F[_+1]*(firbuf[w+M+_+1]+firbuf[w+M+cr-_-1]);u[d][M]=E+m}e[i][d].en.assign(c.en[d]),e[i][d].thm.assign(c.thm[d]),2<l&&(o[i][d].en.assign(c.en[d+2]),o[i][d].thm.assign(c.thm[d+2]))}for(var d=0;d<l;d++){var g=Tr(12),b=Tr(12),p=[0,0,0,0],I=u[1&d],y=0,A=3==d?c.nsPsy.attackthre_s:c.nsPsy.attackthre,k=1;if(2==d)for(var M=0,_=576;0<_;++M,--_){var R=u[0][M],T=u[1][M];u[0][M]=R+T,u[1][M]=R-T}for(var M=0;M<3;M++)b[M]=c.nsPsy.last_en_subshort[d][M+6],Lr(0<c.nsPsy.last_en_subshort[d][M+4]),g[M]=b[M]/c.nsPsy.last_en_subshort[d][M+4],p[0]+=b[M];for(var M=0;M<9;M++){for(var O=y+64,P=1;y<O;y++)P<Math.abs(I[y])&&(P=Math.abs(I[y]));c.nsPsy.last_en_subshort[d][M]=b[M+3]=P,p[1+M/3]+=P,P>b[M+3-2]?P/=b[M+3-2]:P=b[M+3-2]>10*P?b[M+3-2]/(10*P):0,g[M+3]=P}for(var M=0;M<3;++M){var L=b[3*M+3]+b[3*M+4]+b[3*M+5],N=1;6*b[3*M+5]<L&&(N*=.5,6*b[3*M+4]<L&&(N*=.5)),a[d][M]=N}if(r.analysis){for(var S=g[0],M=1;M<12;M++)S<g[M]&&(S=g[M]);c.pinfo.ers[i][d]=c.pinfo.ers_save[d],c.pinfo.ers_save[d]=S}for(var M=0;M<12;M++)0==f[d][M/3]&&g[M]>A&&(f[d][M/3]=M%3+1);for(var M=1;M<4;M++){var Y=p[M-1],D=p[M],B=Math.max(Y,D);B<4e4&&Y<1.7*D&&D<1.7*Y&&(1==M&&f[d][0]<=f[d][M]&&(f[d][0]=0),f[d][M]=0)}f[d][0]<=c.nsPsy.lastAttacks[d]&&(f[d][0]=0),3!=c.nsPsy.lastAttacks[d]&&f[d][0]+f[d][1]+f[d][2]+f[d][3]==0||((k=0)!=f[d][1]&&0!=f[d][0]&&(f[d][1]=0),0!=f[d][2]&&0!=f[d][1]&&(f[d][2]=0),0!=f[d][3]&&0!=f[d][2]&&(f[d][3]=0)),d<2?h[d]=k:0==k&&(h[0]=h[1]=0),s[d]=c.tot_ener[d]}}(r,t,n,i,e,o,f,E,m,_),function(r,t){var n=r.internal_flags;r.short_blocks!=kr.short_block_coupled||0!=t[0]&&0!=t[1]||(t[0]=t[1]=0);for(var i=0;i<n.channels_out;i++)r.short_blocks==kr.short_block_dispensed&&(t[i]=1),r.short_blocks==kr.short_block_forced&&(t[i]=0)}(r,_);for(var b=0;b<g;b++){var p=1&b;Y(r,t,n,b,i,c,l,p),B(r,i,b,c),0!=_[p]?U(u,c,w[b],M[b],b):j(u,b)}_[0]+_[1]==2&&r.mode==MPEGMode.JOINT_STEREO&&X(w,M,u.mld_cb_l,u.ATH.cb_l,r.ATHlower*u.ATH.adjust,r.msfix,u.npart_l);for(var b=0;b<g;b++){var p=1&b;0!=_[p]&&Mr(u,w[b],M[b],b)}for(var I=0;I<3;I++){for(var b=0;b<g;++b){var p=1&b;0!=_[p]?C(u,b,I):(D(r,t,n,b,I,v,d,p),G(r,v,w[b],M[b],b,I))}_[0]+_[1]==0&&r.mode==MPEGMode.JOINT_STEREO&&X(w,M,u.mld_cb_s,u.ATH.cb_s,r.ATHlower*u.ATH.adjust,r.msfix,u.npart_s);for(var b=0;b<g;++b){var p=1&b;0==_[p]&&wr(u,w[b],M[b],b,I)}}for(var b=0;b<g;b++){var p=1&b;if(0==_[p])for(var y=0;y<yr.SBMAX_s;y++){for(var A=Tr(3),I=0;I<3;I++){var k=u.thm[b].s[y][I];if(k*=.8,2<=m[b][I]||1==m[b][I+1]){var R=0!=I?I-1:2,T=mr(u.thm[b].s[y][R],k,.36);k=Math.min(k,T)}else if(1==m[b][I]){var R=0!=I?I-1:2,T=mr(u.thm[b].s[y][R],k,.6*ur);k=Math.min(k,T)}else if(0!=I&&3==m[b][I-1]||0==I&&3==u.nsPsy.lastAttacks[b]){var R=2!=I?I+1:0,T=mr(u.thm[b].s[y][R],k,.6*ur);k=Math.min(k,T)}k*=E[b][I],A[I]=k}for(var I=0;I<3;I++)u.thm[b].s[y][I]=A[I]}}for(var b=0;b<g;b++)u.nsPsy.lastAttacks[b]=m[b][2];!function(r,t,n){for(var i=r.internal_flags,e=0;e<i.channels_out;e++){var o=yr.NORM_TYPE;0!=t[e]?(Lr(i.blocktype_old[e]!=yr.START_TYPE),i.blocktype_old[e]==yr.SHORT_TYPE&&(o=yr.STOP_TYPE)):(o=yr.SHORT_TYPE,i.blocktype_old[e]==yr.NORM_TYPE&&(i.blocktype_old[e]=yr.START_TYPE),i.blocktype_old[e]==yr.STOP_TYPE&&(i.blocktype_old[e]=yr.SHORT_TYPE)),n[e]=i.blocktype_old[e],i.blocktype_old[e]=o}}(r,_,h);for(var b=0;b<g;b++){var O,P,L,N;1<b?(O=a,P=-2,L=yr.NORM_TYPE,h[0]!=yr.SHORT_TYPE&&h[1]!=yr.SHORT_TYPE||(L=yr.SHORT_TYPE),N=o[i][b-2]):(O=s,P=0,L=h[b],N=e[i][b]),L==yr.SHORT_TYPE?O[P+b]=_r(N,u.masking_lower):O[P+b]=gr(N,u.masking_lower),r.analysis&&(u.pinfo.pe[i][b]=O[P+b])}return 0},this.psymodel_init=function(r){var t,n=r.internal_flags,i=!0,e=13,o=0,s=0,a=-8.25,f=-4.5,h=Tr(yr.CBANDS),u=Tr(yr.CBANDS),c=Tr(yr.CBANDS),v=r.out_samplerate;switch(r.experimentalZ){default:case 0:i=!0;break;case 1:i=r.VBR!=Ar.vbr_mtrh&&r.VBR!=Ar.vbr_mt;break;case 2:i=!1;break;case 3:e=8,o=-1.75,s=-.0125,a=-8.25,f=-2.25}for(n.ms_ener_ratio_old=.25,n.blocktype_old[0]=n.blocktype_old[1]=yr.NORM_TYPE,t=0;t<4;++t){for(var l=0;l<yr.CBANDS;++l)n.nb_1[t][l]=1e20,n.nb_2[t][l]=1e20,n.nb_s1[t][l]=n.nb_s2[t][l]=1;for(var d=0;d<yr.SBMAX_l;d++)n.en[t].l[d]=1e20,n.thm[t].l[d]=1e20;for(var l=0;l<3;++l){for(var d=0;d<yr.SBMAX_s;d++)n.en[t].s[d][l]=1e20,n.thm[t].s[d][l]=1e20;n.nsPsy.lastAttacks[t]=0}for(var l=0;l<9;l++)n.nsPsy.last_en_subshort[t][l]=10}for(n.loudness_sq_save[0]=n.loudness_sq_save[1]=0,n.npart_l=V(n.numlines_l,n.bo_l,n.bm_l,h,u,n.mld_l,n.PSY.bo_l_weight,v,yr.BLKSIZE,n.scalefac_band.l,yr.BLKSIZE/1152,yr.SBMAX_l),Lr(n.npart_l<yr.CBANDS),t=0;t<n.npart_l;t++){var w=o;h[t]>=e&&(w=s*(h[t]-e)/(24-e)+o*(24-h[t])/(24-e)),c[t]=Math.pow(10,w/10),0<n.numlines_l[t]?n.rnumlines_l[t]=1/n.numlines_l[t]:n.rnumlines_l[t]=0}n.s3_ll=H(n.s3ind,n.npart_l,h,u,c,i);var M,l=0;for(t=0;t<n.npart_l;t++){_=W.MAX_VALUE;for(var E=0;E<n.numlines_l[t];E++,l++){var m=v*l/(1e3*yr.BLKSIZE);g=this.ATHformula(1e3*m,r)-20,g=Math.pow(10,.1*g),(g*=n.numlines_l[t])<_&&(_=g)}n.ATH.cb_l[t]=_,6<(_=20*h[t]/10-20)&&(_=100),_<-15&&(_=-15),_-=8,n.minval_l[t]=Math.pow(10,_/10)*n.numlines_l[t]}for(n.npart_s=V(n.numlines_s,n.bo_s,n.bm_s,h,u,n.mld_s,n.PSY.bo_s_weight,v,yr.BLKSIZE_s,n.scalefac_band.s,yr.BLKSIZE_s/384,yr.SBMAX_s),Lr(n.npart_s<yr.CBANDS),t=l=0;t<n.npart_s;t++){var _,w=a;h[t]>=e&&(w=f*(h[t]-e)/(24-e)+a*(24-h[t])/(24-e)),c[t]=Math.pow(10,w/10),_=W.MAX_VALUE;for(var E=0;E<n.numlines_s[t];E++,l++){var g,m=v*l/(1e3*yr.BLKSIZE_s);g=this.ATHformula(1e3*m,r)-20,g=Math.pow(10,.1*g),(g*=n.numlines_s[t])<_&&(_=g)}n.ATH.cb_s[t]=_,_=7*h[t]/12-7,12<h[t]&&(_*=1+3.1*Math.log(1+_)),h[t]<12&&(_*=1+2.3*Math.log(1-_)),_<-15&&(_=-15),_-=8,n.minval_s[t]=Math.pow(10,_/10)*n.numlines_s[t]}n.s3_ss=H(n.s3ind_s,n.npart_s,h,u,c,i),R=Math.pow(10,(L+1)/16),T=Math.pow(10,(N+1)/16),O=Math.pow(10,S/10),A.init_fft(n),n.decay=Math.exp(-1*k/(.01*v/192)),M=3.5,0!=(2&r.exp_nspsytune)&&(M=1),0<Math.abs(r.msfix)&&(M=r.msfix),r.msfix=M;for(var b=0;b<n.npart_l;b++)n.s3ind[b][1]>n.npart_l-1&&(n.s3ind[b][1]=n.npart_l-1);var p=576*n.mode_gr/v;if(n.ATH.decay=Math.pow(10,-1.2*p),n.ATH.adjust=.01,n.ATH.adjustLimit=1,Lr(n.bo_l[yr.SBMAX_l-1]<=n.npart_l),Lr(n.bo_s[yr.SBMAX_s-1]<=n.npart_s),-1!=r.ATHtype){var I=r.out_samplerate/yr.BLKSIZE,y=0;for(t=m=0;t<yr.BLKSIZE/2;++t)m+=I,n.ATH.eql_w[t]=1/Math.pow(10,this.ATHformula(m,r)/10),y+=n.ATH.eql_w[t];for(y=1/y,t=yr.BLKSIZE/2;0<=--t;)n.ATH.eql_w[t]*=y}for(var b=l=0;b<n.npart_s;++b)for(t=0;t<n.numlines_s[b];++t)++l;for(var b=l=0;b<n.npart_l;++b)for(t=0;t<n.numlines_l[b];++t)++l;for(t=l=0;t<n.npart_l;t++){var m=v*(l+n.numlines_l[t]/2)/(1*yr.BLKSIZE);n.mld_cb_l[t]=K(m),l+=n.numlines_l[t]}for(;t<yr.CBANDS;++t)n.mld_cb_l[t]=1;for(t=l=0;t<n.npart_s;t++){var m=v*(l+n.numlines_s[t]/2)/(1*yr.BLKSIZE_s);n.mld_cb_s[t]=K(m),l+=n.numlines_s[t]}for(;t<yr.CBANDS;++t)n.mld_cb_s[t]=1;return 0},this.ATHformula=function(r,t){var n;switch(t.ATHtype){case 0:n=i(r,9);break;case 1:n=i(r,-1);break;case 2:n=i(r,0);break;case 3:n=i(r,1)+6;break;case 4:n=i(r,t.ATHcurve);break;default:n=i(r,0)}return n}};function E(r){var t=r;this.ordinal=function(){return t}}E.STEREO=new E(0),E.JOINT_STEREO=new E(1),E.DUAL_CHANNEL=new E(2),E.MONO=new E(3),E.NOT_SET=new E(4);var _=E,z=function(){this.class_id=0,this.num_samples=0,this.num_channels=0,this.in_samplerate=0,this.out_samplerate=0,this.scale=0,this.scale_left=0,this.scale_right=0,this.analysis=!1,this.bWriteVbrTag=!1,this.decode_only=!1,this.quality=0,this.mode=_.STEREO,this.force_ms=!1,this.free_format=!1,this.findReplayGain=!1,this.decode_on_the_fly=!1,this.write_id3tag_automatic=!1,this.brate=0,this.compression_ratio=0,this.copyright=0,this.original=0,this.extension=0,this.emphasis=0,this.error_protection=0,this.strict_ISO=!1,this.disable_reservoir=!1,this.quant_comp=0,this.quant_comp_short=0,this.experimentalY=!1,this.experimentalZ=0,this.exp_nspsytune=0,this.preset=0,this.VBR=null,this.VBR_q_frac=0,this.VBR_q=0,this.VBR_mean_bitrate_kbps=0,this.VBR_min_bitrate_kbps=0,this.VBR_max_bitrate_kbps=0,this.VBR_hard_min=0,this.lowpassfreq=0,this.highpassfreq=0,this.lowpasswidth=0,this.highpasswidth=0,this.maskingadjust=0,this.maskingadjust_short=0,this.ATHonly=!1,this.ATHshort=!1,this.noATH=!1,this.ATHtype=0,this.ATHcurve=0,this.ATHlower=0,this.athaa_type=0,this.athaa_loudapprox=0,this.athaa_sensitivity=0,this.short_blocks=null,this.useTemporal=!1,this.interChRatio=0,this.msfix=0,this.tune=!1,this.tune_value_a=0,this.version=0,this.encoder_delay=0,this.encoder_padding=0,this.framesize=0,this.frameNum=0,this.lame_allocated_gfp=0,this.internal_flags=null},g={};g.SFBMAX=3*yr.SBMAX_s;var k=g,b=h.new_float,y=h.new_int,R=function(){this.xr=b(576),this.l3_enc=y(576),this.scalefac=y(k.SFBMAX),this.xrpow_max=0,this.part2_3_length=0,this.big_values=0,this.count1=0,this.global_gain=0,this.scalefac_compress=0,this.block_type=0,this.mixed_block_flag=0,this.table_select=y(3),this.subblock_gain=y(4),this.region0_count=0,this.region1_count=0,this.preflag=0,this.scalefac_scale=0,this.count1table_select=0,this.part2_length=0,this.sfb_lmax=0,this.sfb_smin=0,this.psy_lmax=0,this.sfbmax=0,this.psymax=0,this.sfbdivide=0,this.width=y(k.SFBMAX),this.window=y(k.SFBMAX),this.count1bits=0,this.sfb_partition_table=null,this.slen=y(4),this.max_nonzero_coeff=0;var n=this;function i(r){return new Int32Array(r)}this.assign=function(r){var t;n.xr=(t=r.xr,new Float32Array(t)),n.l3_enc=i(r.l3_enc),n.scalefac=i(r.scalefac),n.xrpow_max=r.xrpow_max,n.part2_3_length=r.part2_3_length,n.big_values=r.big_values,n.count1=r.count1,n.global_gain=r.global_gain,n.scalefac_compress=r.scalefac_compress,n.block_type=r.block_type,n.mixed_block_flag=r.mixed_block_flag,n.table_select=i(r.table_select),n.subblock_gain=i(r.subblock_gain),n.region0_count=r.region0_count,n.region1_count=r.region1_count,n.preflag=r.preflag,n.scalefac_scale=r.scalefac_scale,n.count1table_select=r.count1table_select,n.part2_length=r.part2_length,n.sfb_lmax=r.sfb_lmax,n.sfb_smin=r.sfb_smin,n.psy_lmax=r.psy_lmax,n.sfbmax=r.sfbmax,n.psymax=r.psymax,n.sfbdivide=r.sfbdivide,n.width=i(r.width),n.window=i(r.window),n.count1bits=r.count1bits,n.sfb_partition_table=r.sfb_partition_table.slice(0),n.slen=i(r.slen),n.max_nonzero_coeff=r.max_nonzero_coeff}},A=h.new_int,O=function(){this.tt=[[null,null],[null,null]],this.main_data_begin=0,this.private_bits=0,this.resvDrain_pre=0,this.resvDrain_post=0,this.scfsi=[A(4),A(4)];for(var r=0;r<2;r++)for(var t=0;t<2;t++)this.tt[r][t]=new R},P=h.System,L=h.new_int,D=function(r,t,n,i){this.l=L(1+yr.SBMAX_l),this.s=L(1+yr.SBMAX_s),this.psfb21=L(1+yr.PSFB21),this.psfb12=L(1+yr.PSFB12);var e=this.l,o=this.s;4==arguments.length&&(this.arrL=r,this.arrS=t,this.arr21=n,this.arr12=i,P.arraycopy(this.arrL,0,e,0,Math.min(this.arrL.length,this.l.length)),P.arraycopy(this.arrS,0,o,0,Math.min(this.arrS.length,this.s.length)),P.arraycopy(this.arr21,0,this.psfb21,0,Math.min(this.arr21.length,this.psfb21.length)),P.arraycopy(this.arr12,0,this.psfb12,0,Math.min(this.arr12.length,this.psfb12.length)))},B=h.new_float,F=h.new_float_n,Q=h.new_int,q=function(){this.last_en_subshort=F([4,9]),this.lastAttacks=Q(4),this.pefirbuf=B(19),this.longfact=B(yr.SBMAX_l),this.shortfact=B(yr.SBMAX_s),this.attackthre=0,this.attackthre_s=0},J=function(){this.sum=0,this.seen=0,this.want=0,this.pos=0,this.size=0,this.bag=null,this.nVbrNumFrames=0,this.nBytesWritten=0,this.TotalFrameSize=0},Z=h.new_byte,$=h.new_double,rr=h.new_float,tr=h.new_float_n,nr=h.new_int,ir=h.new_int_n;function er(){var r=40;function t(){this.write_timing=0,this.ptr=0,this.buf=Z(r)}this.Class_ID=0,this.lame_encode_frame_init=0,this.iteration_init_init=0,this.fill_buffer_resample_init=0,this.mfbuf=tr([2,er.MFSIZE]),this.mode_gr=0,this.channels_in=0,this.channels_out=0,this.resample_ratio=0,this.mf_samples_to_encode=0,this.mf_size=0,this.VBR_min_bitrate=0,this.VBR_max_bitrate=0,this.bitrate_index=0,this.samplerate_index=0,this.mode_ext=0,this.lowpass1=0,this.lowpass2=0,this.highpass1=0,this.highpass2=0,this.noise_shaping=0,this.noise_shaping_amp=0,this.substep_shaping=0,this.psymodel=0,this.noise_shaping_stop=0,this.subblock_gain=0,this.use_best_huffman=0,this.full_outer_loop=0,this.l3_side=new O,this.ms_ratio=rr(2),this.padding=0,this.frac_SpF=0,this.slot_lag=0,this.tag_spec=null,this.nMusicCRC=0,this.OldValue=nr(2),this.CurrentStep=nr(2),this.masking_lower=0,this.bv_scf=nr(576),this.pseudohalf=nr(k.SFBMAX),this.sfb21_extra=!1,this.inbuf_old=new Array(2),this.blackfilt=new Array(2*er.BPC+1),this.itime=$(2),this.sideinfo_len=0,this.sb_sample=tr([2,2,18,yr.SBLIMIT]),this.amp_filter=rr(32),this.header=new Array(er.MAX_HEADER_BUF),this.h_ptr=0,this.w_ptr=0,this.ancillary_flag=0,this.ResvSize=0,this.ResvMax=0,this.scalefac_band=new D,this.minval_l=rr(yr.CBANDS),this.minval_s=rr(yr.CBANDS),this.nb_1=tr([4,yr.CBANDS]),this.nb_2=tr([4,yr.CBANDS]),this.nb_s1=tr([4,yr.CBANDS]),this.nb_s2=tr([4,yr.CBANDS]),this.s3_ss=null,this.s3_ll=null,this.decay=0,this.thm=new Array(4),this.en=new Array(4),this.tot_ener=rr(4),this.loudness_sq=tr([2,2]),this.loudness_sq_save=rr(2),this.mld_l=rr(yr.SBMAX_l),this.mld_s=rr(yr.SBMAX_s),this.bm_l=nr(yr.SBMAX_l),this.bo_l=nr(yr.SBMAX_l),this.bm_s=nr(yr.SBMAX_s),this.bo_s=nr(yr.SBMAX_s),this.npart_l=0,this.npart_s=0,this.s3ind=ir([yr.CBANDS,2]),this.s3ind_s=ir([yr.CBANDS,2]),this.numlines_s=nr(yr.CBANDS),this.numlines_l=nr(yr.CBANDS),this.rnumlines_l=rr(yr.CBANDS),this.mld_cb_l=rr(yr.CBANDS),this.mld_cb_s=rr(yr.CBANDS),this.numlines_s_num1=0,this.numlines_l_num1=0,this.pe=rr(4),this.ms_ratio_s_old=0,this.ms_ratio_l_old=0,this.ms_ener_ratio_old=0,this.blocktype_old=nr(2),this.nsPsy=new q,this.VBR_seek_table=new J,this.ATH=null,this.PSY=null,this.nogap_total=0,this.nogap_current=0,this.decode_on_the_fly=!0,this.findReplayGain=!0,this.findPeakSample=!0,this.PeakSample=0,this.RadioGain=0,this.AudiophileGain=0,this.rgdata=null,this.noclipGainChange=0,this.noclipScale=0,this.bitrate_stereoMode_Hist=ir([16,5]),this.bitrate_blockType_Hist=ir([16,6]),this.pinfo=null,this.hip=null,this.in_buffer_nsamples=0,this.in_buffer_0=null,this.in_buffer_1=null,this.iteration_loop=null;for(var n=0;n<this.en.length;n++)this.en[n]=new w;for(var n=0;n<this.thm.length;n++)this.thm[n]=new w;for(var n=0;n<this.header.length;n++)this.header[n]=new t}er.MFSIZE=3456+yr.ENCDELAY-yr.MDCTDELAY,er.MAX_HEADER_BUF=256,er.MAX_BITS_PER_CHANNEL=4095,er.MAX_BITS_PER_GRANULE=7680,er.BPC=320;var or=er,sr=h.new_float,ar=function(){this.useAdjust=0,this.aaSensitivityP=0,this.adjust=0,this.adjustLimit=0,this.decay=0,this.floor=0,this.l=sr(yr.SBMAX_l),this.s=sr(yr.SBMAX_s),this.psfb21=sr(yr.PSFB21),this.psfb12=sr(yr.PSFB12),this.cb_l=sr(yr.CBANDS),this.cb_s=sr(yr.CBANDS),this.eql_w=sr(yr.BLKSIZE/2)},fr=h.System,hr=h.Arrays;function ur(){var i=ur.RMS_WINDOW_TIME_NUMERATOR,e=ur.RMS_WINDOW_TIME_DENOMINATOR,E=[[.038575994352,-3.84664617118067,-.02160367184185,7.81501653005538,-.00123395316851,-11.34170355132042,-9291677959e-14,13.05504219327545,-.01655260341619,-12.28759895145294,.02161526843274,9.4829380631979,-.02074045215285,-5.87257861775999,.00594298065125,2.75465861874613,.00306428023191,-.86984376593551,.00012025322027,.13919314567432,.00288463683916],[.0541865640643,-3.47845948550071,-.02911007808948,6.36317777566148,-.00848709379851,-8.54751527471874,-.00851165645469,9.4769360780128,-.00834990904936,-8.81498681370155,.02245293253339,6.85401540936998,-.02596338512915,-4.39470996079559,.01624864962975,2.19611684890774,-.00240879051584,-.75104302451432,.00674613682247,.13149317958808,-.00187763777362],[.15457299681924,-2.37898834973084,-.09331049056315,2.84868151156327,-.06247880153653,-2.64577170229825,.02163541888798,2.23697657451713,-.05588393329856,-1.67148153367602,.04781476674921,1.00595954808547,.00222312597743,-.45953458054983,.03174092540049,.16378164858596,-.01390589421898,-.05032077717131,.00651420667831,.0234789740702,-.00881362733839],[.30296907319327,-1.61273165137247,-.22613988682123,1.0797749225997,-.08587323730772,-.2565625775407,.03282930172664,-.1627671912044,-.00915702933434,-.22638893773906,-.02364141202522,.39120800788284,-.00584456039913,-.22138138954925,.06276101321749,.04500235387352,-828086748e-14,.02005851806501,.00205861885564,.00302439095741,-.02950134983287],[.33642304856132,-1.49858979367799,-.2557224142557,.87350271418188,-.11828570177555,.12205022308084,.11921148675203,-.80774944671438,-.07834489609479,.47854794562326,-.0046997791438,-.12453458140019,-.0058950022444,-.04067510197014,.05724228140351,.08333755284107,.00832043980773,-.04237348025746,-.0163538138454,.02977207319925,-.0176017656815],[.4491525660845,-.62820619233671,-.14351757464547,.29661783706366,-.22784394429749,-.372563729424,-.01419140100551,.00213767857124,.04078262797139,-.42029820170918,-.12398163381748,.22199650564824,.04097565135648,.00613424350682,.10478503600251,.06747620744683,-.01863887810927,.05784820375801,-.03193428438915,.03222754072173,.00541907748707],[.56619470757641,-1.04800335126349,-.75464456939302,.29156311971249,.1624213774223,-.26806001042947,.16744243493672,.00819999645858,-.18901604199609,.45054734505008,.3093178284183,-.33032403314006,-.27562961986224,.0673936833311,.00647310677246,-.04784254229033,.08647503780351,.01639907836189,-.0378898455484,.01807364323573,-.00588215443421],[.58100494960553,-.51035327095184,-.53174909058578,-.31863563325245,-.14289799034253,-.20256413484477,.17520704835522,.1472815413433,.02377945217615,.38952639978999,.15558449135573,-.23313271880868,-.25344790059353,-.05246019024463,.01628462406333,-.02505961724053,.06920467763959,.02442357316099,-.03721611395801,.01818801111503,-.00749618797172],[.53648789255105,-.2504987195602,-.42163034350696,-.43193942311114,-.00275953611929,-.03424681017675,.04267842219415,-.04678328784242,-.10214864179676,.26408300200955,.14590772289388,.15113130533216,-.02459864859345,-.17556493366449,-.11202315195388,-.18823009262115,-.04060034127,.05477720428674,.0478866554818,.0470440968812,-.02217936801134]],m=[[.98621192462708,-1.97223372919527,-1.97242384925416,.97261396931306,.98621192462708],[.98500175787242,-1.96977855582618,-1.97000351574484,.9702284756635,.98500175787242],[.97938932735214,-1.95835380975398,-1.95877865470428,.95920349965459,.97938932735214],[.97531843204928,-1.95002759149878,-1.95063686409857,.95124613669835,.97531843204928],[.97316523498161,-1.94561023566527,-1.94633046996323,.94705070426118,.97316523498161],[.96454515552826,-1.92783286977036,-1.92909031105652,.93034775234268,.96454515552826],[.96009142950541,-1.91858953033784,-1.92018285901082,.92177618768381,.96009142950541],[.95856916599601,-1.9154210807478,-1.91713833199203,.91885558323625,.95856916599601],[.94597685600279,-1.88903307939452,-1.89195371200558,.89487434461664,.94597685600279]];function _(r,t,n,i,e,o){for(;0!=e--;)n[i]=1e-10+r[t+0]*o[0]-n[i-1]*o[1]+r[t-1]*o[2]-n[i-2]*o[3]+r[t-2]*o[4]-n[i-3]*o[5]+r[t-3]*o[6]-n[i-4]*o[7]+r[t-4]*o[8]-n[i-5]*o[9]+r[t-5]*o[10]-n[i-6]*o[11]+r[t-6]*o[12]-n[i-7]*o[13]+r[t-7]*o[14]-n[i-8]*o[15]+r[t-8]*o[16]-n[i-9]*o[17]+r[t-9]*o[18]-n[i-10]*o[19]+r[t-10]*o[20],++i,++t}function g(r,t,n,i,e,o){for(;0!=e--;)n[i]=r[t+0]*o[0]-n[i-1]*o[1]+r[t-1]*o[2]-n[i-2]*o[3]+r[t-2]*o[4],++i,++t}function b(r){return r*r}this.InitGainAnalysis=function(r,t){return function(r,t){for(var n=0;n<MAX_ORDER;n++)r.linprebuf[n]=r.lstepbuf[n]=r.loutbuf[n]=r.rinprebuf[n]=r.rstepbuf[n]=r.routbuf[n]=0;switch(0|t){case 48e3:r.reqindex=0;break;case 44100:r.reqindex=1;break;case 32e3:r.reqindex=2;break;case 24e3:r.reqindex=3;break;case 22050:r.reqindex=4;break;case 16e3:r.reqindex=5;break;case 12e3:r.reqindex=6;break;case 11025:r.reqindex=7;break;case 8e3:r.reqindex=8;break;default:return INIT_GAIN_ANALYSIS_ERROR}return r.sampleWindow=0|(t*i+e-1)/e,r.lsum=0,r.rsum=0,r.totsamp=0,hr.ill(r.A,0),INIT_GAIN_ANALYSIS_OK}(r,t)!=INIT_GAIN_ANALYSIS_OK?INIT_GAIN_ANALYSIS_ERROR:(r.linpre=MAX_ORDER,r.rinpre=MAX_ORDER,r.lstep=MAX_ORDER,r.rstep=MAX_ORDER,r.lout=MAX_ORDER,r.rout=MAX_ORDER,hr.fill(r.B,0),INIT_GAIN_ANALYSIS_OK)},this.AnalyzeSamples=function(r,t,n,i,e,o,s){var a,f,h,u,c,v,l;if(0==o)return GAIN_ANALYSIS_OK;switch(l=0,c=o,s){case 1:i=t,e=n;break;case 2:break;default:return GAIN_ANALYSIS_ERROR}for(o<MAX_ORDER?(fr.arraycopy(t,n,r.linprebuf,MAX_ORDER,o),fr.arraycopy(i,e,r.rinprebuf,MAX_ORDER,o)):(fr.arraycopy(t,n,r.linprebuf,MAX_ORDER,MAX_ORDER),fr.arraycopy(i,e,r.rinprebuf,MAX_ORDER,MAX_ORDER));0<c;){v=c>r.sampleWindow-r.totsamp?r.sampleWindow-r.totsamp:c,l<MAX_ORDER?(a=r.linpre+l,f=r.linprebuf,h=r.rinpre+l,u=r.rinprebuf,v>MAX_ORDER-l&&(v=MAX_ORDER-l)):(a=n+l,f=t,h=e+l,u=i),_(f,a,r.lstepbuf,r.lstep+r.totsamp,v,E[r.reqindex]),_(u,h,r.rstepbuf,r.rstep+r.totsamp,v,E[r.reqindex]),g(r.lstepbuf,r.lstep+r.totsamp,r.loutbuf,r.lout+r.totsamp,v,m[r.reqindex]),g(r.rstepbuf,r.rstep+r.totsamp,r.routbuf,r.rout+r.totsamp,v,m[r.reqindex]),a=r.lout+r.totsamp,f=r.loutbuf,h=r.rout+r.totsamp,u=r.routbuf;for(var d=v%8;0!=d--;)r.lsum+=b(f[a++]),r.rsum+=b(u[h++]);for(d=v/8;0!=d--;)r.lsum+=b(f[a+0])+b(f[a+1])+b(f[a+2])+b(f[a+3])+b(f[a+4])+b(f[a+5])+b(f[a+6])+b(f[a+7]),a+=8,r.rsum+=b(u[h+0])+b(u[h+1])+b(u[h+2])+b(u[h+3])+b(u[h+4])+b(u[h+5])+b(u[h+6])+b(u[h+7]),h+=8;if(c-=v,l+=v,r.totsamp+=v,r.totsamp==r.sampleWindow){var w=10*ur.STEPS_per_dB*Math.log10((r.lsum+r.rsum)/r.totsamp*.5+1e-37),M=w<=0?0:0|w;M>=r.A.length&&(M=r.A.length-1),r.A[M]++,r.lsum=r.rsum=0,fr.arraycopy(r.loutbuf,r.totsamp,r.loutbuf,0,MAX_ORDER),fr.arraycopy(r.routbuf,r.totsamp,r.routbuf,0,MAX_ORDER),fr.arraycopy(r.lstepbuf,r.totsamp,r.lstepbuf,0,MAX_ORDER),fr.arraycopy(r.rstepbuf,r.totsamp,r.rstepbuf,0,MAX_ORDER),r.totsamp=0}if(r.totsamp>r.sampleWindow)return GAIN_ANALYSIS_ERROR}return o<MAX_ORDER?(fr.arraycopy(r.linprebuf,o,r.linprebuf,0,MAX_ORDER-o),fr.arraycopy(r.rinprebuf,o,r.rinprebuf,0,MAX_ORDER-o),fr.arraycopy(t,n,r.linprebuf,MAX_ORDER-o,o),fr.arraycopy(i,e,r.rinprebuf,MAX_ORDER-o,o)):(fr.arraycopy(t,n+o-MAX_ORDER,r.linprebuf,0,MAX_ORDER),fr.arraycopy(i,e+o-MAX_ORDER,r.rinprebuf,0,MAX_ORDER)),GAIN_ANALYSIS_OK},this.GetTitleGain=function(r){for(var t=function(r,t){var n,i=0;for(n=0;n<t;n++)i+=r[n];if(0==i)return GAIN_NOT_ENOUGH_SAMPLES;var e=0|Math.ceil(i*(1-.95));for(n=t;0<n--&&!((e-=r[n])<=0););return 64.82-n/ur.STEPS_per_dB}(r.A,r.A.length),n=0;n<r.A.length;n++)r.B[n]+=r.A[n],r.A[n]=0;for(var n=0;n<MAX_ORDER;n++)r.linprebuf[n]=r.lstepbuf[n]=r.loutbuf[n]=r.rinprebuf[n]=r.rstepbuf[n]=r.routbuf[n]=0;return r.totsamp=0,r.lsum=r.rsum=0,t}}ur.STEPS_per_dB=100,ur.MAX_dB=120,ur.GAIN_NOT_ENOUGH_SAMPLES=-24601,ur.GAIN_ANALYSIS_ERROR=0,ur.GAIN_ANALYSIS_OK=1,ur.INIT_GAIN_ANALYSIS_ERROR=0,ur.INIT_GAIN_ANALYSIS_OK=1,ur.MAX_ORDER=ur.YULE_ORDER=10,ur.MAX_SAMPLES_PER_WINDOW=(ur.MAX_SAMP_FREQ=48e3)*(ur.RMS_WINDOW_TIME_NUMERATOR=1)/(ur.RMS_WINDOW_TIME_DENOMINATOR=20)+1;var cr=ur,vr=h.new_float,lr=h.new_int,dr=function(){this.linprebuf=vr(2*cr.MAX_ORDER),this.linpre=0,this.lstepbuf=vr(cr.MAX_SAMPLES_PER_WINDOW+cr.MAX_ORDER),this.lstep=0,this.loutbuf=vr(cr.MAX_SAMPLES_PER_WINDOW+cr.MAX_ORDER),this.lout=0,this.rinprebuf=vr(2*cr.MAX_ORDER),this.rinpre=0,this.rstepbuf=vr(cr.MAX_SAMPLES_PER_WINDOW+cr.MAX_ORDER),this.rstep=0,this.routbuf=vr(cr.MAX_SAMPLES_PER_WINDOW+cr.MAX_ORDER),this.rout=0,this.sampleWindow=0,this.totsamp=0,this.lsum=0,this.rsum=0,this.freqindex=0,this.first=0,this.A=lr(0|cr.STEPS_per_dB*cr.MAX_dB),this.B=lr(0|cr.STEPS_per_dB*cr.MAX_dB)},wr=function(r){this.bits=r},Mr=h.new_float,Er=h.new_int,mr=h.assert,_r=function(r){var t=r;this.quantize=t,this.iteration_loop=function(r,t,n,i){var e,o=r.internal_flags,s=Mr(k.SFBMAX),a=Mr(576),f=Er(2),h=0,u=o.l3_side,c=new wr(h);this.quantize.rv.ResvFrameBegin(r,c),h=c.bits;for(var v=0;v<o.mode_gr;v++){e=this.quantize.qupvt.on_pe(r,t,f,h,v,v),o.mode_ext==yr.MPG_MD_MS_LR&&(this.quantize.ms_convert(o.l3_side,v),this.quantize.qupvt.reduce_side(f,n[v],h,e));for(var l=0;l<o.channels_out;l++){var d,w,M=u.tt[v][l];M.block_type!=yr.SHORT_TYPE?(d=0,w=o.PSY.mask_adjust-d):(d=0,w=o.PSY.mask_adjust_short-d),o.masking_lower=Math.pow(10,.1*w),this.quantize.init_outer_loop(o,M),this.quantize.init_xrpow(o,M,a)&&(this.quantize.qupvt.calc_xmin(r,i[v][l],M,s),this.quantize.outer_loop(r,M,s,a,l,f[l])),this.quantize.iteration_finish_one(o,v,l),mr(M.part2_3_length<=or.MAX_BITS_PER_CHANNEL),mr(M.part2_3_length<=f[l])}}this.quantize.rv.ResvFrameEnd(o,h)}};function gr(r,t,n,i){this.xlen=r,this.linmax=t,this.table=n,this.hlen=i}var br={t1HB:[1,1,1,0],t2HB:[1,2,1,3,1,1,3,2,0],t3HB:[3,2,1,1,1,1,3,2,0],t5HB:[1,2,6,5,3,1,4,4,7,5,7,1,6,1,1,0],t6HB:[7,3,5,1,6,2,3,2,5,4,4,1,3,3,2,0],t7HB:[1,2,10,19,16,10,3,3,7,10,5,3,11,4,13,17,8,4,12,11,18,15,11,2,7,6,9,14,3,1,6,4,5,3,2,0],t8HB:[3,4,6,18,12,5,5,1,2,16,9,3,7,3,5,14,7,3,19,17,15,13,10,4,13,5,8,11,5,1,12,4,4,1,1,0],t9HB:[7,5,9,14,15,7,6,4,5,5,6,7,7,6,8,8,8,5,15,6,9,10,5,1,11,7,9,6,4,1,14,4,6,2,6,0],t10HB:[1,2,10,23,35,30,12,17,3,3,8,12,18,21,12,7,11,9,15,21,32,40,19,6,14,13,22,34,46,23,18,7,20,19,33,47,27,22,9,3,31,22,41,26,21,20,5,3,14,13,10,11,16,6,5,1,9,8,7,8,4,4,2,0],t11HB:[3,4,10,24,34,33,21,15,5,3,4,10,32,17,11,10,11,7,13,18,30,31,20,5,25,11,19,59,27,18,12,5,35,33,31,58,30,16,7,5,28,26,32,19,17,15,8,14,14,12,9,13,14,9,4,1,11,4,6,6,6,3,2,0],t12HB:[9,6,16,33,41,39,38,26,7,5,6,9,23,16,26,11,17,7,11,14,21,30,10,7,17,10,15,12,18,28,14,5,32,13,22,19,18,16,9,5,40,17,31,29,17,13,4,2,27,12,11,15,10,7,4,1,27,12,8,12,6,3,1,0],t13HB:[1,5,14,21,34,51,46,71,42,52,68,52,67,44,43,19,3,4,12,19,31,26,44,33,31,24,32,24,31,35,22,14,15,13,23,36,59,49,77,65,29,40,30,40,27,33,42,16,22,20,37,61,56,79,73,64,43,76,56,37,26,31,25,14,35,16,60,57,97,75,114,91,54,73,55,41,48,53,23,24,58,27,50,96,76,70,93,84,77,58,79,29,74,49,41,17,47,45,78,74,115,94,90,79,69,83,71,50,59,38,36,15,72,34,56,95,92,85,91,90,86,73,77,65,51,44,43,42,43,20,30,44,55,78,72,87,78,61,46,54,37,30,20,16,53,25,41,37,44,59,54,81,66,76,57,54,37,18,39,11,35,33,31,57,42,82,72,80,47,58,55,21,22,26,38,22,53,25,23,38,70,60,51,36,55,26,34,23,27,14,9,7,34,32,28,39,49,75,30,52,48,40,52,28,18,17,9,5,45,21,34,64,56,50,49,45,31,19,12,15,10,7,6,3,48,23,20,39,36,35,53,21,16,23,13,10,6,1,4,2,16,15,17,27,25,20,29,11,17,12,16,8,1,1,0,1],t15HB:[7,12,18,53,47,76,124,108,89,123,108,119,107,81,122,63,13,5,16,27,46,36,61,51,42,70,52,83,65,41,59,36,19,17,15,24,41,34,59,48,40,64,50,78,62,80,56,33,29,28,25,43,39,63,55,93,76,59,93,72,54,75,50,29,52,22,42,40,67,57,95,79,72,57,89,69,49,66,46,27,77,37,35,66,58,52,91,74,62,48,79,63,90,62,40,38,125,32,60,56,50,92,78,65,55,87,71,51,73,51,70,30,109,53,49,94,88,75,66,122,91,73,56,42,64,44,21,25,90,43,41,77,73,63,56,92,77,66,47,67,48,53,36,20,71,34,67,60,58,49,88,76,67,106,71,54,38,39,23,15,109,53,51,47,90,82,58,57,48,72,57,41,23,27,62,9,86,42,40,37,70,64,52,43,70,55,42,25,29,18,11,11,118,68,30,55,50,46,74,65,49,39,24,16,22,13,14,7,91,44,39,38,34,63,52,45,31,52,28,19,14,8,9,3,123,60,58,53,47,43,32,22,37,24,17,12,15,10,2,1,71,37,34,30,28,20,17,26,21,16,10,6,8,6,2,0],t16HB:[1,5,14,44,74,63,110,93,172,149,138,242,225,195,376,17,3,4,12,20,35,62,53,47,83,75,68,119,201,107,207,9,15,13,23,38,67,58,103,90,161,72,127,117,110,209,206,16,45,21,39,69,64,114,99,87,158,140,252,212,199,387,365,26,75,36,68,65,115,101,179,164,155,264,246,226,395,382,362,9,66,30,59,56,102,185,173,265,142,253,232,400,388,378,445,16,111,54,52,100,184,178,160,133,257,244,228,217,385,366,715,10,98,48,91,88,165,157,148,261,248,407,397,372,380,889,884,8,85,84,81,159,156,143,260,249,427,401,392,383,727,713,708,7,154,76,73,141,131,256,245,426,406,394,384,735,359,710,352,11,139,129,67,125,247,233,229,219,393,743,737,720,885,882,439,4,243,120,118,115,227,223,396,746,742,736,721,712,706,223,436,6,202,224,222,218,216,389,386,381,364,888,443,707,440,437,1728,4,747,211,210,208,370,379,734,723,714,1735,883,877,876,3459,865,2,377,369,102,187,726,722,358,711,709,866,1734,871,3458,870,434,0,12,10,7,11,10,17,11,9,13,12,10,7,5,3,1,3],t24HB:[15,13,46,80,146,262,248,434,426,669,653,649,621,517,1032,88,14,12,21,38,71,130,122,216,209,198,327,345,319,297,279,42,47,22,41,74,68,128,120,221,207,194,182,340,315,295,541,18,81,39,75,70,134,125,116,220,204,190,178,325,311,293,271,16,147,72,69,135,127,118,112,210,200,188,352,323,306,285,540,14,263,66,129,126,119,114,214,202,192,180,341,317,301,281,262,12,249,123,121,117,113,215,206,195,185,347,330,308,291,272,520,10,435,115,111,109,211,203,196,187,353,332,313,298,283,531,381,17,427,212,208,205,201,193,186,177,169,320,303,286,268,514,377,16,335,199,197,191,189,181,174,333,321,305,289,275,521,379,371,11,668,184,183,179,175,344,331,314,304,290,277,530,383,373,366,10,652,346,171,168,164,318,309,299,287,276,263,513,375,368,362,6,648,322,316,312,307,302,292,284,269,261,512,376,370,364,359,4,620,300,296,294,288,282,273,266,515,380,374,369,365,361,357,2,1033,280,278,274,267,264,259,382,378,372,367,363,360,358,356,0,43,20,19,17,15,13,11,9,7,6,4,7,5,3,1,3],t32HB:[1,10,8,20,12,20,16,32,14,12,24,0,28,16,24,16],t33HB:[15,28,26,48,22,40,36,64,14,24,20,32,12,16,8,0],t1l:[1,4,3,5],t2l:[1,4,7,4,5,7,6,7,8],t3l:[2,3,7,4,4,7,6,7,8],t5l:[1,4,7,8,4,5,8,9,7,8,9,10,8,8,9,10],t6l:[3,4,6,8,4,4,6,7,5,6,7,8,7,7,8,9],t7l:[1,4,7,9,9,10,4,6,8,9,9,10,7,7,9,10,10,11,8,9,10,11,11,11,8,9,10,11,11,12,9,10,11,12,12,12],t8l:[2,4,7,9,9,10,4,4,6,10,10,10,7,6,8,10,10,11,9,10,10,11,11,12,9,9,10,11,12,12,10,10,11,11,13,13],t9l:[3,4,6,7,9,10,4,5,6,7,8,10,5,6,7,8,9,10,7,7,8,9,9,10,8,8,9,9,10,11,9,9,10,10,11,11],t10l:[1,4,7,9,10,10,10,11,4,6,8,9,10,11,10,10,7,8,9,10,11,12,11,11,8,9,10,11,12,12,11,12,9,10,11,12,12,12,12,12,10,11,12,12,13,13,12,13,9,10,11,12,12,12,13,13,10,10,11,12,12,13,13,13],t11l:[2,4,6,8,9,10,9,10,4,5,6,8,10,10,9,10,6,7,8,9,10,11,10,10,8,8,9,11,10,12,10,11,9,10,10,11,11,12,11,12,9,10,11,12,12,13,12,13,9,9,9,10,11,12,12,12,9,9,10,11,12,12,12,12],t12l:[4,4,6,8,9,10,10,10,4,5,6,7,9,9,10,10,6,6,7,8,9,10,9,10,7,7,8,8,9,10,10,10,8,8,9,9,10,10,10,11,9,9,10,10,10,11,10,11,9,9,9,10,10,11,11,12,10,10,10,11,11,11,11,12],t13l:[1,5,7,8,9,10,10,11,10,11,12,12,13,13,14,14,4,6,8,9,10,10,11,11,11,11,12,12,13,14,14,14,7,8,9,10,11,11,12,12,11,12,12,13,13,14,15,15,8,9,10,11,11,12,12,12,12,13,13,13,13,14,15,15,9,9,11,11,12,12,13,13,12,13,13,14,14,15,15,16,10,10,11,12,12,12,13,13,13,13,14,13,15,15,16,16,10,11,12,12,13,13,13,13,13,14,14,14,15,15,16,16,11,11,12,13,13,13,14,14,14,14,15,15,15,16,18,18,10,10,11,12,12,13,13,14,14,14,14,15,15,16,17,17,11,11,12,12,13,13,13,15,14,15,15,16,16,16,18,17,11,12,12,13,13,14,14,15,14,15,16,15,16,17,18,19,12,12,12,13,14,14,14,14,15,15,15,16,17,17,17,18,12,13,13,14,14,15,14,15,16,16,17,17,17,18,18,18,13,13,14,15,15,15,16,16,16,16,16,17,18,17,18,18,14,14,14,15,15,15,17,16,16,19,17,17,17,19,18,18,13,14,15,16,16,16,17,16,17,17,18,18,21,20,21,18],t15l:[3,5,6,8,8,9,10,10,10,11,11,12,12,12,13,14,5,5,7,8,9,9,10,10,10,11,11,12,12,12,13,13,6,7,7,8,9,9,10,10,10,11,11,12,12,13,13,13,7,8,8,9,9,10,10,11,11,11,12,12,12,13,13,13,8,8,9,9,10,10,11,11,11,11,12,12,12,13,13,13,9,9,9,10,10,10,11,11,11,11,12,12,13,13,13,14,10,9,10,10,10,11,11,11,11,12,12,12,13,13,14,14,10,10,10,11,11,11,11,12,12,12,12,12,13,13,13,14,10,10,10,11,11,11,11,12,12,12,12,13,13,14,14,14,10,10,11,11,11,11,12,12,12,13,13,13,13,14,14,14,11,11,11,11,12,12,12,12,12,13,13,13,13,14,15,14,11,11,11,11,12,12,12,12,13,13,13,13,14,14,14,15,12,12,11,12,12,12,13,13,13,13,13,13,14,14,15,15,12,12,12,12,12,13,13,13,13,14,14,14,14,14,15,15,13,13,13,13,13,13,13,13,14,14,14,14,15,15,14,15,13,13,13,13,13,13,13,14,14,14,14,14,15,15,15,15],t16_5l:[1,5,7,9,10,10,11,11,12,12,12,13,13,13,14,11,4,6,8,9,10,11,11,11,12,12,12,13,14,13,14,11,7,8,9,10,11,11,12,12,13,12,13,13,13,14,14,12,9,9,10,11,11,12,12,12,13,13,14,14,14,15,15,13,10,10,11,11,12,12,13,13,13,14,14,14,15,15,15,12,10,10,11,11,12,13,13,14,13,14,14,15,15,15,16,13,11,11,11,12,13,13,13,13,14,14,14,14,15,15,16,13,11,11,12,12,13,13,13,14,14,15,15,15,15,17,17,13,11,12,12,13,13,13,14,14,15,15,15,15,16,16,16,13,12,12,12,13,13,14,14,15,15,15,15,16,15,16,15,14,12,13,12,13,14,14,14,14,15,16,16,16,17,17,16,13,13,13,13,13,14,14,15,16,16,16,16,16,16,15,16,14,13,14,14,14,14,15,15,15,15,17,16,16,16,16,18,14,15,14,14,14,15,15,16,16,16,18,17,17,17,19,17,14,14,15,13,14,16,16,15,16,16,17,18,17,19,17,16,14,11,11,11,12,12,13,13,13,14,14,14,14,14,14,14,12],t16l:[1,5,7,9,10,10,11,11,12,12,12,13,13,13,14,10,4,6,8,9,10,11,11,11,12,12,12,13,14,13,14,10,7,8,9,10,11,11,12,12,13,12,13,13,13,14,14,11,9,9,10,11,11,12,12,12,13,13,14,14,14,15,15,12,10,10,11,11,12,12,13,13,13,14,14,14,15,15,15,11,10,10,11,11,12,13,13,14,13,14,14,15,15,15,16,12,11,11,11,12,13,13,13,13,14,14,14,14,15,15,16,12,11,11,12,12,13,13,13,14,14,15,15,15,15,17,17,12,11,12,12,13,13,13,14,14,15,15,15,15,16,16,16,12,12,12,12,13,13,14,14,15,15,15,15,16,15,16,15,13,12,13,12,13,14,14,14,14,15,16,16,16,17,17,16,12,13,13,13,13,14,14,15,16,16,16,16,16,16,15,16,13,13,14,14,14,14,15,15,15,15,17,16,16,16,16,18,13,15,14,14,14,15,15,16,16,16,18,17,17,17,19,17,13,14,15,13,14,16,16,15,16,16,17,18,17,19,17,16,13,10,10,10,11,11,12,12,12,13,13,13,13,13,13,13,10],t24l:[4,5,7,8,9,10,10,11,11,12,12,12,12,12,13,10,5,6,7,8,9,10,10,11,11,11,12,12,12,12,12,10,7,7,8,9,9,10,10,11,11,11,11,12,12,12,13,9,8,8,9,9,10,10,10,11,11,11,11,12,12,12,12,9,9,9,9,10,10,10,10,11,11,11,12,12,12,12,13,9,10,9,10,10,10,10,11,11,11,11,12,12,12,12,12,9,10,10,10,10,10,11,11,11,11,12,12,12,12,12,13,9,11,10,10,10,11,11,11,11,12,12,12,12,12,13,13,10,11,11,11,11,11,11,11,11,11,12,12,12,12,13,13,10,11,11,11,11,11,11,11,12,12,12,12,12,13,13,13,10,12,11,11,11,11,12,12,12,12,12,12,13,13,13,13,10,12,12,11,11,11,12,12,12,12,12,12,13,13,13,13,10,12,12,12,12,12,12,12,12,12,12,13,13,13,13,13,10,12,12,12,12,12,12,12,12,13,13,13,13,13,13,13,10,13,12,12,12,12,12,12,13,13,13,13,13,13,13,13,10,9,9,9,9,9,9,9,9,9,9,9,10,10,10,10,6],t32l:[1,5,5,7,5,8,7,9,5,7,7,9,7,9,9,10],t33l:[4,5,5,6,5,6,6,7,5,6,6,7,6,7,7,8]};br.ht=[new gr(0,0,null,null),new gr(2,0,br.t1HB,br.t1l),new gr(3,0,br.t2HB,br.t2l),new gr(3,0,br.t3HB,br.t3l),new gr(0,0,null,null),new gr(4,0,br.t5HB,br.t5l),new gr(4,0,br.t6HB,br.t6l),new gr(6,0,br.t7HB,br.t7l),new gr(6,0,br.t8HB,br.t8l),new gr(6,0,br.t9HB,br.t9l),new gr(8,0,br.t10HB,br.t10l),new gr(8,0,br.t11HB,br.t11l),new gr(8,0,br.t12HB,br.t12l),new gr(16,0,br.t13HB,br.t13l),new gr(0,0,null,br.t16_5l),new gr(16,0,br.t15HB,br.t15l),new gr(1,1,br.t16HB,br.t16l),new gr(2,3,br.t16HB,br.t16l),new gr(3,7,br.t16HB,br.t16l),new gr(4,15,br.t16HB,br.t16l),new gr(6,63,br.t16HB,br.t16l),new gr(8,255,br.t16HB,br.t16l),new gr(10,1023,br.t16HB,br.t16l),new gr(13,8191,br.t16HB,br.t16l),new gr(4,15,br.t24HB,br.t24l),new gr(5,31,br.t24HB,br.t24l),new gr(6,63,br.t24HB,br.t24l),new gr(7,127,br.t24HB,br.t24l),new gr(8,255,br.t24HB,br.t24l),new gr(9,511,br.t24HB,br.t24l),new gr(11,2047,br.t24HB,br.t24l),new gr(13,8191,br.t24HB,br.t24l),new gr(0,0,br.t32HB,br.t32l),new gr(0,0,br.t33HB,br.t33l)],br.largetbl=[65540,327685,458759,589832,655369,655370,720906,720907,786443,786444,786444,851980,851980,851980,917517,655370,262149,393222,524295,589832,655369,720906,720906,720907,786443,786443,786444,851980,917516,851980,917516,655370,458759,524295,589832,655369,720905,720906,786442,786443,851979,786443,851979,851980,851980,917516,917517,720905,589832,589832,655369,720905,720906,786442,786442,786443,851979,851979,917515,917516,917516,983052,983052,786441,655369,655369,720905,720906,786442,786442,851978,851979,851979,917515,917516,917516,983052,983052,983053,720905,655370,655369,720906,720906,786442,851978,851979,917515,851979,917515,917516,983052,983052,983052,1048588,786441,720906,720906,720906,786442,851978,851979,851979,851979,917515,917516,917516,917516,983052,983052,1048589,786441,720907,720906,786442,786442,851979,851979,851979,917515,917516,983052,983052,983052,983052,1114125,1114125,786442,720907,786443,786443,851979,851979,851979,917515,917515,983051,983052,983052,983052,1048588,1048589,1048589,786442,786443,786443,786443,851979,851979,917515,917515,983052,983052,983052,983052,1048588,983053,1048589,983053,851978,786444,851979,786443,851979,917515,917516,917516,917516,983052,1048588,1048588,1048589,1114125,1114125,1048589,786442,851980,851980,851979,851979,917515,917516,983052,1048588,1048588,1048588,1048588,1048589,1048589,983053,1048589,851978,851980,917516,917516,917516,917516,983052,983052,983052,983052,1114124,1048589,1048589,1048589,1048589,1179661,851978,983052,917516,917516,917516,983052,983052,1048588,1048588,1048589,1179661,1114125,1114125,1114125,1245197,1114125,851978,917517,983052,851980,917516,1048588,1048588,983052,1048589,1048589,1114125,1179661,1114125,1245197,1114125,1048589,851978,655369,655369,655369,720905,720905,786441,786441,786441,851977,851977,851977,851978,851978,851978,851978,655366],br.table23=[65538,262147,458759,262148,327684,458759,393222,458759,524296],br.table56=[65539,262148,458758,524296,262148,327684,524294,589831,458757,524294,589831,655368,524295,524295,589832,655369],br.bitrate_table=[[0,8,16,24,32,40,48,56,64,80,96,112,128,144,160,-1],[0,32,40,48,56,64,80,96,112,128,160,192,224,256,320,-1],[0,8,16,24,32,40,48,56,64,-1,-1,-1,-1,-1,-1,-1]],br.samplerate_table=[[22050,24e3,16e3,-1],[44100,48e3,32e3,-1],[11025,12e3,8e3,-1]],br.scfsi_band=[0,6,11,16,21];var pr=br,Ir=h.VbrMode,Nr=h.Float,Sr=h.Util,Yr=h.new_float,Dr=h.new_int,Br=h.assert;function Fr(){var h=null,d=null,i=null;this.setModules=function(r,t,n){h=r,d=t,i=n},this.IPOW20=function(r){return l[r]};var T=2220446049250313e-31,r=Fr.IXMAX_VAL,u=r+2,c=Fr.Q_MAX,v=Fr.Q_MAX2,e=100;this.nr_of_sfb_block=[[[6,5,5,5],[9,9,9,9],[6,9,9,9]],[[6,5,7,3],[9,9,12,6],[6,9,12,6]],[[11,10,0,0],[18,18,0,0],[15,18,0,0]],[[7,7,7,0],[12,12,12,0],[6,15,12,0]],[[6,6,6,3],[12,9,9,6],[6,12,9,6]],[[8,8,5,0],[15,12,9,0],[6,18,9,0]]];var p=[0,0,0,0,0,0,0,0,0,0,0,1,1,1,1,2,2,3,3,3,2,0];this.pretab=p,this.sfBandIndex=[new D([0,6,12,18,24,30,36,44,54,66,80,96,116,140,168,200,238,284,336,396,464,522,576],[0,4,8,12,18,24,32,42,56,74,100,132,174,192],[0,0,0,0,0,0,0],[0,0,0,0,0,0,0]),new D([0,6,12,18,24,30,36,44,54,66,80,96,114,136,162,194,232,278,332,394,464,540,576],[0,4,8,12,18,26,36,48,62,80,104,136,180,192],[0,0,0,0,0,0,0],[0,0,0,0,0,0,0]),new D([0,6,12,18,24,30,36,44,54,66,80,96,116,140,168,200,238,284,336,396,464,522,576],[0,4,8,12,18,26,36,48,62,80,104,134,174,192],[0,0,0,0,0,0,0],[0,0,0,0,0,0,0]),new D([0,4,8,12,16,20,24,30,36,44,52,62,74,90,110,134,162,196,238,288,342,418,576],[0,4,8,12,16,22,30,40,52,66,84,106,136,192],[0,0,0,0,0,0,0],[0,0,0,0,0,0,0]),new D([0,4,8,12,16,20,24,30,36,42,50,60,72,88,106,128,156,190,230,276,330,384,576],[0,4,8,12,16,22,28,38,50,64,80,100,126,192],[0,0,0,0,0,0,0],[0,0,0,0,0,0,0]),new D([0,4,8,12,16,20,24,30,36,44,54,66,82,102,126,156,194,240,296,364,448,550,576],[0,4,8,12,16,22,30,42,58,78,104,138,180,192],[0,0,0,0,0,0,0],[0,0,0,0,0,0,0]),new D([0,6,12,18,24,30,36,44,54,66,80,96,116,140,168,200,238,284,336,396,464,522,576],[0,4,8,12,18,26,36,48,62,80,104,134,174,192],[0,0,0,0,0,0,0],[0,0,0,0,0,0,0]),new D([0,6,12,18,24,30,36,44,54,66,80,96,116,140,168,200,238,284,336,396,464,522,576],[0,4,8,12,18,26,36,48,62,80,104,134,174,192],[0,0,0,0,0,0,0],[0,0,0,0,0,0,0]),new D([0,12,24,36,48,60,72,88,108,132,160,192,232,280,336,400,476,566,568,570,572,574,576],[0,8,16,24,36,52,72,96,124,160,162,164,166,192],[0,0,0,0,0,0,0],[0,0,0,0,0,0,0])];var I=Yr(c+v+1),l=Yr(c),w=Yr(u),M=Yr(u);function E(r,t){var n=i.ATHformula(t,r);return n-=e,n=Math.pow(10,n/10+r.ATHlower)}function y(r){this.s=r}this.adj43=M,this.iteration_init=function(r){var t,n=r.internal_flags,i=n.l3_side;if(0==n.iteration_init_init){for(n.iteration_init_init=1,i.main_data_begin=0,function(r){for(var t=r.internal_flags.ATH.l,n=r.internal_flags.ATH.psfb21,i=r.internal_flags.ATH.s,e=r.internal_flags.ATH.psfb12,o=r.internal_flags,s=r.out_samplerate,a=0;a<yr.SBMAX_l;a++){var f=o.scalefac_band.l[a],h=o.scalefac_band.l[a+1];t[a]=Nr.MAX_VALUE;for(var u=f;u<h;u++){var c=u*s/1152,v=E(r,c);t[a]=Math.min(t[a],v)}}for(var a=0;a<yr.PSFB21;a++){var f=o.scalefac_band.psfb21[a],h=o.scalefac_band.psfb21[a+1];n[a]=Nr.MAX_VALUE;for(var u=f;u<h;u++){var c=u*s/1152,v=E(r,c);n[a]=Math.min(n[a],v)}}for(var a=0;a<yr.SBMAX_s;a++){var f=o.scalefac_band.s[a],h=o.scalefac_band.s[a+1];i[a]=Nr.MAX_VALUE;for(var u=f;u<h;u++){var c=u*s/384,v=E(r,c);i[a]=Math.min(i[a],v)}i[a]*=o.scalefac_band.s[a+1]-o.scalefac_band.s[a]}for(var a=0;a<yr.PSFB12;a++){var f=o.scalefac_band.psfb12[a],h=o.scalefac_band.psfb12[a+1];e[a]=Nr.MAX_VALUE;for(var u=f;u<h;u++){var c=u*s/384,v=E(r,c);e[a]=Math.min(e[a],v)}e[a]*=o.scalefac_band.s[13]-o.scalefac_band.s[12]}if(r.noATH){for(var a=0;a<yr.SBMAX_l;a++)t[a]=1e-20;for(var a=0;a<yr.PSFB21;a++)n[a]=1e-20;for(var a=0;a<yr.SBMAX_s;a++)i[a]=1e-20;for(var a=0;a<yr.PSFB12;a++)e[a]=1e-20}o.ATH.floor=10*Math.log10(E(r,-1))}(r),w[0]=0,t=1;t<u;t++)w[t]=Math.pow(t,4/3);for(t=0;t<u-1;t++)M[t]=t+1-Math.pow(.5*(w[t]+w[t+1]),.75);for(M[t]=.5,t=0;t<c;t++)l[t]=Math.pow(2,-.1875*(t-210));for(t=0;t<=c+v;t++)I[t]=Math.pow(2,.25*(t-210-v));var e,o,s,a;for(h.huffman_init(n),32<=(t=r.exp_nspsytune>>2&63)&&(t-=64),e=Math.pow(10,t/4/10),32<=(t=r.exp_nspsytune>>8&63)&&(t-=64),o=Math.pow(10,t/4/10),32<=(t=r.exp_nspsytune>>14&63)&&(t-=64),s=Math.pow(10,t/4/10),32<=(t=r.exp_nspsytune>>20&63)&&(t-=64),a=s*Math.pow(10,t/4/10),t=0;t<yr.SBMAX_l;t++)f=t<=6?e:t<=13?o:t<=20?s:a,n.nsPsy.longfact[t]=f;for(t=0;t<yr.SBMAX_s;t++){var f;f=t<=5?e:t<=10?o:t<=11?s:a,n.nsPsy.shortfact[t]=f}}},this.on_pe=function(r,t,n,i,e,o){var s,a,f=r.internal_flags,h=0,u=Dr(2),c=new wr(h),v=d.ResvMaxBits(r,i,c,o),l=(h=c.bits)+v;for(l>or.MAX_BITS_PER_GRANULE&&(l=or.MAX_BITS_PER_GRANULE),a=s=0;a<f.channels_out;++a)n[a]=Math.min(or.MAX_BITS_PER_CHANNEL,h/f.channels_out),u[a]=0|n[a]*t[e][a]/700-n[a],u[a]>3*i/4&&(u[a]=3*i/4),u[a]<0&&(u[a]=0),u[a]+n[a]>or.MAX_BITS_PER_CHANNEL&&(u[a]=Math.max(0,or.MAX_BITS_PER_CHANNEL-n[a])),s+=u[a];if(v<s)for(a=0;a<f.channels_out;++a)u[a]=v*u[a]/s;for(a=0;a<f.channels_out;++a)n[a]+=u[a],v-=u[a];for(a=s=0;a<f.channels_out;++a)s+=n[a];if(s>or.MAX_BITS_PER_GRANULE)for(a=0;a<f.channels_out;++a)n[a]*=or.MAX_BITS_PER_GRANULE,n[a]/=s,n[a];return l},this.reduce_side=function(r,t,n,i){Br(r[0]+r[1]<=or.MAX_BITS_PER_GRANULE);var e=.33*(.5-t)/.5;e<0&&(e=0),.5<e&&(e=.5);var o=0|.5*e*(r[0]+r[1]);o>or.MAX_BITS_PER_CHANNEL-r[0]&&(o=or.MAX_BITS_PER_CHANNEL-r[0]),o<0&&(o=0),125<=r[1]&&(125<r[1]-o?(r[0]<n&&(r[0]+=o),r[1]-=o):(r[0]+=r[1]-125,r[1]=125)),o=r[0]+r[1],i<o&&(r[0]=i*r[0]/o,r[1]=i*r[1]/o),Br(r[0]<=or.MAX_BITS_PER_CHANNEL),Br(r[1]<=or.MAX_BITS_PER_CHANNEL),Br(r[0]+r[1]<=or.MAX_BITS_PER_GRANULE)},this.athAdjust=function(r,t,n){var i=90.30873362,e=Sr.FAST_LOG10_X(t,10),o=r*r,s=0;return e-=n,1e-20<o&&(s=1+Sr.FAST_LOG10_X(o,10/i)),s<0&&(s=0),e*=s,e+=n+i-94.82444863,Math.pow(10,.1*e)},this.calc_xmin=function(r,t,n,i){var e,o=0,s=r.internal_flags,a=0,f=0,h=s.ATH,u=n.xr,c=r.VBR==Ir.vbr_mtrh?1:0,v=s.masking_lower;for(r.VBR!=Ir.vbr_mtrh&&r.VBR!=Ir.vbr_mt||(v=1),e=0;e<n.psy_lmax;e++){for(b=r.VBR==Ir.vbr_rh||r.VBR==Ir.vbr_mtrh?athAdjust(h.adjust,h.l[e],h.floor):h.adjust*h.l[e],m=n.width[e],p=b/m,I=T,A=m>>1,y=0;k=u[a]*u[a],y+=k,I+=k<p?k:p,R=u[++a]*u[a],y+=R,I+=R<p?R:p,a++,0<--A;);if(b<y&&f++,e==yr.SBPSY_l){var l=b*s.nsPsy.longfact[e];I<l&&(I=l)}if(0!=c&&(b=I),!r.ATHonly){var d=t.en.l[e];0<d&&(l=y*t.thm.l[e]*v/d,0!=c&&(l*=s.nsPsy.longfact[e]),b<l&&(b=l))}i[o++]=0!=c?b:b*s.nsPsy.longfact[e]}var w=575;if(n.block_type!=yr.SHORT_TYPE)for(var M=576;0!=M--&&BitStream.EQ(u[M],0);)w=M;n.max_nonzero_coeff=w;for(var E=n.sfb_smin;e<n.psymax;E++,e+=3){var m,_,g;for(g=r.VBR==Ir.vbr_rh||r.VBR==Ir.vbr_mtrh?athAdjust(h.adjust,h.s[E],h.floor):h.adjust*h.s[E],m=n.width[e],_=0;_<3;_++){var b,p,I,y=0,A=m>>1;p=g/m,I=T;do{var k,R;k=u[a]*u[a],y+=k,I+=k<p?k:p,R=u[++a]*u[a],y+=R,I+=R<p?R:p,a++}while(0<--A);if(g<y&&f++,E==yr.SBPSY_s){var l=g*s.nsPsy.shortfact[E];I<l&&(I=l)}if(b=0!=c?I:g,!r.ATHonly&&!r.ATHshort){var d=t.en.s[E][_];0<d&&(l=y*t.thm.s[E][_]*v/d,0!=c&&(l*=s.nsPsy.shortfact[E]),b<l&&(b=l))}i[o++]=0!=c?b:b*s.nsPsy.shortfact[E]}r.useTemporal&&(i[o-3]>i[o-3+1]&&(i[o-3+1]+=(i[o-3]-i[o-3+1])*s.decay),i[o-3+1]>i[o-3+2]&&(i[o-3+2]+=(i[o-3+1]-i[o-3+2])*s.decay))}return f},this.calc_noise_core=function(r,t,n,i){var e=0,o=t.s,s=r.l3_enc;if(o>r.count1)for(;0!=n--;)f=r.xr[o],o++,e+=f*f,f=r.xr[o],o++,e+=f*f;else if(o>r.big_values){var a=Yr(2);for(a[0]=0,a[1]=i;0!=n--;)f=Math.abs(r.xr[o])-a[s[o]],o++,e+=f*f,f=Math.abs(r.xr[o])-a[s[o]],o++,e+=f*f}else for(;0!=n--;){var f;f=Math.abs(r.xr[o])-w[s[o]]*i,o++,e+=f*f,f=Math.abs(r.xr[o])-w[s[o]]*i,o++,e+=f*f}return t.s=o,e},this.calc_noise=function(r,t,n,i,e){var o,s,a=0,f=0,h=0,u=0,c=0,v=-20,l=0,d=r.scalefac,w=0;for(i.over_SSD=0,o=0;o<r.psymax;o++){var M,E=r.global_gain-(d[w++]+(0!=r.preflag?p[o]:0)<<r.scalefac_scale+1)-8*r.subblock_gain[r.window[o]],m=0;if(null!=e&&e.step[o]==E)m=e.noise[o],l+=r.width[o],n[a++]=m/t[f++],m=e.noise_log[o];else{var _,g=I[E+Fr.Q_MAX2];s=r.width[o]>>1,l+r.width[o]>r.max_nonzero_coeff&&(_=r.max_nonzero_coeff-l+1,s=0<_?_>>1:0);var b=new y(l);m=this.calc_noise_core(r,b,s,g),l=b.s,null!=e&&(e.step[o]=E,e.noise[o]=m),m=n[a++]=m/t[f++],m=Sr.FAST_LOG10(Math.max(m,1e-20)),null!=e&&(e.noise_log[o]=m)}null!=e&&(e.global_gain=r.global_gain),c+=m,0<m&&(M=Math.max(0|10*m+.5,1),i.over_SSD+=M*M,h++,u+=m),v=Math.max(v,m)}return i.over_count=h,i.tot_noise=c,i.over_noise=u,i.max_noise=v,h},this.set_pinfo=function(r,t,n,i,e){var o,s,a,f,h,u=r.internal_flags,c=0==t.scalefac_scale?.5:1,v=t.scalefac,l=Yr(L3Side.SFBMAX),d=Yr(L3Side.SFBMAX),w=new CalcNoiseResult;calc_xmin(r,n,t,l),calc_noise(t,l,d,w,null);var M=0;for(s=t.sfb_lmax,t.block_type!=yr.SHORT_TYPE&&0==t.mixed_block_flag&&(s=22),o=0;o<s;o++){var E=u.scalefac_band.l[o],m=u.scalefac_band.l[o+1],_=m-E;for(f=0;M<m;M++)f+=t.xr[M]*t.xr[M];f/=_,h=1e15,u.pinfo.en[i][e][o]=h*f,u.pinfo.xfsf[i][e][o]=h*l[o]*d[o]/_,0<n.en.l[o]&&!r.ATHonly?f/=n.en.l[o]:f=0,u.pinfo.thr[i][e][o]=h*Math.max(f*n.thm.l[o],u.ATH.l[o]),(u.pinfo.LAMEsfb[i][e][o]=0)!=t.preflag&&11<=o&&(u.pinfo.LAMEsfb[i][e][o]=-c*p[o]),o<yr.SBPSY_l&&(Br(0<=v[o]),u.pinfo.LAMEsfb[i][e][o]-=c*v[o])}if(t.block_type==yr.SHORT_TYPE)for(s=o,o=t.sfb_smin;o<yr.SBMAX_s;o++)for(var E=u.scalefac_band.s[o],m=u.scalefac_band.s[o+1],_=m-E,g=0;g<3;g++){for(f=0,a=E;a<m;a++)f+=t.xr[M]*t.xr[M],M++;f=Math.max(f/_,1e-20),h=1e15,u.pinfo.en_s[i][e][3*o+g]=h*f,u.pinfo.xfsf_s[i][e][3*o+g]=h*l[s]*d[s]/_,0<n.en.s[o][g]?f/=n.en.s[o][g]:f=0,(r.ATHonly||r.ATHshort)&&(f=0),u.pinfo.thr_s[i][e][3*o+g]=h*Math.max(f*n.thm.s[o][g],u.ATH.s[o]),u.pinfo.LAMEsfb_s[i][e][3*o+g]=-2*t.subblock_gain[g],o<yr.SBPSY_s&&(u.pinfo.LAMEsfb_s[i][e][3*o+g]-=c*v[s]),s++}u.pinfo.LAMEqss[i][e]=t.global_gain,u.pinfo.LAMEmainbits[i][e]=t.part2_3_length+t.part2_length,u.pinfo.LAMEsfbits[i][e]=t.part2_length,u.pinfo.over[i][e]=w.over_count,u.pinfo.max_noise[i][e]=10*w.max_noise,u.pinfo.over_noise[i][e]=10*w.over_noise,u.pinfo.tot_noise[i][e]=10*w.tot_noise,u.pinfo.over_SSD[i][e]=w.over_SSD}}Fr.Q_MAX=257,Fr.Q_MAX2=116,Fr.LARGE_BITS=1e5,Fr.IXMAX_VAL=8206;var Cr=Fr,jr=h.System,Gr=h.Arrays,Ur=h.new_int,Xr=h.assert,xr=function r(){var b=null;function E(r){this.bits=0|r}this.qupvt=null,this.setModules=function(r){this.qupvt=r,b=r};var e=[[0,0],[0,0],[0,0],[0,0],[0,0],[0,1],[1,1],[1,1],[1,2],[2,2],[2,3],[2,3],[3,4],[3,4],[3,4],[4,5],[4,5],[4,6],[5,6],[5,6],[5,7],[6,7],[6,7]];function p(r,t,n,i,e,o){var s=.5946/t;for(r>>=1;0!=r--;)e[o++]=s>n[i++]?0:1,e[o++]=s>n[i++]?0:1}function I(r,t,n,i,e,o){var s=(r>>=1)%2;for(r>>=1;0!=r--;){var a,f,h,u,c,v,l,d;a=n[i++]*t,f=n[i++]*t,c=0|a,h=n[i++]*t,v=0|f,u=n[i++]*t,l=0|h,a+=b.adj43[c],d=0|u,f+=b.adj43[v],e[o++]=0|a,h+=b.adj43[l],e[o++]=0|f,u+=b.adj43[d],e[o++]=0|h,e[o++]=0|u}0!=s&&(a=n[i++]*t,f=n[i++]*t,c=0|a,v=0|f,a+=b.adj43[c],f+=b.adj43[v],e[o++]=0|a,e[o++]=0|f)}var a=[1,2,5,7,7,10,10,13,13,13,13,13,13,13,13];function m(r,t,n,i){var e=function(r,t,n){var i=0,e=0;do{var o=r[t++],s=r[t++];i<o&&(i=o),e<s&&(e=s)}while(t<n);return i<e&&(i=e),i}(r,t,n);switch(e){case 0:return e;case 1:return function(r,t,n,i){var e=0,o=pr.ht[1].hlen;do{var s=2*r[t+0]+r[t+1];t+=2,e+=o[s]}while(t<n);return i.bits+=e,1}(r,t,n,i);case 2:case 3:return function(r,t,n,i,e){var o,s,a=0,f=pr.ht[i].xlen;s=2==i?pr.table23:pr.table56;do{var h=r[t+0]*f+r[t+1];t+=2,a+=s[h]}while(t<n);return(o=65535&a)<(a>>=16)&&(a=o,i++),e.bits+=a,i}(r,t,n,a[e-1],i);case 4:case 5:case 6:case 7:case 8:case 9:case 10:case 11:case 12:case 13:case 14:case 15:return function(r,t,n,i,e){var o=0,s=0,a=0,f=pr.ht[i].xlen,h=pr.ht[i].hlen,u=pr.ht[i+1].hlen,c=pr.ht[i+2].hlen;do{var v=r[t+0]*f+r[t+1];t+=2,o+=h[v],s+=u[v],a+=c[v]}while(t<n);var l=i;return s<o&&(o=s,l++),a<o&&(o=a,l=i+2),e.bits+=o,l}(r,t,n,a[e-1],i);default:if(e>Cr.IXMAX_VAL)return i.bits=Cr.LARGE_BITS,-1;var o,s;for(e-=15,o=24;o<32&&!(pr.ht[o].linmax>=e);o++);for(s=o-8;s<24&&!(pr.ht[s].linmax>=e);s++);return function(r,t,n,i,e,o){var s,a=65536*pr.ht[i].xlen+pr.ht[e].xlen,f=0;do{var h=r[t++],u=r[t++];0!=h&&(14<h&&(h=15,f+=a),h*=16),0!=u&&(14<u&&(u=15,f+=a),h+=u),f+=pr.largetbl[h]}while(t<n);return(s=65535&f)<(f>>=16)&&(f=s,i=e),o.bits+=f,i}(r,t,n,s,o,i)}}function l(r,t,n,i,e,o,s,a){for(var f=t.big_values,h=2;h<yr.SBMAX_l+1;h++){var u=r.scalefac_band.l[h];if(f<=u)break;var c=e[h-2]+t.count1bits;if(n.part2_3_length<=c)break;var v=new E(c),l=m(i,u,f,v);c=v.bits,n.part2_3_length<=c||(n.assign(t),n.part2_3_length=c,n.region0_count=o[h-2],n.region1_count=h-2-o[h-2],n.table_select[0]=s[h-2],n.table_select[1]=a[h-2],n.table_select[2]=l)}}this.noquant_count_bits=function(r,t,n){var i=t.l3_enc,e=Math.min(576,t.max_nonzero_coeff+2>>1<<1);for(null!=n&&(n.sfb_count1=0);1<e&&0==(i[e-1]|i[e-2]);e-=2);t.count1=e;for(var o=0,s=0;3<e;e-=4){var a;if(1<(2147483647&(i[e-1]|i[e-2]|i[e-3]|i[e-4])))break;a=2*(2*(2*i[e-4]+i[e-3])+i[e-2])+i[e-1],o+=pr.t32l[a],s+=pr.t33l[a]}var f=o;if(t.count1table_select=0,s<o&&(f=s,t.count1table_select=1),t.count1bits=f,0==(t.big_values=e))return f;if(t.block_type==yr.SHORT_TYPE)(o=3*r.scalefac_band.s[3])>t.big_values&&(o=t.big_values),s=t.big_values;else if(t.block_type==yr.NORM_TYPE){if(o=t.region0_count=r.bv_scf[e-2],s=t.region1_count=r.bv_scf[e-1],s=r.scalefac_band.l[o+s+2],o=r.scalefac_band.l[o+1],s<e){var h=new E(f);t.table_select[2]=m(i,s,e,h),f=h.bits}}else t.region0_count=7,t.region1_count=yr.SBMAX_l-1-7-1,o=r.scalefac_band.l[8],(s=e)<o&&(o=s);if(o=Math.min(o,e),s=Math.min(s,e),0<o){var h=new E(f);t.table_select[0]=m(i,0,o,h),f=h.bits}if(o<s){var h=new E(f);t.table_select[1]=m(i,o,s,h),f=h.bits}if(2==r.use_best_huffman&&(t.part2_3_length=f,best_huffman_divide(r,t),f=t.part2_3_length),null!=n&&t.block_type==yr.NORM_TYPE){for(var u=0;r.scalefac_band.l[u]<t.big_values;)u++;n.sfb_count1=u}return f},this.count_bits=function(r,t,n,i){var e=n.l3_enc,o=Cr.IXMAX_VAL/b.IPOW20(n.global_gain);if(n.xrpow_max>o)return Cr.LARGE_BITS;if(function(r,t,n,i,e){var o,s,a,f=0,h=0,u=0,c=0,v=t,l=0,d=v,w=0,M=r,E=0;for(a=null!=e&&i.global_gain==e.global_gain,s=i.block_type==yr.SHORT_TYPE?38:21,o=0;o<=s;o++){var m=-1;if((a||i.block_type==yr.NORM_TYPE)&&(m=i.global_gain-(i.scalefac[o]+(0!=i.preflag?b.pretab[o]:0)<<i.scalefac_scale+1)-8*i.subblock_gain[i.window[o]]),Xr(0<=i.width[o]),a&&e.step[o]==m)0!=h&&(I(h,n,M,E,d,w),h=0),0!=u&&(p(u,n,M,E,d,w),u=0);else{var _,g=i.width[o];if(f+i.width[o]>i.max_nonzero_coeff&&(_=i.max_nonzero_coeff-f+1,Gr.fill(t,i.max_nonzero_coeff,576,0),(g=_)<0&&(g=0),o=s+1),0==h&&0==u&&(d=v,w=l,M=r,E=c),null!=e&&0<e.sfb_count1&&o>=e.sfb_count1&&0<e.step[o]&&m>=e.step[o]?(0!=h&&(I(h,n,M,E,d,w),h=0,d=v,w=l,M=r,E=c),u+=g):(0!=u&&(p(u,n,M,E,d,w),u=0,d=v,w=l,M=r,E=c),h+=g),g<=0){0!=u&&(p(u,n,M,E,d,w),u=0),0!=h&&(I(h,n,M,E,d,w),h=0);break}}o<=s&&(l+=i.width[o],c+=i.width[o],f+=i.width[o])}0!=h&&(I(h,n,M,E,d,w),h=0),0!=u&&(p(u,n,M,E,d,w),u=0)}(t,e,b.IPOW20(n.global_gain),n,i),0!=(2&r.substep_shaping))for(var s=0,a=n.global_gain+n.scalefac_scale,f=.634521682242439/b.IPOW20(a),h=0;h<n.sfbmax;h++){var u,c=n.width[h];if(0==r.pseudohalf[h])s+=c;else for(u=s,s+=c;u<s;++u)e[u]=t[u]>=f?e[u]:0}return this.noquant_count_bits(r,n,i)},this.best_huffman_divide=function(r,t){var n=new R,i=t.l3_enc,e=Ur(23),o=Ur(23),s=Ur(23),a=Ur(23);if(t.block_type!=yr.SHORT_TYPE||1!=r.mode_gr){n.assign(t),t.block_type==yr.NORM_TYPE&&(function(r,t,n,i,e,o,s){for(var a=t.big_values,f=0;f<=22;f++)i[f]=Cr.LARGE_BITS;for(var f=0;f<16;f++){var h=r.scalefac_band.l[f+1];if(a<=h)break;var u=0,c=new E(u),v=m(n,0,h,c);u=c.bits;for(var l=0;l<8;l++){var d=r.scalefac_band.l[f+l+2];if(a<=d)break;var w=u;c=new E(w);var M=m(n,h,d,c);w=c.bits,i[f+l]>w&&(i[f+l]=w,e[f+l]=f,o[f+l]=v,s[f+l]=M)}}}(r,t,i,e,o,s,a),l(r,n,t,i,e,o,s,a));var f=n.big_values;if(!(0==f||1<(i[f-2]|i[f-1])||576<(f=t.count1+2))){n.assign(t),n.count1=f;for(var h=0,u=0;f>n.big_values;f-=4){var c=2*(2*(2*i[f-4]+i[f-3])+i[f-2])+i[f-1];h+=pr.t32l[c],u+=pr.t33l[c]}if(n.big_values=f,n.count1table_select=0,u<h&&(h=u,n.count1table_select=1),n.count1bits=h,n.block_type==yr.NORM_TYPE)l(r,n,t,i,e,o,s,a);else{if(n.part2_3_length=h,h=r.scalefac_band.l[8],f<h&&(h=f),0<h){var v=new E(n.part2_3_length);n.table_select[0]=m(i,0,h,v),n.part2_3_length=v.bits}if(h<f){var v=new E(n.part2_3_length);n.table_select[1]=m(i,h,f,v),n.part2_3_length=v.bits}t.part2_3_length>n.part2_3_length&&t.assign(n)}}}};var v=[1,1,1,1,8,2,2,2,4,4,4,8,8,8,16,16],d=[1,2,4,8,1,2,4,8,2,4,8,2,4,8,4,8],w=[0,0,0,0,3,1,1,1,2,2,2,3,3,3,4,4],M=[0,1,2,3,0,1,2,3,1,2,3,1,2,3,2,3];r.slen1_tab=w,r.slen2_tab=M,this.best_scalefac_store=function(r,t,n,i){var e,o,s,a,f=i.tt[t][n],h=0;for(e=s=0;e<f.sfbmax;e++){var u=f.width[e];for(s+=u,a=-u;a<0&&0==f.l3_enc[a+s];a++);0==a&&(f.scalefac[e]=h=-2)}if(0==f.scalefac_scale&&0==f.preflag){var c=0;for(e=0;e<f.sfbmax;e++)0<f.scalefac[e]&&(c|=f.scalefac[e]);if(0==(1&c)&&0!=c){for(e=0;e<f.sfbmax;e++)0<f.scalefac[e]&&(f.scalefac[e]>>=1);f.scalefac_scale=h=1}}if(0==f.preflag&&f.block_type!=yr.SHORT_TYPE&&2==r.mode_gr){for(e=11;e<yr.SBPSY_l&&!(f.scalefac[e]<b.pretab[e]&&-2!=f.scalefac[e]);e++);if(e==yr.SBPSY_l){for(e=11;e<yr.SBPSY_l;e++)0<f.scalefac[e]&&(f.scalefac[e]-=b.pretab[e]);f.preflag=h=1}}for(o=0;o<4;o++)i.scfsi[n][o]=0;for(2==r.mode_gr&&1==t&&i.tt[0][n].block_type!=yr.SHORT_TYPE&&i.tt[1][n].block_type!=yr.SHORT_TYPE&&(function(r,t){for(var n,i=t.tt[1][r],e=t.tt[0][r],o=0;o<pr.scfsi_band.length-1;o++){for(n=pr.scfsi_band[o];n<pr.scfsi_band[o+1]&&!(e.scalefac[n]!=i.scalefac[n]&&0<=i.scalefac[n]);n++);if(n==pr.scfsi_band[o+1]){for(n=pr.scfsi_band[o];n<pr.scfsi_band[o+1];n++)i.scalefac[n]=-1;t.scfsi[r][o]=1}}var s=0,a=0;for(n=0;n<11;n++)-1!=i.scalefac[n]&&(a++,s<i.scalefac[n]&&(s=i.scalefac[n]));for(var f=0,h=0;n<yr.SBPSY_l;n++)-1!=i.scalefac[n]&&(h++,f<i.scalefac[n]&&(f=i.scalefac[n]));for(var o=0;o<16;o++)if(s<v[o]&&f<d[o]){var u=w[o]*a+M[o]*h;i.part2_length>u&&(i.part2_length=u,i.scalefac_compress=o)}}(n,i),h=0),e=0;e<f.sfbmax;e++)-2==f.scalefac[e]&&(f.scalefac[e]=0);0!=h&&(2==r.mode_gr?this.scale_bitcount(f):this.scale_bitcount_lsf(r,f))};var f=[0,18,36,54,54,36,54,72,54,72,90,72,90,108,108,126],h=[0,18,36,54,51,35,53,71,52,70,88,69,87,105,104,122],u=[0,10,20,30,33,21,31,41,32,42,52,43,53,63,64,74];this.scale_bitcount=function(r){var t,n,i,e=0,o=0,s=r.scalefac;if(Xr(function(r,t){for(var n=0;n<t;++n)if(r[n]<0)return!1;return!0}(s,r.sfbmax)),r.block_type==yr.SHORT_TYPE)i=f,0!=r.mixed_block_flag&&(i=h);else if(i=u,0==r.preflag){for(n=11;n<yr.SBPSY_l&&!(s[n]<b.pretab[n]);n++);if(n==yr.SBPSY_l)for(r.preflag=1,n=11;n<yr.SBPSY_l;n++)s[n]-=b.pretab[n]}for(n=0;n<r.sfbdivide;n++)e<s[n]&&(e=s[n]);for(;n<r.sfbmax;n++)o<s[n]&&(o=s[n]);for(r.part2_length=Cr.LARGE_BITS,t=0;t<16;t++)e<v[t]&&o<d[t]&&r.part2_length>i[t]&&(r.part2_length=i[t],r.scalefac_compress=t);return r.part2_length==Cr.LARGE_BITS};var _=[[15,15,7,7],[15,15,7,0],[7,3,0,0],[15,31,31,0],[7,7,7,0],[3,3,0,0]];this.scale_bitcount_lsf=function(r,t){var n,i,e,o,s,a,f,h,u=Ur(4),c=t.scalefac;for(n=0!=t.preflag?2:0,f=0;f<4;f++)u[f]=0;if(t.block_type==yr.SHORT_TYPE){i=1;var v=b.nr_of_sfb_block[n][i];for(e=h=0;e<4;e++)for(o=v[e]/3,f=0;f<o;f++,h++)for(s=0;s<3;s++)c[3*h+s]>u[e]&&(u[e]=c[3*h+s])}else{i=0;var v=b.nr_of_sfb_block[n][i];for(e=h=0;e<4;e++)for(o=v[e],f=0;f<o;f++,h++)c[h]>u[e]&&(u[e]=c[h])}for(a=!1,e=0;e<4;e++)u[e]>_[n][e]&&(a=!0);if(!a){var l,d,w,M;for(t.sfb_partition_table=b.nr_of_sfb_block[n][i],e=0;e<4;e++)t.slen[e]=g[u[e]];switch(l=t.slen[0],d=t.slen[1],w=t.slen[2],M=t.slen[3],n){case 0:t.scalefac_compress=(5*l+d<<4)+(w<<2)+M;break;case 1:t.scalefac_compress=400+(5*l+d<<2)+w;break;case 2:t.scalefac_compress=500+3*l+d;break;default:jr.err.printf("intensity stereo not implemented yet\n")}}if(!a)for(Xr(null!=t.sfb_partition_table),t.part2_length=0,e=0;e<4;e++)t.part2_length+=t.slen[e]*t.sfb_partition_table[e];return a};var g=[0,1,2,2,3,3,3,3,4,4,4,4,4,4,4,4];this.huffman_init=function(r){for(var t=2;t<=576;t+=2){for(var n,i=0;r.scalefac_band.l[++i]<t;);for(n=e[i][0];r.scalefac_band.l[n+1]>t;)n--;for(n<0&&(n=e[i][0]),r.bv_scf[t-2]=n,n=e[i][1];r.scalefac_band.l[n+r.bv_scf[t-2]+2]>t;)n--;n<0&&(n=e[i][1]),r.bv_scf[t-1]=n}}},Vr=h.System,Hr=h.Arrays,Kr=h.new_byte,Wr=h.new_float_n,zr=h.new_int,Qr=h.assert;function qr(){var f=this,c=null,v=null,o=null,l=null;this.setModules=function(r,t,n,i){c=r,v=t,o=n,l=i};var d=null,h=0,w=0,M=0;function E(r,t,n){for(;0<n;){var i;0==M&&(M=8,Qr(++w<Lame.LAME_MAXMP3BUFFER),Qr(r.header[r.w_ptr].write_timing>=h),r.header[r.w_ptr].write_timing==h&&(e=r,Vr.arraycopy(e.header[e.w_ptr].buf,0,d,w,e.sideinfo_len),w+=e.sideinfo_len,h+=8*e.sideinfo_len,e.w_ptr=e.w_ptr+1&or.MAX_HEADER_BUF-1),d[w]=0),i=Math.min(n,M),n-=i,M-=i,d[w]|=t>>n<<M,h+=i}var e}function s(r,t,n){for(;0<n;){var i;0==M&&(M=8,Qr(++w<Lame.LAME_MAXMP3BUFFER),d[w]=0),i=Math.min(n,M),n-=i,M-=i,d[w]|=t>>n<<M,h+=i}}function a(r,t){var n,i=r.internal_flags;if(8<=t&&(E(i,76,8),t-=8),8<=t&&(E(i,65,8),t-=8),8<=t&&(E(i,77,8),t-=8),8<=t&&(E(i,69,8),t-=8),32<=t){var e=o.getLameShortVersion();if(32<=t)for(n=0;n<e.length&&8<=t;++n)t-=8,E(i,e.charAt(n),8)}for(;1<=t;t-=1)E(i,i.ancillary_flag,1),i.ancillary_flag^=r.disable_reservoir?0:1}function u(r,t,n){for(var i=r.header[r.h_ptr].ptr;0<n;){var e=Math.min(n,8-(7&i));n-=e,r.header[r.h_ptr].buf[i>>3]|=t>>n<<8-(7&i)-e,i+=e}r.header[r.h_ptr].ptr=i}function e(r,t){r<<=8;for(var n=0;n<8;n++)0!=(65536&((t<<=1)^(r<<=1)))&&(t^=32773);return t}function m(r,t){var n,i=pr.ht[t.count1table_select+32],e=0,o=t.big_values,s=t.big_values;for(Qr(t.count1table_select<2),n=(t.count1-t.big_values)/4;0<n;--n){var a=0,f=0;0!=t.l3_enc[o+0]&&(f+=8,t.xr[s+0]<0&&a++),0!=t.l3_enc[o+1]&&(f+=4,a*=2,t.xr[s+1]<0&&a++),0!=t.l3_enc[o+2]&&(f+=2,a*=2,t.xr[s+2]<0&&a++),0!=t.l3_enc[o+3]&&(f++,a*=2,t.xr[s+3]<0&&a++),o+=4,s+=4,E(r,a+i.table[f],i.hlen[f]),e+=i.hlen[f]}return e}function _(r,t,n,i,e){var o=pr.ht[t],s=0;if(0==t)return s;for(var a=n;a<i;a+=2){var f=0,h=0,u=o.xlen,c=o.xlen,v=0,l=e.l3_enc[a],d=e.l3_enc[a+1];if(0!=l&&(e.xr[a]<0&&v++,f--),15<t){if(14<l){var w=l-15;Qr(w<=o.linmax),v|=w<<1,h=u,l=15}if(14<d){var M=d-15;Qr(M<=o.linmax),v<<=u,v|=M,h+=u,d=15}c=16}0!=d&&(v<<=1,e.xr[a+1]<0&&v++,f--),l=l*c+d,h-=f,f+=o.hlen[l],E(r,o.table[l],f),E(r,v,h),s+=f+h}return s}function g(r,t){var n=3*r.scalefac_band.s[3];n>t.big_values&&(n=t.big_values);var i=_(r,t.table_select[0],0,n,t);return i+=_(r,t.table_select[1],n,t.big_values,t)}function b(r,t){var n,i,e,o;n=t.big_values;var s=t.region0_count+1;return Qr(s<r.scalefac_band.l.length),e=r.scalefac_band.l[s],s+=t.region1_count+1,Qr(s<r.scalefac_band.l.length),o=r.scalefac_band.l[s],n<e&&(e=n),n<o&&(o=n),i=_(r,t.table_select[0],0,e,t),i+=_(r,t.table_select[1],e,o,t),i+=_(r,t.table_select[2],o,n,t)}function p(){this.total=0}function I(r,t){var n,i,e,o,s,a=r.internal_flags;return s=a.w_ptr,-1==(o=a.h_ptr-1)&&(o=or.MAX_HEADER_BUF-1),n=a.header[o].write_timing-h,0<=(t.total=n)&&(i=1+o-s,o<s&&(i=1+o-s+or.MAX_HEADER_BUF),n-=8*i*a.sideinfo_len),e=f.getframebits(r),n+=e,t.total+=e,t.total%8!=0?t.total=1+t.total/8:t.total=t.total/8,t.total+=w+1,n<0&&Vr.err.println("strange error flushing buffer ... \n"),n}this.getframebits=function(r){var t,n=r.internal_flags;t=0!=n.bitrate_index?pr.bitrate_table[r.version][n.bitrate_index]:r.brate;var i=0|72e3*(r.version+1)*t/r.out_samplerate+n.padding;return 8*i},this.CRC_writeheader=function(r,t){var n=65535;n=e(255&t[2],n),n=e(255&t[3],n);for(var i=6;i<r.sideinfo_len;i++)n=e(255&t[i],n);t[4]=byte(n>>8),t[5]=byte(255&n)},this.flush_bitstream=function(r){var t,n,i=r.internal_flags,e=i.h_ptr-1;if(-1==e&&(e=or.MAX_HEADER_BUF-1),t=i.l3_side,!((n=I(r,new p))<0)){if(a(r,n),Qr(i.header[e].write_timing+this.getframebits(r)==h),i.ResvSize=0,t.main_data_begin=0,i.findReplayGain){var o=c.GetTitleGain(i.rgdata);Qr(NEQ(o,GainAnalysis.GAIN_NOT_ENOUGH_SAMPLES)),i.RadioGain=0|Math.floor(10*o+.5)}i.findPeakSample&&(i.noclipGainChange=0|Math.ceil(20*Math.log10(i.PeakSample/32767)*10),0<i.noclipGainChange&&(EQ(r.scale,1)||EQ(r.scale,0))?i.noclipScale=Math.floor(32767/i.PeakSample*100)/100:i.noclipScale=-1)}},this.add_dummy_byte=function(r,t,n){for(var i,e=r.internal_flags;0<n--;)for(s(0,t,8),i=0;i<or.MAX_HEADER_BUF;++i)e.header[i].write_timing+=8},this.format_bitstream=function(r){var t,n=r.internal_flags;t=n.l3_side;var i=this.getframebits(r);a(r,t.resvDrain_pre),function(r,t){var n,i,e,o=r.internal_flags;if(n=o.l3_side,o.header[o.h_ptr].ptr=0,Hr.fill(o.header[o.h_ptr].buf,0,o.sideinfo_len,0),r.out_samplerate<16e3?u(o,4094,12):u(o,4095,12),u(o,r.version,1),u(o,1,2),u(o,r.error_protection?0:1,1),u(o,o.bitrate_index,4),u(o,o.samplerate_index,2),u(o,o.padding,1),u(o,r.extension,1),u(o,r.mode.ordinal(),2),u(o,o.mode_ext,2),u(o,r.copyright,1),u(o,r.original,1),u(o,r.emphasis,2),r.error_protection&&u(o,0,16),1==r.version){for(Qr(0<=n.main_data_begin),u(o,n.main_data_begin,9),2==o.channels_out?u(o,n.private_bits,3):u(o,n.private_bits,5),e=0;e<o.channels_out;e++){var s;for(s=0;s<4;s++)u(o,n.scfsi[e][s],1)}for(i=0;i<2;i++)for(e=0;e<o.channels_out;e++){var a=n.tt[i][e];u(o,a.part2_3_length+a.part2_length,12),u(o,a.big_values/2,9),u(o,a.global_gain,8),u(o,a.scalefac_compress,4),a.block_type!=yr.NORM_TYPE?(u(o,1,1),u(o,a.block_type,2),u(o,a.mixed_block_flag,1),14==a.table_select[0]&&(a.table_select[0]=16),u(o,a.table_select[0],5),14==a.table_select[1]&&(a.table_select[1]=16),u(o,a.table_select[1],5),u(o,a.subblock_gain[0],3),u(o,a.subblock_gain[1],3),u(o,a.subblock_gain[2],3)):(u(o,0,1),14==a.table_select[0]&&(a.table_select[0]=16),u(o,a.table_select[0],5),14==a.table_select[1]&&(a.table_select[1]=16),u(o,a.table_select[1],5),14==a.table_select[2]&&(a.table_select[2]=16),u(o,a.table_select[2],5),Qr(0<=a.region0_count&&a.region0_count<16),Qr(0<=a.region1_count&&a.region1_count<8),u(o,a.region0_count,4),u(o,a.region1_count,3)),u(o,a.preflag,1),u(o,a.scalefac_scale,1),u(o,a.count1table_select,1)}}else for(Qr(0<=n.main_data_begin),u(o,n.main_data_begin,8),u(o,n.private_bits,o.channels_out),e=i=0;e<o.channels_out;e++){var a=n.tt[i][e];u(o,a.part2_3_length+a.part2_length,12),u(o,a.big_values/2,9),u(o,a.global_gain,8),u(o,a.scalefac_compress,9),a.block_type!=yr.NORM_TYPE?(u(o,1,1),u(o,a.block_type,2),u(o,a.mixed_block_flag,1),14==a.table_select[0]&&(a.table_select[0]=16),u(o,a.table_select[0],5),14==a.table_select[1]&&(a.table_select[1]=16),u(o,a.table_select[1],5),u(o,a.subblock_gain[0],3),u(o,a.subblock_gain[1],3),u(o,a.subblock_gain[2],3)):(u(o,0,1),14==a.table_select[0]&&(a.table_select[0]=16),u(o,a.table_select[0],5),14==a.table_select[1]&&(a.table_select[1]=16),u(o,a.table_select[1],5),14==a.table_select[2]&&(a.table_select[2]=16),u(o,a.table_select[2],5),Qr(0<=a.region0_count&&a.region0_count<16),Qr(0<=a.region1_count&&a.region1_count<8),u(o,a.region0_count,4),u(o,a.region1_count,3)),u(o,a.scalefac_scale,1),u(o,a.count1table_select,1)}r.error_protection&&CRC_writeheader(o,o.header[o.h_ptr].buf);var f=o.h_ptr;Qr(o.header[f].ptr==8*o.sideinfo_len),o.h_ptr=f+1&or.MAX_HEADER_BUF-1,o.header[o.h_ptr].write_timing=o.header[f].write_timing+t,o.h_ptr==o.w_ptr&&Vr.err.println("Error: MAX_HEADER_BUF too small in bitstream.c \n")}(r,i);var e=8*n.sideinfo_len;if(e+=function(r){var t,n,i,e,o=0,s=r.internal_flags,a=s.l3_side;if(1==r.version)for(t=0;t<2;t++)for(n=0;n<s.channels_out;n++){var f=a.tt[t][n],h=xr.slen1_tab[f.scalefac_compress],u=xr.slen2_tab[f.scalefac_compress];for(i=e=0;i<f.sfbdivide;i++)-1!=f.scalefac[i]&&(E(s,f.scalefac[i],h),e+=h);for(;i<f.sfbmax;i++)-1!=f.scalefac[i]&&(E(s,f.scalefac[i],u),e+=u);Qr(e==f.part2_length),f.block_type==yr.SHORT_TYPE?e+=g(s,f):e+=b(s,f),e+=m(s,f),Qr(e==f.part2_3_length+f.part2_length),o+=e}else for(n=t=0;n<s.channels_out;n++){var c,v,f=a.tt[t][n],l=0;if(Qr(null!=f.sfb_partition_table),v=i=e=0,f.block_type==yr.SHORT_TYPE){for(;v<4;v++){var d=f.sfb_partition_table[v]/3,w=f.slen[v];for(c=0;c<d;c++,i++)E(s,Math.max(f.scalefac[3*i+0],0),w),E(s,Math.max(f.scalefac[3*i+1],0),w),E(s,Math.max(f.scalefac[3*i+2],0),w),l+=3*w}e+=g(s,f)}else{for(;v<4;v++){var d=f.sfb_partition_table[v],w=f.slen[v];for(c=0;c<d;c++,i++)E(s,Math.max(f.scalefac[i],0),w),l+=w}e+=b(s,f)}e+=m(s,f),Qr(e==f.part2_3_length),Qr(l==f.part2_length),o+=l+e}return o}(r),a(r,t.resvDrain_post),e+=t.resvDrain_post,t.main_data_begin+=(i-e)/8,I(r,new p)!=n.ResvSize&&Vr.err.println("Internal buffer inconsistency. flushbits <> ResvSize"),8*t.main_data_begin!=n.ResvSize&&(Vr.err.printf("bit reservoir error: \nl3_side.main_data_begin: %d \nResvoir size:             %d \nresv drain (post)         %d \nresv drain (pre)          %d \nheader and sideinfo:      %d \ndata bits:                %d \ntotal bits:               %d (remainder: %d) \nbitsperframe:             %d \n",8*t.main_data_begin,n.ResvSize,t.resvDrain_post,t.resvDrain_pre,8*n.sideinfo_len,e-t.resvDrain_post-8*n.sideinfo_len,e,e%8,i),Vr.err.println("This is a fatal error.  It has several possible causes:"),Vr.err.println("90%%  LAME compiled with buggy version of gcc using advanced optimizations"),Vr.err.println(" 9%%  Your system is overclocked"),Vr.err.println(" 1%%  bug in LAME encoding library"),n.ResvSize=8*t.main_data_begin),1e9<h){var o;for(o=0;o<or.MAX_HEADER_BUF;++o)n.header[o].write_timing-=h;h=0}return 0},this.copy_buffer=function(r,t,n,i,e){var o=w+1;if(o<=0)return 0;if(0!=i&&i<o)return-1;if(Vr.arraycopy(d,0,t,n,o),w=-1,(M=0)!=e){var s=zr(1);if(s[0]=r.nMusicCRC,l.updateMusicCRC(s,t,n,o),r.nMusicCRC=s[0],0<o&&(r.VBR_seek_table.nBytesWritten+=o),r.decode_on_the_fly)for(var a,f=Wr([2,1152]),h=o,u=-1;0!=u;)if(u=v.hip_decode1_unclipped(r.hip,t,n,h,f[0],f[1]),h=0,-1==u&&(u=0),0<u){if(r.findPeakSample){for(a=0;a<u;a++)f[0][a]>r.PeakSample?r.PeakSample=f[0][a]:-f[0][a]>r.PeakSample&&(r.PeakSample=-f[0][a]);if(1<r.channels_out)for(a=0;a<u;a++)f[1][a]>r.PeakSample?r.PeakSample=f[1][a]:-f[1][a]>r.PeakSample&&(r.PeakSample=-f[1][a])}if(r.findReplayGain&&c.AnalyzeSamples(r.rgdata,f[0],0,f[1],0,u,r.channels_out)==GainAnalysis.GAIN_ANALYSIS_ERROR)return-6}}return o},this.init_bit_stream_w=function(r){d=Kr(Lame.LAME_MAXMP3BUFFER),r.h_ptr=r.w_ptr=0,r.header[r.h_ptr].write_timing=0,w=-1,h=M=0}}qr.EQ=function(r,t){return Math.abs(r)>Math.abs(t)?Math.abs(r-t)<=1e-6*Math.abs(r):Math.abs(r-t)<=1e-6*Math.abs(t)},qr.NEQ=function(r,t){return!qr.EQ(r,t)};var Jr=qr,Zr=h.System,$r=h.VbrMode,rt=h.ShortBlock,tt=h.new_float,nt=h.new_int_n,it=h.new_short_n,et=h.assert,ot=function r(){var p,I,_,g,b,a=this;r.V9=410,r.V8=420,r.V7=430,r.V6=440,r.V5=450,r.V4=460,r.V3=470,r.V2=480,r.V1=490,r.V0=500,r.R3MIX=1e3,r.STANDARD=1001,r.EXTREME=1002,r.INSANE=1003,r.STANDARD_FAST=1004,r.EXTREME_FAST=1005,r.MEDIUM=1006,r.MEDIUM_FAST=1007,r.LAME_MAXMP3BUFFER=147456;var y,A,k,R=new K;function T(){this.mask_adjust=0,this.mask_adjust_short=0,this.bo_l_weight=tt(yr.SBMAX_l),this.bo_s_weight=tt(yr.SBMAX_s)}function O(){this.lowerlimit=0}function e(r,t){this.lowpass=t}this.enc=new yr,this.setModules=function(r,t,n,i,e,o,s,a,f){p=r,I=t,_=n,g=i,b=e,y=o,A=a,k=f,this.enc.setModules(I,R,g,y)};var P=4294479419;function L(r){return 1<r?0:r<=0?1:Math.cos(Math.PI/2*r)}function N(r,t){switch(r){case 44100:return t.version=1,0;case 48e3:return t.version=1;case 32e3:return t.version=1,2;case 22050:return t.version=0;case 24e3:return t.version=0,1;case 16e3:return t.version=0,2;case 11025:return t.version=0;case 12e3:return t.version=0,1;case 8e3:return t.version=0,2;default:return t.version=0,-1}}function S(r,t,n){n<16e3&&(t=2);for(var i=pr.bitrate_table[t][1],e=2;e<=14;e++)0<pr.bitrate_table[t][e]&&Math.abs(pr.bitrate_table[t][e]-r)<Math.abs(i-r)&&(i=pr.bitrate_table[t][e]);return i}function Y(r,t,n){n<16e3&&(t=2);for(var i=0;i<=14;i++)if(0<pr.bitrate_table[t][i]&&pr.bitrate_table[t][i]==r)return i;return-1}function D(r,t){var n=[new e(8,2e3),new e(16,3700),new e(24,3900),new e(32,5500),new e(40,7e3),new e(48,7500),new e(56,1e4),new e(64,11e3),new e(80,13500),new e(96,15100),new e(112,15600),new e(128,17e3),new e(160,17500),new e(192,18600),new e(224,19400),new e(256,19700),new e(320,20500)],i=a.nearestBitrateFullIndex(t);r.lowerlimit=n[i].lowpass}function B(r){var t=yr.BLKSIZE+r.framesize-yr.FFTOFFSET;return t=Math.max(t,512+r.framesize-32)}function F(r,t,n,i,e,o){var s=a.enc.lame_encode_mp3_frame(r,t,n,i,e,o);return r.frameNum++,s}function C(){this.n_in=0,this.n_out=0}function u(){this.num_used=0}function j(r,t,n){var i=Math.PI*t;(r/=n)<0&&(r=0),1<r&&(r=1);var e=r-.5,o=.42-.5*Math.cos(2*r*Math.PI)+.08*Math.cos(4*r*Math.PI);return Math.abs(e)<1e-9?i/Math.PI:o*Math.sin(n*i*e)/(Math.PI*n*e)}function c(r,t,n,i,e,o,s,a,f){var h,u,c=r.internal_flags,v=0,l=r.out_samplerate/function r(t,n){return 0!=n?r(n,t%n):t}(r.out_samplerate,r.in_samplerate);l>or.BPC&&(l=or.BPC);var d=Math.abs(c.resample_ratio-Math.floor(.5+c.resample_ratio))<1e-4?1:0,w=1/c.resample_ratio;1<w&&(w=1);var M=31;0==M%2&&--M;var E=(M+=d)+1;if(0==c.fill_buffer_resample_init){for(c.inbuf_old[0]=tt(E),c.inbuf_old[1]=tt(E),h=0;h<=2*l;++h)c.blackfilt[h]=tt(E);for(c.itime[0]=0,c.itime[1]=0,v=0;v<=2*l;v++){var m=0,_=(v-l)/(2*l);for(h=0;h<=M;h++)m+=c.blackfilt[v][h]=j(h-_,w,M);for(h=0;h<=M;h++)c.blackfilt[v][h]/=m}c.fill_buffer_resample_init=1}var g=c.inbuf_old[f];for(u=0;u<i;u++){var b,p;if(b=u*c.resample_ratio,v=0|Math.floor(b-c.itime[f]),s<=M+v-M/2)break;var _=b-c.itime[f]-(v+M%2*.5);p=0|Math.floor(2*_*l+l+.5);var I=0;for(h=0;h<=M;++h){var y,A=h+v-M/2;y=A<0?g[E+A]:e[o+A],I+=y*c.blackfilt[p][h]}t[n+u]=I}if(a.num_used=Math.min(s,M+v-M/2),c.itime[f]+=a.num_used-u*c.resample_ratio,a.num_used>=E)for(h=0;h<E;h++)g[h]=e[o+a.num_used+h-E];else{var k=E-a.num_used;for(h=0;h<k;++h)g[h]=g[h+a.num_used];for(v=0;h<E;++h,++v)g[h]=e[o+v];et(v==a.num_used)}return u}function G(r,t,n,i,e,o){var s=r.internal_flags;if(s.resample_ratio<.9999||1.0001<s.resample_ratio)for(var a=0;a<s.channels_out;a++){var f=new u;o.n_out=c(r,t[a],s.mf_size,r.framesize,n[a],i,e,f,a),o.n_in=f.num_used}else{o.n_out=Math.min(r.framesize,e),o.n_in=o.n_out;for(var h=0;h<o.n_out;++h)t[0][s.mf_size+h]=n[0][i+h],2==s.channels_out&&(t[1][s.mf_size+h]=n[1][i+h])}}this.lame_init=function(){var r,t,n=new z;return(r=n).class_id=P,t=r.internal_flags=new or,r.mode=MPEGMode.NOT_SET,r.original=1,r.in_samplerate=44100,r.num_channels=2,r.num_samples=-1,r.bWriteVbrTag=!0,r.quality=-1,r.short_blocks=null,t.subblock_gain=-1,r.lowpassfreq=0,r.highpassfreq=0,r.lowpasswidth=-1,r.highpasswidth=-1,r.VBR=$r.vbr_off,r.VBR_q=4,r.ATHcurve=-1,r.VBR_mean_bitrate_kbps=128,r.VBR_min_bitrate_kbps=0,r.VBR_max_bitrate_kbps=0,r.VBR_hard_min=0,t.VBR_min_bitrate=1,t.VBR_max_bitrate=13,r.quant_comp=-1,r.quant_comp_short=-1,r.msfix=-1,t.resample_ratio=1,t.OldValue[0]=180,t.OldValue[1]=180,t.CurrentStep[0]=4,t.CurrentStep[1]=4,t.masking_lower=1,t.nsPsy.attackthre=-1,t.nsPsy.attackthre_s=-1,r.scale=-1,r.athaa_type=-1,r.ATHtype=-1,r.athaa_loudapprox=-1,r.athaa_sensitivity=0,r.useTemporal=null,r.interChRatio=-1,t.mf_samples_to_encode=yr.ENCDELAY+yr.POSTDELAY,r.encoder_padding=0,t.mf_size=yr.ENCDELAY-yr.MDCTDELAY,r.findReplayGain=!1,r.decode_on_the_fly=!1,t.decode_on_the_fly=!1,t.findReplayGain=!1,t.findPeakSample=!1,t.RadioGain=0,t.AudiophileGain=0,t.noclipGainChange=0,t.noclipScale=-1,r.preset=0,r.write_id3tag_automatic=!0,n.lame_allocated_gfp=1,n},this.nearestBitrateFullIndex=function(r){var t=[8,16,24,32,40,48,56,64,80,96,112,128,160,192,224,256,320],n=0,i=0,e=0,o=0;o=t[16],i=t[e=16],n=16;for(var s=0;s<16;s++)if(Math.max(r,t[s+1])!=r){o=t[s+1],e=s+1,i=t[s],n=s;break}return r-i<o-r?n:e},this.lame_init_params=function(r){var t,n,i,e,o,s=r.internal_flags;if(s.Class_ID=0,null==s.ATH&&(s.ATH=new ar),null==s.PSY&&(s.PSY=new T),null==s.rgdata&&(s.rgdata=new dr),s.channels_in=r.num_channels,1==s.channels_in&&(r.mode=MPEGMode.MONO),s.channels_out=r.mode==MPEGMode.MONO?1:2,s.mode_ext=yr.MPG_MD_MS_LR,r.mode==MPEGMode.MONO&&(r.force_ms=!1),r.VBR==$r.vbr_off&&128!=r.VBR_mean_bitrate_kbps&&0==r.brate&&(r.brate=r.VBR_mean_bitrate_kbps),r.VBR==$r.vbr_off||r.VBR==$r.vbr_mtrh||r.VBR==$r.vbr_mt||(r.free_format=!1),r.VBR==$r.vbr_off&&0==r.brate&&Jr.EQ(r.compression_ratio,0)&&(r.compression_ratio=11.025),r.VBR==$r.vbr_off&&0<r.compression_ratio&&(0==r.out_samplerate&&(r.out_samplerate=map2MP3Frequency(int(.97*r.in_samplerate))),r.brate=0|16*r.out_samplerate*s.channels_out/(1e3*r.compression_ratio),s.samplerate_index=N(r.out_samplerate,r),r.free_format||(r.brate=S(r.brate,r.version,r.out_samplerate))),0!=r.out_samplerate&&(r.out_samplerate<16e3?(r.VBR_mean_bitrate_kbps=Math.max(r.VBR_mean_bitrate_kbps,8),r.VBR_mean_bitrate_kbps=Math.min(r.VBR_mean_bitrate_kbps,64)):r.out_samplerate<32e3?(r.VBR_mean_bitrate_kbps=Math.max(r.VBR_mean_bitrate_kbps,8),r.VBR_mean_bitrate_kbps=Math.min(r.VBR_mean_bitrate_kbps,160)):(r.VBR_mean_bitrate_kbps=Math.max(r.VBR_mean_bitrate_kbps,32),r.VBR_mean_bitrate_kbps=Math.min(r.VBR_mean_bitrate_kbps,320))),0==r.lowpassfreq){var a=16e3;switch(r.VBR){case $r.vbr_off:var f=new O;D(f,r.brate),a=f.lowerlimit;break;case $r.vbr_abr:var f=new O;D(f,r.VBR_mean_bitrate_kbps),a=f.lowerlimit;break;case $r.vbr_rh:var h=[19500,19e3,18600,18e3,17500,16e3,15600,14900,12500,1e4,3950];if(0<=r.VBR_q&&r.VBR_q<=9){var u=h[r.VBR_q],c=h[r.VBR_q+1],v=r.VBR_q_frac;a=linear_int(u,c,v)}else a=19500;break;default:var h=[19500,19e3,18500,18e3,17500,16500,15500,14500,12500,9500,3950];if(0<=r.VBR_q&&r.VBR_q<=9){var u=h[r.VBR_q],c=h[r.VBR_q+1],v=r.VBR_q_frac;a=linear_int(u,c,v)}else a=19500}r.mode!=MPEGMode.MONO||r.VBR!=$r.vbr_off&&r.VBR!=$r.vbr_abr||(a*=1.5),r.lowpassfreq=0|a}if(0==r.out_samplerate&&(2*r.lowpassfreq>r.in_samplerate&&(r.lowpassfreq=r.in_samplerate/2),r.out_samplerate=(t=0|r.lowpassfreq,n=r.in_samplerate,i=44100,48e3<=n?i=48e3:44100<=n?i=44100:32e3<=n?i=32e3:24e3<=n?i=24e3:22050<=n?i=22050:16e3<=n?i=16e3:12e3<=n?i=12e3:11025<=n?i=11025:8e3<=n&&(i=8e3),-1==t?i:(t<=15960&&(i=44100),t<=15250&&(i=32e3),t<=11220&&(i=24e3),t<=9970&&(i=22050),t<=7230&&(i=16e3),t<=5420&&(i=12e3),t<=4510&&(i=11025),t<=3970&&(i=8e3),n<i?44100<n?48e3:32e3<n?44100:24e3<n?32e3:22050<n?24e3:16e3<n?22050:12e3<n?16e3:11025<n?12e3:8e3<n?11025:8e3:i))),r.lowpassfreq=Math.min(20500,r.lowpassfreq),r.lowpassfreq=Math.min(r.out_samplerate/2,r.lowpassfreq),r.VBR==$r.vbr_off&&(r.compression_ratio=16*r.out_samplerate*s.channels_out/(1e3*r.brate)),r.VBR==$r.vbr_abr&&(r.compression_ratio=16*r.out_samplerate*s.channels_out/(1e3*r.VBR_mean_bitrate_kbps)),r.bWriteVbrTag||(r.findReplayGain=!1,r.decode_on_the_fly=!1,s.findPeakSample=!1),s.findReplayGain=r.findReplayGain,s.decode_on_the_fly=r.decode_on_the_fly,s.decode_on_the_fly&&(s.findPeakSample=!0),s.findReplayGain&&p.InitGainAnalysis(s.rgdata,r.out_samplerate)==GainAnalysis.INIT_GAIN_ANALYSIS_ERROR)return r.internal_flags=null,-6;switch(s.decode_on_the_fly&&!r.decode_only&&(null!=s.hip&&k.hip_decode_exit(s.hip),s.hip=k.hip_decode_init()),s.mode_gr=r.out_samplerate<=24e3?1:2,r.framesize=576*s.mode_gr,r.encoder_delay=yr.ENCDELAY,s.resample_ratio=r.in_samplerate/r.out_samplerate,r.VBR){case $r.vbr_mt:case $r.vbr_rh:case $r.vbr_mtrh:r.compression_ratio=[5.7,6.5,7.3,8.2,10,11.9,13,14,15,16.5][r.VBR_q];break;case $r.vbr_abr:r.compression_ratio=16*r.out_samplerate*s.channels_out/(1e3*r.VBR_mean_bitrate_kbps);break;default:r.compression_ratio=16*r.out_samplerate*s.channels_out/(1e3*r.brate)}if(r.mode==MPEGMode.NOT_SET&&(r.mode=MPEGMode.JOINT_STEREO),0<r.highpassfreq?(s.highpass1=2*r.highpassfreq,0<=r.highpasswidth?s.highpass2=2*(r.highpassfreq+r.highpasswidth):s.highpass2=2*r.highpassfreq,s.highpass1/=r.out_samplerate,s.highpass2/=r.out_samplerate):(s.highpass1=0,s.highpass2=0),0<r.lowpassfreq?(s.lowpass2=2*r.lowpassfreq,0<=r.lowpasswidth?(s.lowpass1=2*(r.lowpassfreq-r.lowpasswidth),s.lowpass1<0&&(s.lowpass1=0)):s.lowpass1=2*r.lowpassfreq,s.lowpass1/=r.out_samplerate,s.lowpass2/=r.out_samplerate):(s.lowpass1=0,s.lowpass2=0),function(r){var t=r.internal_flags,n=32,i=-1;if(0<t.lowpass1){for(var e=999,o=0;o<=31;o++){var s=o/31;s>=t.lowpass2&&(n=Math.min(n,o)),t.lowpass1<s&&s<t.lowpass2&&(e=Math.min(e,o))}t.lowpass1=999==e?(n-.75)/31:(e-.75)/31,t.lowpass2=n/31}if(0<t.highpass2&&t.highpass2<.75/31*.9&&(t.highpass1=0,t.highpass2=0,Zr.err.println("Warning: highpass filter disabled.  highpass frequency too small\n")),0<t.highpass2){for(var a=-1,o=0;o<=31;o++){var s=o/31;s<=t.highpass1&&(i=Math.max(i,o)),t.highpass1<s&&s<t.highpass2&&(a=Math.max(a,o))}t.highpass1=i/31,t.highpass2=-1==a?(i+.75)/31:(a+.75)/31}for(var o=0;o<32;o++){var f,h,s=o/31;f=t.highpass2>t.highpass1?L((t.highpass2-s)/(t.highpass2-t.highpass1+1e-20)):1,h=t.lowpass2>t.lowpass1?L((s-t.lowpass1)/(t.lowpass2-t.lowpass1+1e-20)):1,t.amp_filter[o]=f*h}}(r),s.samplerate_index=N(r.out_samplerate,r),s.samplerate_index<0)return r.internal_flags=null,-1;if(r.VBR==$r.vbr_off){if(r.free_format)s.bitrate_index=0;else if(r.brate=S(r.brate,r.version,r.out_samplerate),s.bitrate_index=Y(r.brate,r.version,r.out_samplerate),s.bitrate_index<=0)return r.internal_flags=null,-1}else s.bitrate_index=1;r.analysis&&(r.bWriteVbrTag=!1),null!=s.pinfo&&(r.bWriteVbrTag=!1),I.init_bit_stream_w(s);for(var l,d=s.samplerate_index+3*r.version+6*(r.out_samplerate<16e3?1:0),w=0;w<yr.SBMAX_l+1;w++)s.scalefac_band.l[w]=g.sfBandIndex[d].l[w];for(var w=0;w<yr.PSFB21+1;w++){var M=(s.scalefac_band.l[22]-s.scalefac_band.l[21])/yr.PSFB21,E=s.scalefac_band.l[21]+w*M;s.scalefac_band.psfb21[w]=E}s.scalefac_band.psfb21[yr.PSFB21]=576;for(var w=0;w<yr.SBMAX_s+1;w++)s.scalefac_band.s[w]=g.sfBandIndex[d].s[w];for(var w=0;w<yr.PSFB12+1;w++){var M=(s.scalefac_band.s[13]-s.scalefac_band.s[12])/yr.PSFB12,E=s.scalefac_band.s[12]+w*M;s.scalefac_band.psfb12[w]=E}for(s.scalefac_band.psfb12[yr.PSFB12]=192,1==r.version?s.sideinfo_len=1==s.channels_out?21:36:s.sideinfo_len=1==s.channels_out?13:21,r.error_protection&&(s.sideinfo_len+=2),o=void 0,o=(e=r).internal_flags,e.frameNum=0,e.write_id3tag_automatic&&A.id3tag_write_v2(e),o.bitrate_stereoMode_Hist=nt([16,5]),o.bitrate_blockType_Hist=nt([16,6]),o.PeakSample=0,e.bWriteVbrTag&&y.InitVbrTag(e),s.Class_ID=P,l=0;l<19;l++)s.nsPsy.pefirbuf[l]=700*s.mode_gr*s.channels_out;switch(-1==r.ATHtype&&(r.ATHtype=4),et(r.VBR_q<=9),et(0<=r.VBR_q),r.VBR){case $r.vbr_mt:r.VBR=$r.vbr_mtrh;case $r.vbr_mtrh:null==r.useTemporal&&(r.useTemporal=!1),_.apply_preset(r,500-10*r.VBR_q,0),r.quality<0&&(r.quality=LAME_DEFAULT_QUALITY),r.quality<5&&(r.quality=0),5<r.quality&&(r.quality=5),s.PSY.mask_adjust=r.maskingadjust,s.PSY.mask_adjust_short=r.maskingadjust_short,r.experimentalY?s.sfb21_extra=!1:s.sfb21_extra=44e3<r.out_samplerate,s.iteration_loop=new VBRNewIterationLoop(b);break;case $r.vbr_rh:_.apply_preset(r,500-10*r.VBR_q,0),s.PSY.mask_adjust=r.maskingadjust,s.PSY.mask_adjust_short=r.maskingadjust_short,r.experimentalY?s.sfb21_extra=!1:s.sfb21_extra=44e3<r.out_samplerate,6<r.quality&&(r.quality=6),r.quality<0&&(r.quality=LAME_DEFAULT_QUALITY),s.iteration_loop=new VBROldIterationLoop(b);break;default:var m;s.sfb21_extra=!1,r.quality<0&&(r.quality=LAME_DEFAULT_QUALITY),(m=r.VBR)==$r.vbr_off&&(r.VBR_mean_bitrate_kbps=r.brate),_.apply_preset(r,r.VBR_mean_bitrate_kbps,0),r.VBR=m,s.PSY.mask_adjust=r.maskingadjust,s.PSY.mask_adjust_short=r.maskingadjust_short,m==$r.vbr_off?s.iteration_loop=new _r(b):s.iteration_loop=new ABRIterationLoop(b)}if(et(0<=r.scale),r.VBR!=$r.vbr_off){if(s.VBR_min_bitrate=1,s.VBR_max_bitrate=14,r.out_samplerate<16e3&&(s.VBR_max_bitrate=8),0!=r.VBR_min_bitrate_kbps&&(r.VBR_min_bitrate_kbps=S(r.VBR_min_bitrate_kbps,r.version,r.out_samplerate),s.VBR_min_bitrate=Y(r.VBR_min_bitrate_kbps,r.version,r.out_samplerate),s.VBR_min_bitrate<0))return-1;if(0!=r.VBR_max_bitrate_kbps&&(r.VBR_max_bitrate_kbps=S(r.VBR_max_bitrate_kbps,r.version,r.out_samplerate),s.VBR_max_bitrate=Y(r.VBR_max_bitrate_kbps,r.version,r.out_samplerate),s.VBR_max_bitrate<0))return-1;r.VBR_min_bitrate_kbps=pr.bitrate_table[r.version][s.VBR_min_bitrate],r.VBR_max_bitrate_kbps=pr.bitrate_table[r.version][s.VBR_max_bitrate],r.VBR_mean_bitrate_kbps=Math.min(pr.bitrate_table[r.version][s.VBR_max_bitrate],r.VBR_mean_bitrate_kbps),r.VBR_mean_bitrate_kbps=Math.max(pr.bitrate_table[r.version][s.VBR_min_bitrate],r.VBR_mean_bitrate_kbps)}return r.tune&&(s.PSY.mask_adjust+=r.tune_value_a,s.PSY.mask_adjust_short+=r.tune_value_a),function(r){var t=r.internal_flags;switch(r.quality){default:case 9:t.psymodel=0,t.noise_shaping=0,t.noise_shaping_amp=0,t.noise_shaping_stop=0,t.use_best_huffman=0,t.full_outer_loop=0;break;case 8:r.quality=7;case 7:t.psymodel=1,t.noise_shaping=0,t.noise_shaping_amp=0,t.noise_shaping_stop=0,t.use_best_huffman=0,t.full_outer_loop=0;break;case 6:case 5:t.psymodel=1,0==t.noise_shaping&&(t.noise_shaping=1),t.noise_shaping_amp=0,t.noise_shaping_stop=0,-1==t.subblock_gain&&(t.subblock_gain=1),t.use_best_huffman=0,t.full_outer_loop=0;break;case 4:t.psymodel=1,0==t.noise_shaping&&(t.noise_shaping=1),t.noise_shaping_amp=0,t.noise_shaping_stop=0,-1==t.subblock_gain&&(t.subblock_gain=1),t.use_best_huffman=1,t.full_outer_loop=0;break;case 3:t.psymodel=1,0==t.noise_shaping&&(t.noise_shaping=1),t.noise_shaping_amp=1,-(t.noise_shaping_stop=1)==t.subblock_gain&&(t.subblock_gain=1),t.use_best_huffman=1,t.full_outer_loop=0;break;case 2:t.psymodel=1,0==t.noise_shaping&&(t.noise_shaping=1),0==t.substep_shaping&&(t.substep_shaping=2),t.noise_shaping_amp=1,-(t.noise_shaping_stop=1)==t.subblock_gain&&(t.subblock_gain=1),t.use_best_huffman=1,t.full_outer_loop=0;break;case 1:case 0:t.psymodel=1,0==t.noise_shaping&&(t.noise_shaping=1),0==t.substep_shaping&&(t.substep_shaping=2),t.noise_shaping_amp=2,-(t.noise_shaping_stop=1)==t.subblock_gain&&(t.subblock_gain=1),t.use_best_huffman=1,t.full_outer_loop=0}}(r),et(0<=r.scale),r.athaa_type<0?s.ATH.useAdjust=3:s.ATH.useAdjust=r.athaa_type,s.ATH.aaSensitivityP=Math.pow(10,r.athaa_sensitivity/-10),null==r.short_blocks&&(r.short_blocks=rt.short_block_allowed),r.short_blocks!=rt.short_block_allowed||r.mode!=MPEGMode.JOINT_STEREO&&r.mode!=MPEGMode.STEREO||(r.short_blocks=rt.short_block_coupled),r.quant_comp<0&&(r.quant_comp=1),r.quant_comp_short<0&&(r.quant_comp_short=0),r.msfix<0&&(r.msfix=0),r.exp_nspsytune=1|r.exp_nspsytune,r.internal_flags.nsPsy.attackthre<0&&(r.internal_flags.nsPsy.attackthre=K.NSATTACKTHRE),r.internal_flags.nsPsy.attackthre_s<0&&(r.internal_flags.nsPsy.attackthre_s=K.NSATTACKTHRE_S),et(0<=r.scale),r.scale<0&&(r.scale=1),r.ATHtype<0&&(r.ATHtype=4),r.ATHcurve<0&&(r.ATHcurve=4),r.athaa_loudapprox<0&&(r.athaa_loudapprox=2),r.interChRatio<0&&(r.interChRatio=0),null==r.useTemporal&&(r.useTemporal=!0),s.slot_lag=s.frac_SpF=0,r.VBR==$r.vbr_off&&(s.slot_lag=s.frac_SpF=72e3*(r.version+1)*r.brate%r.out_samplerate|0),g.iteration_init(r),R.psymodel_init(r),et(0<=r.scale),0},this.lame_encode_flush=function(r,t,n,i){var e,o,s,a,f=r.internal_flags,h=it([2,1152]),u=0,c=f.mf_samples_to_encode-yr.POSTDELAY,v=B(r);if(f.mf_samples_to_encode<1)return 0;for(e=0,r.in_samplerate!=r.out_samplerate&&(c+=16*r.out_samplerate/r.in_samplerate),(s=r.framesize-c%r.framesize)<576&&(s+=r.framesize),r.encoder_padding=s,a=(c+s)/r.framesize;0<a&&0<=u;){var l=v-f.mf_size,d=r.frameNum;l*=r.in_samplerate,1152<(l/=r.out_samplerate)&&(l=1152),l<1&&(l=1),o=i-e,0==i&&(o=0),u=this.lame_encode_buffer(r,h[0],h[1],l,t,n,o),n+=u,e+=u,a-=d!=r.frameNum?1:0}if(f.mf_samples_to_encode=0,u<0)return u;if(o=i-e,0==i&&(o=0),I.flush_bitstream(r),(u=I.copy_buffer(f,t,n,o,1))<0)return u;if(n+=u,o=i-(e+=u),0==i&&(o=0),r.write_id3tag_automatic){if(A.id3tag_write_v1(r),(u=I.copy_buffer(f,t,n,o,0))<0)return u;e+=u}return e},this.lame_encode_buffer=function(r,t,n,i,e,o,s){var a,f,h=r.internal_flags,u=[null,null];if(h.Class_ID!=P)return-3;if(0==i)return 0;f=i,(null==(a=h).in_buffer_0||a.in_buffer_nsamples<f)&&(a.in_buffer_0=tt(f),a.in_buffer_1=tt(f),a.in_buffer_nsamples=f),u[0]=h.in_buffer_0,u[1]=h.in_buffer_1;for(var c=0;c<i;c++)u[0][c]=t[c],1<h.channels_in&&(u[1][c]=n[c]);return function(r,t,n,i,e,o,s){var a,f,h,u,c,v=r.internal_flags,l=0,d=[null,null],w=[null,null];if(v.Class_ID!=P)return-3;if(0==i)return 0;if((c=I.copy_buffer(v,e,o,s,0))<0)return c;if(o+=c,l+=c,w[0]=t,w[1]=n,Jr.NEQ(r.scale,0)&&Jr.NEQ(r.scale,1))for(f=0;f<i;++f)w[0][f]*=r.scale,2==v.channels_out&&(w[1][f]*=r.scale);if(Jr.NEQ(r.scale_left,0)&&Jr.NEQ(r.scale_left,1))for(f=0;f<i;++f)w[0][f]*=r.scale_left;if(Jr.NEQ(r.scale_right,0)&&Jr.NEQ(r.scale_right,1))for(f=0;f<i;++f)w[1][f]*=r.scale_right;if(2==r.num_channels&&1==v.channels_out)for(f=0;f<i;++f)w[0][f]=.5*(w[0][f]+w[1][f]),w[1][f]=0;u=B(r),d[0]=v.mfbuf[0],d[1]=v.mfbuf[1];for(var M=0;0<i;){var E=[null,null],m=0,_=0;E[0]=w[0],E[1]=w[1];var g=new C;if(G(r,d,E,M,i,g),m=g.n_in,_=g.n_out,v.findReplayGain&&!v.decode_on_the_fly&&p.AnalyzeSamples(v.rgdata,d[0],v.mf_size,d[1],v.mf_size,_,v.channels_out)==GainAnalysis.GAIN_ANALYSIS_ERROR)return-6;if(i-=m,M+=m,v.channels_out,v.mf_size+=_,et(v.mf_size<=or.MFSIZE),v.mf_samples_to_encode<1&&(v.mf_samples_to_encode=yr.ENCDELAY+yr.POSTDELAY),v.mf_samples_to_encode+=_,v.mf_size>=u){var b=s-l;if(0==s&&(b=0),(a=F(r,d[0],d[1],e,o,b))<0)return a;for(o+=a,l+=a,v.mf_size-=r.framesize,v.mf_samples_to_encode-=r.framesize,h=0;h<v.channels_out;h++)for(f=0;f<v.mf_size;f++)d[h][f]=d[h][f+r.framesize]}}return l}(r,u[0],u[1],i,e,o,s)}},st=h.VbrMode,at=function(){function r(r,t,n,i,e,o,s,a,f,h,u,c,v,l,d){this.vbr_q=r,this.quant_comp=t,this.quant_comp_s=n,this.expY=i,this.st_lrm=e,this.st_s=o,this.masking_adj=s,this.masking_adj_short=a,this.ath_lower=f,this.ath_curve=h,this.ath_sensitivity=u,this.interch=c,this.safejoint=v,this.sfb21mod=l,this.msfix=d}function t(r,t,n,i,e,o,s,a,f,h,u,c,v,l){this.quant_comp=t,this.quant_comp_s=n,this.safejoint=i,this.nsmsfix=e,this.st_lrm=o,this.st_s=s,this.nsbass=a,this.scale=f,this.masking_adj=h,this.ath_lower=u,this.ath_curve=c,this.interch=v,this.sfscale=l}var s;this.setModules=function(r){s=r};var u=[new r(0,9,9,0,5.2,125,-4.2,-6.3,4.8,1,0,0,2,21,.97),new r(1,9,9,0,5.3,125,-3.6,-5.6,4.5,1.5,0,0,2,21,1.35),new r(2,9,9,0,5.6,125,-2.2,-3.5,2.8,2,0,0,2,21,1.49),new r(3,9,9,1,5.8,130,-1.8,-2.8,2.6,3,-4,0,2,20,1.64),new r(4,9,9,1,6,135,-.7,-1.1,1.1,3.5,-8,0,2,0,1.79),new r(5,9,9,1,6.4,140,.5,.4,-7.5,4,-12,2e-4,0,0,1.95),new r(6,9,9,1,6.6,145,.67,.65,-14.7,6.5,-19,4e-4,0,0,2.3),new r(7,9,9,1,6.6,145,.8,.75,-19.7,8,-22,6e-4,0,0,2.7),new r(8,9,9,1,6.6,145,1.2,1.15,-27.5,10,-23,7e-4,0,0,0),new r(9,9,9,1,6.6,145,1.6,1.6,-36,11,-25,8e-4,0,0,0),new r(10,9,9,1,6.6,145,2,2,-36,12,-25,8e-4,0,0,0)],c=[new r(0,9,9,0,4.2,25,-7,-4,7.5,1,0,0,2,26,.97),new r(1,9,9,0,4.2,25,-5.6,-3.6,4.5,1.5,0,0,2,21,1.35),new r(2,9,9,0,4.2,25,-4.4,-1.8,2,2,0,0,2,18,1.49),new r(3,9,9,1,4.2,25,-3.4,-1.25,1.1,3,-4,0,2,15,1.64),new r(4,9,9,1,4.2,25,-2.2,.1,0,3.5,-8,0,2,0,1.79),new r(5,9,9,1,4.2,25,-1,1.65,-7.7,4,-12,2e-4,0,0,1.95),new r(6,9,9,1,4.2,25,-0,2.47,-7.7,6.5,-19,4e-4,0,0,2),new r(7,9,9,1,4.2,25,.5,2,-14.5,8,-22,6e-4,0,0,2),new r(8,9,9,1,4.2,25,1,2.4,-22,10,-23,7e-4,0,0,2),new r(9,9,9,1,4.2,25,1.5,2.95,-30,11,-25,8e-4,0,0,2),new r(10,9,9,1,4.2,25,2,2.95,-36,12,-30,8e-4,0,0,2)];function i(r,t,n){var i,e,o=r.VBR==st.vbr_rh?u:c,s=r.VBR_q_frac,a=o[t],f=o[t+1],h=a;a.st_lrm=a.st_lrm+s*(f.st_lrm-a.st_lrm),a.st_s=a.st_s+s*(f.st_s-a.st_s),a.masking_adj=a.masking_adj+s*(f.masking_adj-a.masking_adj),a.masking_adj_short=a.masking_adj_short+s*(f.masking_adj_short-a.masking_adj_short),a.ath_lower=a.ath_lower+s*(f.ath_lower-a.ath_lower),a.ath_curve=a.ath_curve+s*(f.ath_curve-a.ath_curve),a.ath_sensitivity=a.ath_sensitivity+s*(f.ath_sensitivity-a.ath_sensitivity),a.interch=a.interch+s*(f.interch-a.interch),a.msfix=a.msfix+s*(f.msfix-a.msfix),i=r,(e=h.vbr_q)<0&&(e=0),9<e&&(e=9),i.VBR_q=e,(i.VBR_q_frac=0)!=n?r.quant_comp=h.quant_comp:0<Math.abs(r.quant_comp- -1)||(r.quant_comp=h.quant_comp),0!=n?r.quant_comp_short=h.quant_comp_s:0<Math.abs(r.quant_comp_short- -1)||(r.quant_comp_short=h.quant_comp_s),0!=h.expY&&(r.experimentalY=0!=h.expY),0!=n?r.internal_flags.nsPsy.attackthre=h.st_lrm:0<Math.abs(r.internal_flags.nsPsy.attackthre- -1)||(r.internal_flags.nsPsy.attackthre=h.st_lrm),0!=n?r.internal_flags.nsPsy.attackthre_s=h.st_s:0<Math.abs(r.internal_flags.nsPsy.attackthre_s- -1)||(r.internal_flags.nsPsy.attackthre_s=h.st_s),0!=n?r.maskingadjust=h.masking_adj:0<Math.abs(r.maskingadjust-0)||(r.maskingadjust=h.masking_adj),0!=n?r.maskingadjust_short=h.masking_adj_short:0<Math.abs(r.maskingadjust_short-0)||(r.maskingadjust_short=h.masking_adj_short),0!=n?r.ATHlower=-h.ath_lower/10:0<Math.abs(10*-r.ATHlower-0)||(r.ATHlower=-h.ath_lower/10),0!=n?r.ATHcurve=h.ath_curve:0<Math.abs(r.ATHcurve- -1)||(r.ATHcurve=h.ath_curve),0!=n?r.athaa_sensitivity=h.ath_sensitivity:0<Math.abs(r.athaa_sensitivity- -1)||(r.athaa_sensitivity=h.ath_sensitivity),0<h.interch&&(0!=n?r.interChRatio=h.interch:0<Math.abs(r.interChRatio- -1)||(r.interChRatio=h.interch)),0<h.safejoint&&(r.exp_nspsytune=r.exp_nspsytune|h.safejoint),0<h.sfb21mod&&(r.exp_nspsytune=r.exp_nspsytune|h.sfb21mod<<20),0!=n?r.msfix=h.msfix:0<Math.abs(r.msfix- -1)||(r.msfix=h.msfix),0==n&&(r.VBR_q=t,r.VBR_q_frac=s)}var a=[new t(8,9,9,0,0,6.6,145,0,.95,0,-30,11,.0012,1),new t(16,9,9,0,0,6.6,145,0,.95,0,-25,11,.001,1),new t(24,9,9,0,0,6.6,145,0,.95,0,-20,11,.001,1),new t(32,9,9,0,0,6.6,145,0,.95,0,-15,11,.001,1),new t(40,9,9,0,0,6.6,145,0,.95,0,-10,11,9e-4,1),new t(48,9,9,0,0,6.6,145,0,.95,0,-10,11,9e-4,1),new t(56,9,9,0,0,6.6,145,0,.95,0,-6,11,8e-4,1),new t(64,9,9,0,0,6.6,145,0,.95,0,-2,11,8e-4,1),new t(80,9,9,0,0,6.6,145,0,.95,0,0,8,7e-4,1),new t(96,9,9,0,2.5,6.6,145,0,.95,0,1,5.5,6e-4,1),new t(112,9,9,0,2.25,6.6,145,0,.95,0,2,4.5,5e-4,1),new t(128,9,9,0,1.95,6.4,140,0,.95,0,3,4,2e-4,1),new t(160,9,9,1,1.79,6,135,0,.95,-2,5,3.5,0,1),new t(192,9,9,1,1.49,5.6,125,0,.97,-4,7,3,0,0),new t(224,9,9,1,1.25,5.2,125,0,.98,-6,9,2,0,0),new t(256,9,9,1,.97,5.2,125,0,1,-8,10,1,0,0),new t(320,9,9,1,.9,5.2,125,0,1,-10,12,0,0,0)];function e(r,t,n){var i=t,e=s.nearestBitrateFullIndex(t);if(r.VBR=st.vbr_abr,r.VBR_mean_bitrate_kbps=i,r.VBR_mean_bitrate_kbps=Math.min(r.VBR_mean_bitrate_kbps,320),r.VBR_mean_bitrate_kbps=Math.max(r.VBR_mean_bitrate_kbps,8),r.brate=r.VBR_mean_bitrate_kbps,320<r.VBR_mean_bitrate_kbps&&(r.disable_reservoir=!0),0<a[e].safejoint&&(r.exp_nspsytune=2|r.exp_nspsytune),0<a[e].sfscale&&(r.internal_flags.noise_shaping=2),0<Math.abs(a[e].nsbass)){var o=int(4*a[e].nsbass);o<0&&(o+=64),r.exp_nspsytune=r.exp_nspsytune|o<<2}return 0!=n?r.quant_comp=a[e].quant_comp:0<Math.abs(r.quant_comp- -1)||(r.quant_comp=a[e].quant_comp),0!=n?r.quant_comp_short=a[e].quant_comp_s:0<Math.abs(r.quant_comp_short- -1)||(r.quant_comp_short=a[e].quant_comp_s),0!=n?r.msfix=a[e].nsmsfix:0<Math.abs(r.msfix- -1)||(r.msfix=a[e].nsmsfix),0!=n?r.internal_flags.nsPsy.attackthre=a[e].st_lrm:0<Math.abs(r.internal_flags.nsPsy.attackthre- -1)||(r.internal_flags.nsPsy.attackthre=a[e].st_lrm),0!=n?r.internal_flags.nsPsy.attackthre_s=a[e].st_s:0<Math.abs(r.internal_flags.nsPsy.attackthre_s- -1)||(r.internal_flags.nsPsy.attackthre_s=a[e].st_s),0!=n?r.scale=a[e].scale:0<Math.abs(r.scale- -1)||(r.scale=a[e].scale),0!=n?r.maskingadjust=a[e].masking_adj:0<Math.abs(r.maskingadjust-0)||(r.maskingadjust=a[e].masking_adj),0<a[e].masking_adj?0!=n?r.maskingadjust_short=.9*a[e].masking_adj:0<Math.abs(r.maskingadjust_short-0)||(r.maskingadjust_short=.9*a[e].masking_adj):0!=n?r.maskingadjust_short=1.1*a[e].masking_adj:0<Math.abs(r.maskingadjust_short-0)||(r.maskingadjust_short=1.1*a[e].masking_adj),0!=n?r.ATHlower=-a[e].ath_lower/10:0<Math.abs(10*-r.ATHlower-0)||(r.ATHlower=-a[e].ath_lower/10),0!=n?r.ATHcurve=a[e].ath_curve:0<Math.abs(r.ATHcurve- -1)||(r.ATHcurve=a[e].ath_curve),0!=n?r.interChRatio=a[e].interch:0<Math.abs(r.interChRatio- -1)||(r.interChRatio=a[e].interch),t}this.apply_preset=function(r,t,n){switch(t){case Lame.R3MIX:t=Lame.V3,r.VBR=st.vbr_mtrh;break;case Lame.MEDIUM:t=Lame.V4,r.VBR=st.vbr_rh;break;case Lame.MEDIUM_FAST:t=Lame.V4,r.VBR=st.vbr_mtrh;break;case Lame.STANDARD:t=Lame.V2,r.VBR=st.vbr_rh;break;case Lame.STANDARD_FAST:t=Lame.V2,r.VBR=st.vbr_mtrh;break;case Lame.EXTREME:t=Lame.V0,r.VBR=st.vbr_rh;break;case Lame.EXTREME_FAST:t=Lame.V0,r.VBR=st.vbr_mtrh;break;case Lame.INSANE:return t=320,r.preset=t,e(r,t,n),r.VBR=st.vbr_off,t}switch(r.preset=t){case Lame.V9:return i(r,9,n),t;case Lame.V8:return i(r,8,n),t;case Lame.V7:return i(r,7,n),t;case Lame.V6:return i(r,6,n),t;case Lame.V5:return i(r,5,n),t;case Lame.V4:return i(r,4,n),t;case Lame.V3:return i(r,3,n),t;case Lame.V2:return i(r,2,n),t;case Lame.V1:return i(r,1,n),t;case Lame.V0:return i(r,0,n),t}return 8<=t&&t<=320?e(r,t,n):(r.preset=0,t)}},ft=function(){this.setModules=function(r,t){}},ht=function(){this.over_noise=0,this.tot_noise=0,this.max_noise=0,this.over_count=0,this.over_SSD=0,this.bits=0},ut=h.new_float,ct=h.new_int,vt=function(){this.global_gain=0,this.sfb_count1=0,this.step=ct(39),this.noise=ut(39),this.noise_log=ut(39)},lt=h.System,dt=h.VbrMode,wt=h.Util,Mt=h.Arrays,Et=h.new_float,mt=h.assert,_t=function(){var E,_,b;this.rv=null,this.qupvt=null;var p,e=new ft;function I(r){this.ordinal=r}function a(r){for(var t=0;t<r.sfbmax;t++)if(r.scalefac[t]+r.subblock_gain[r.window[t]]==0)return!1;return!0}function y(r,t,n,i,e){var o;switch(r){default:case 9:0<t.over_count?(o=n.over_SSD<=t.over_SSD,n.over_SSD==t.over_SSD&&(o=n.bits<t.bits)):o=n.max_noise<0&&10*n.max_noise+n.bits<=10*t.max_noise+t.bits;break;case 0:o=n.over_count<t.over_count||n.over_count==t.over_count&&n.over_noise<t.over_noise||n.over_count==t.over_count&&BitStream.EQ(n.over_noise,t.over_noise)&&n.tot_noise<t.tot_noise;break;case 8:n.max_noise=function(r,t){for(var n=1e-37,i=0;i<t.psymax;i++)n+=(e=r[i],wt.FAST_LOG10(.368+.632*e*e*e));var e;return Math.max(1e-20,n)}(e,i);case 1:o=n.max_noise<t.max_noise;break;case 2:o=n.tot_noise<t.tot_noise;break;case 3:o=n.tot_noise<t.tot_noise&&n.max_noise<t.max_noise;break;case 4:o=n.max_noise<=0&&.2<t.max_noise||n.max_noise<=0&&t.max_noise<0&&t.max_noise>n.max_noise-.2&&n.tot_noise<t.tot_noise||n.max_noise<=0&&0<t.max_noise&&t.max_noise>n.max_noise-.2&&n.tot_noise<t.tot_noise+t.over_noise||0<n.max_noise&&-.05<t.max_noise&&t.max_noise>n.max_noise-.1&&n.tot_noise+n.over_noise<t.tot_noise+t.over_noise||0<n.max_noise&&-.1<t.max_noise&&t.max_noise>n.max_noise-.15&&n.tot_noise+n.over_noise+n.over_noise<t.tot_noise+t.over_noise+t.over_noise;break;case 5:o=n.over_noise<t.over_noise||BitStream.EQ(n.over_noise,t.over_noise)&&n.tot_noise<t.tot_noise;break;case 6:o=n.over_noise<t.over_noise||BitStream.EQ(n.over_noise,t.over_noise)&&(n.max_noise<t.max_noise||BitStream.EQ(n.max_noise,t.max_noise)&&n.tot_noise<=t.tot_noise);break;case 7:o=n.over_count<t.over_count||n.over_noise<t.over_noise}return 0==t.over_count&&(o=o&&n.bits<t.bits),o}function A(r,t,n,i,e){var o=r.internal_flags;!function(r,t,n,i,e){var o,s=r.internal_flags;o=0==t.scalefac_scale?1.2968395546510096:1.6817928305074292;for(var a=0,f=0;f<t.sfbmax;f++)a<n[f]&&(a=n[f]);var h=s.noise_shaping_amp;switch(3==h&&(h=e?2:1),h){case 2:break;case 1:1<a?a=Math.pow(a,.5):a*=.95;break;case 0:default:1<a?a=1:a*=.95}for(var u=0,f=0;f<t.sfbmax;f++){var c,v=t.width[f];if(u+=v,!(n[f]<a)){if(0!=(2&s.substep_shaping)&&(s.pseudohalf[f]=0==s.pseudohalf[f]?1:0,0==s.pseudohalf[f]&&2==s.noise_shaping_amp))return;for(t.scalefac[f]++,c=-v;c<0;c++)i[u+c]*=o,i[u+c]>t.xrpow_max&&(t.xrpow_max=i[u+c]);if(2==s.noise_shaping_amp)return}}}(r,t,n,i,e);var s=a(t);return!(s||(s=2==o.mode_gr?p.scale_bitcount(t):p.scale_bitcount_lsf(o,t))&&(1<o.noise_shaping&&(Mt.fill(o.pseudohalf,0),0==t.scalefac_scale?(function(r,t){for(var n=0,i=0;i<r.sfbmax;i++){var e=r.width[i],o=r.scalefac[i];if(0!=r.preflag&&(o+=b.pretab[i]),n+=e,0!=(1&o)){o++;for(var s=-e;s<0;s++)t[n+s]*=1.2968395546510096,t[n+s]>r.xrpow_max&&(r.xrpow_max=t[n+s])}r.scalefac[i]=o>>1}r.preflag=0,r.scalefac_scale=1}(t,i),s=!1):t.block_type==yr.SHORT_TYPE&&0<o.subblock_gain&&(s=function(r,t,n){var i,e=t.scalefac;for(i=0;i<t.sfb_lmax;i++)if(16<=e[i])return!0;for(var o=0;o<3;o++){var s=0,a=0;for(i=t.sfb_lmax+o;i<t.sfbdivide;i+=3)s<e[i]&&(s=e[i]);for(;i<t.sfbmax;i+=3)a<e[i]&&(a=e[i]);if(!(s<16&&a<8)){if(7<=t.subblock_gain[o])return!0;t.subblock_gain[o]++;var f=r.scalefac_band.l[t.sfb_lmax];for(i=t.sfb_lmax+o;i<t.sfbmax;i+=3){var h=t.width[i],u=e[i];if(0<=(u-=4>>t.scalefac_scale))e[i]=u,f+=3*h;else{e[i]=0;var c=210+(u<<t.scalefac_scale+1);l=b.IPOW20(c),f+=h*(o+1);for(var v=-h;v<0;v++)n[f+v]*=l,n[f+v]>t.xrpow_max&&(t.xrpow_max=n[f+v]);f+=h*(3-o-1)}}var l=b.IPOW20(202);f+=t.width[i]*(o+1);for(var v=-t.width[i];v<0;v++)n[f+v]*=l,n[f+v]>t.xrpow_max&&(t.xrpow_max=n[f+v])}}return!1}(o,t,i)||a(t))),s||(s=2==o.mode_gr?p.scale_bitcount(t):p.scale_bitcount_lsf(o,t)),s))}this.setModules=function(r,t,n,i){E=r,_=t,this.rv=t,b=n,this.qupvt=n,p=i,e.setModules(b,p)},this.ms_convert=function(r,t){for(var n=0;n<576;++n){var i=r.tt[t][0].xr[n],e=r.tt[t][1].xr[n];r.tt[t][0].xr[n]=(i+e)*(.5*wt.SQRT2),r.tt[t][1].xr[n]=(i-e)*(.5*wt.SQRT2)}},this.init_xrpow=function(r,t,n){var i=0,e=0|t.max_nonzero_coeff;if(t.xrpow_max=0,Mt.fill(n,e,576,0),1e-20<(i=function(r,t,n,i){for(var e=i=0;e<=n;++e){var o=Math.abs(r.xr[e]);i+=o,t[e]=Math.sqrt(o*Math.sqrt(o)),t[e]>r.xrpow_max&&(r.xrpow_max=t[e])}return i}(t,n,e,i))){var o=0;0!=(2&r.substep_shaping)&&(o=1);for(var s=0;s<t.psymax;s++)r.pseudohalf[s]=o;return!0}return Mt.fill(t.l3_enc,0,576,0),!1},this.init_outer_loop=function(r,t){t.part2_3_length=0,t.big_values=0,t.count1=0,t.global_gain=210,t.scalefac_compress=0,t.table_select[0]=0,t.table_select[1]=0,t.table_select[2]=0,t.subblock_gain[0]=0,t.subblock_gain[1]=0,t.subblock_gain[2]=0,t.subblock_gain[3]=0,t.region0_count=0,t.region1_count=0,t.preflag=0,t.scalefac_scale=0,t.count1table_select=0,t.part2_length=0,t.sfb_lmax=yr.SBPSY_l,t.sfb_smin=yr.SBPSY_s,t.psy_lmax=r.sfb21_extra?yr.SBMAX_l:yr.SBPSY_l,t.psymax=t.psy_lmax,t.sfbmax=t.sfb_lmax,t.sfbdivide=11;for(var n=0;n<yr.SBMAX_l;n++)t.width[n]=r.scalefac_band.l[n+1]-r.scalefac_band.l[n],t.window[n]=3;if(t.block_type==yr.SHORT_TYPE){var i=Et(576);t.sfb_smin=0,(t.sfb_lmax=0)!=t.mixed_block_flag&&(t.sfb_smin=3,t.sfb_lmax=2*r.mode_gr+4),t.psymax=t.sfb_lmax+3*((r.sfb21_extra?yr.SBMAX_s:yr.SBPSY_s)-t.sfb_smin),t.sfbmax=t.sfb_lmax+3*(yr.SBPSY_s-t.sfb_smin),t.sfbdivide=t.sfbmax-18,t.psy_lmax=t.sfb_lmax;var e=r.scalefac_band.l[t.sfb_lmax];lt.arraycopy(t.xr,0,i,0,576);for(var n=t.sfb_smin;n<yr.SBMAX_s;n++)for(var o=r.scalefac_band.s[n],s=r.scalefac_band.s[n+1],a=0;a<3;a++)for(var f=o;f<s;f++)t.xr[e++]=i[3*f+a];for(var h=t.sfb_lmax,n=t.sfb_smin;n<yr.SBMAX_s;n++)t.width[h]=t.width[h+1]=t.width[h+2]=r.scalefac_band.s[n+1]-r.scalefac_band.s[n],t.window[h]=0,t.window[h+1]=1,t.window[h+2]=2,h+=3}t.count1bits=0,t.sfb_partition_table=b.nr_of_sfb_block[0][0],t.slen[0]=0,t.slen[1]=0,t.slen[2]=0,t.slen[3]=0,t.max_nonzero_coeff=575,Mt.fill(t.scalefac,0),function(r,t){var n=r.ATH,i=t.xr;if(t.block_type!=yr.SHORT_TYPE)for(var e=!1,o=yr.PSFB21-1;0<=o&&!e;o--){var s=r.scalefac_band.psfb21[o],a=r.scalefac_band.psfb21[o+1],f=b.athAdjust(n.adjust,n.psfb21[o],n.floor);1e-12<r.nsPsy.longfact[21]&&(f*=r.nsPsy.longfact[21]);for(var h=a-1;s<=h;h--){if(!(Math.abs(i[h])<f)){e=!0;break}i[h]=0}}else for(var u=0;u<3;u++)for(var e=!1,o=yr.PSFB12-1;0<=o&&!e;o--){var s=3*r.scalefac_band.s[12]+(r.scalefac_band.s[13]-r.scalefac_band.s[12])*u+(r.scalefac_band.psfb12[o]-r.scalefac_band.psfb12[0]),a=s+(r.scalefac_band.psfb12[o+1]-r.scalefac_band.psfb12[o]),c=b.athAdjust(n.adjust,n.psfb12[o],n.floor);1e-12<r.nsPsy.shortfact[12]&&(c*=r.nsPsy.shortfact[12]);for(var h=a-1;s<=h;h--){if(!(Math.abs(i[h])<c)){e=!0;break}i[h]=0}}}(r,t)},I.BINSEARCH_NONE=new I(0),I.BINSEARCH_UP=new I(1),I.BINSEARCH_DOWN=new I(2),this.trancate_smallspectrums=function(r,t,n,i){var e=Et(k.SFBMAX);if((0!=(4&r.substep_shaping)||t.block_type!=yr.SHORT_TYPE)&&0==(128&r.substep_shaping)){b.calc_noise(t,n,e,new ht,null);for(var o=0;o<576;o++){var s=0;0!=t.l3_enc[o]&&(s=Math.abs(t.xr[o])),i[o]=s}var o=0,a=8;t.block_type==yr.SHORT_TYPE&&(a=6);do{var f,h,u,c,v=t.width[a];if(o+=v,!(1<=e[a]||(Mt.sort(i,o-v,v),BitStream.EQ(i[o-1],0)))){f=(1-e[a])*n[a],c=h=0;do{var l;for(u=1;c+u<v&&!BitStream.NEQ(i[c+o-v],i[c+o+u-v]);u++);if(l=i[c+o-v]*i[c+o-v]*u,f<l){0!=c&&(h=i[c+o-v-1]);break}f-=l,c+=u}while(c<v);if(!BitStream.EQ(h,0))for(;Math.abs(t.xr[o-v])<=h&&(t.l3_enc[o-v]=0),0<--v;);}}while(++a<t.psymax);t.part2_3_length=p.noquant_count_bits(r,t,null)}},this.outer_loop=function(r,t,n,i,e,o){var s=r.internal_flags,a=new R,f=Et(576),h=Et(k.SFBMAX),u=new ht,c=new vt,v=9999999,l=!1,d=!1,w=0;if(function(r,t,n,i,e){var o,s=r.CurrentStep[i],a=!1,f=r.OldValue[i],h=I.BINSEARCH_NONE;for(t.global_gain=f,n-=t.part2_length;;){var u;if(o=p.count_bits(r,e,t,null),1==s||o==n)break;n<o?(h==I.BINSEARCH_DOWN&&(a=!0),a&&(s/=2),h=I.BINSEARCH_UP,u=s):(h==I.BINSEARCH_UP&&(a=!0),a&&(s/=2),h=I.BINSEARCH_DOWN,u=-s),t.global_gain+=u,t.global_gain<0&&(t.global_gain=0,a=!0),255<t.global_gain&&(t.global_gain=255,a=!0)}for(mt(0<=t.global_gain),mt(t.global_gain<256);n<o&&t.global_gain<255;)t.global_gain++,o=p.count_bits(r,e,t,null);r.CurrentStep[i]=4<=f-t.global_gain?4:2,r.OldValue[i]=t.global_gain,t.part2_3_length=o}(s,t,o,e,i),0==s.noise_shaping)return 100;b.calc_noise(t,n,h,u,c),u.bits=t.part2_3_length,a.assign(t);var M=0;for(lt.arraycopy(i,0,f,0,576);!l;){do{var E,m=new ht,_=255;if(E=0!=(2&s.substep_shaping)?20:3,s.sfb21_extra){if(1<h[a.sfbmax])break;if(a.block_type==yr.SHORT_TYPE&&(1<h[a.sfbmax+1]||1<h[a.sfbmax+2]))break}if(!A(r,a,h,i,d))break;0!=a.scalefac_scale&&(_=254);var g=o-a.part2_length;if(g<=0)break;for(;(a.part2_3_length=p.count_bits(s,i,a,c))>g&&a.global_gain<=_;)a.global_gain++;if(a.global_gain>_)break;if(0==u.over_count){for(;(a.part2_3_length=p.count_bits(s,i,a,c))>v&&a.global_gain<=_;)a.global_gain++;if(a.global_gain>_)break}if(b.calc_noise(a,n,h,m,c),m.bits=a.part2_3_length,0!=(y(t.block_type!=yr.SHORT_TYPE?r.quant_comp:r.quant_comp_short,u,m,a,h)?1:0))v=t.part2_3_length,u=m,t.assign(a),M=0,lt.arraycopy(i,0,f,0,576);else if(0==s.full_outer_loop){if(++M>E&&0==u.over_count)break;if(3==s.noise_shaping_amp&&d&&30<M)break;if(3==s.noise_shaping_amp&&d&&15<a.global_gain-w)break}}while(a.global_gain+a.scalefac_scale<255);3==s.noise_shaping_amp?d?l=!0:(a.assign(t),lt.arraycopy(f,0,i,0,576),M=0,w=a.global_gain,d=!0):l=!0}return mt(t.global_gain+t.scalefac_scale<=255),r.VBR==dt.vbr_rh||r.VBR==dt.vbr_mtrh?lt.arraycopy(f,0,i,0,576):0!=(1&s.substep_shaping)&&trancate_smallspectrums(s,t,n,i),u.over_count},this.iteration_finish_one=function(r,t,n){var i=r.l3_side,e=i.tt[t][n];p.best_scalefac_store(r,t,n,i),1==r.use_best_huffman&&p.best_huffman_divide(r,e),_.ResvAdjust(r,e)},this.VBR_encode_granule=function(r,t,n,i,e,o,s){var a,f=r.internal_flags,h=new R,u=Et(576),c=s,v=s+1,l=(s+o)/2,d=0,w=f.sfb21_extra;for(mt(c<=LameInternalFlags.MAX_BITS_PER_CHANNEL),Mt.fill(h.l3_enc,0);f.sfb21_extra=!(c-42<l)&&w,outer_loop(r,t,n,i,e,l)<=0?(d=1,v=t.part2_3_length,h.assign(t),lt.arraycopy(i,0,u,0,576),a=(s=v-32)-o,l=(s+o)/2):(a=s-(o=l+32),l=(s+o)/2,0!=d&&(d=2,t.assign(h),lt.arraycopy(u,0,i,0,576))),12<a;);f.sfb21_extra=w,2==d&&lt.arraycopy(h.l3_enc,0,t.l3_enc,0,576),mt(t.part2_3_length<=c)},this.get_framebits=function(r,t){var n=r.internal_flags;n.bitrate_index=n.VBR_min_bitrate;var i=E.getframebits(r);n.bitrate_index=1,i=E.getframebits(r);for(var e=1;e<=n.VBR_max_bitrate;e++){n.bitrate_index=e;var o=new MeanBits(i);t[e]=_.ResvFrameBegin(r,o),i=o.bits}},this.VBR_old_prepare=function(r,t,n,i,e,o,s,a,f){var h,u=r.internal_flags,c=0,v=1,l=0;u.bitrate_index=u.VBR_max_bitrate;var d=_.ResvFrameBegin(r,new MeanBits(0))/u.mode_gr;get_framebits(r,o);for(var w=0;w<u.mode_gr;w++){var M=b.on_pe(r,t,a[w],d,w,0);u.mode_ext==yr.MPG_MD_MS_LR&&(ms_convert(u.l3_side,w),b.reduce_side(a[w],n[w],d,M));for(var E=0;E<u.channels_out;++E){var m=u.l3_side.tt[w][E];m.block_type!=yr.SHORT_TYPE?(c=1.28/(1+Math.exp(3.5-t[w][E]/300))-.05,h=u.PSY.mask_adjust-c):(c=2.56/(1+Math.exp(3.5-t[w][E]/300))-.14,h=u.PSY.mask_adjust_short-c),u.masking_lower=Math.pow(10,.1*h),init_outer_loop(u,m),f[w][E]=b.calc_xmin(r,i[w][E],m,e[w][E]),0!=f[w][E]&&(v=0),s[w][E]=126,l+=a[w][E]}}for(var w=0;w<u.mode_gr;w++)for(var E=0;E<u.channels_out;E++)l>o[u.VBR_max_bitrate]&&(a[w][E]*=o[u.VBR_max_bitrate],a[w][E]/=l),s[w][E]>a[w][E]&&(s[w][E]=a[w][E]);return v},this.bitpressure_strategy=function(r,t,n,i){for(var e=0;e<r.mode_gr;e++)for(var o=0;o<r.channels_out;o++){for(var s=r.l3_side.tt[e][o],a=t[e][o],f=0,h=0;h<s.psy_lmax;h++)a[f++]*=1+.029*h*h/yr.SBMAX_l/yr.SBMAX_l;if(s.block_type==yr.SHORT_TYPE)for(var h=s.sfb_smin;h<yr.SBMAX_s;h++)a[f++]*=1+.029*h*h/yr.SBMAX_s/yr.SBMAX_s,a[f++]*=1+.029*h*h/yr.SBMAX_s/yr.SBMAX_s,a[f++]*=1+.029*h*h/yr.SBMAX_s/yr.SBMAX_s;i[e][o]=0|Math.max(n[e][o],.9*i[e][o])}},this.VBR_new_prepare=function(r,t,n,i,e,o){var s,a=r.internal_flags,f=1,h=0,u=0;if(r.free_format){a.bitrate_index=0;var c=new MeanBits(h);s=_.ResvFrameBegin(r,c),h=c.bits,e[0]=s}else{a.bitrate_index=a.VBR_max_bitrate;var c=new MeanBits(h);_.ResvFrameBegin(r,c),h=c.bits,get_framebits(r,e),s=e[a.VBR_max_bitrate]}for(var v=0;v<a.mode_gr;v++){b.on_pe(r,t,o[v],h,v,0),a.mode_ext==yr.MPG_MD_MS_LR&&ms_convert(a.l3_side,v);for(var l=0;l<a.channels_out;++l){var d=a.l3_side.tt[v][l];a.masking_lower=Math.pow(10,.1*a.PSY.mask_adjust),init_outer_loop(a,d),0!=b.calc_xmin(r,n[v][l],d,i[v][l])&&(f=0),u+=o[v][l]}}for(var v=0;v<a.mode_gr;v++)for(var l=0;l<a.channels_out;l++)s<u&&(o[v][l]*=s,o[v][l]/=u);return f},this.calc_target_bits=function(r,t,n,i,e,o){var s,a,f,h,u=r.internal_flags,c=u.l3_side,v=0;u.bitrate_index=u.VBR_max_bitrate;var l=new MeanBits(v);for(o[0]=_.ResvFrameBegin(r,l),v=l.bits,u.bitrate_index=1,v=E.getframebits(r)-8*u.sideinfo_len,e[0]=v/(u.mode_gr*u.channels_out),v=r.VBR_mean_bitrate_kbps*r.framesize*1e3,0!=(1&u.substep_shaping)&&(v*=1.09),v/=r.out_samplerate,v-=8*u.sideinfo_len,v/=u.mode_gr*u.channels_out,(s=.93+.07*(11-r.compression_ratio)/5.5)<.9&&(s=.9),1<s&&(s=1),a=0;a<u.mode_gr;a++){var d=0;for(f=0;f<u.channels_out;f++){if(i[a][f]=int(s*v),700<t[a][f]){var w=int((t[a][f]-700)/1.4),M=c.tt[a][f];i[a][f]=int(s*v),M.block_type==yr.SHORT_TYPE&&w<v/2&&(w=v/2),3*v/2<w?w=3*v/2:w<0&&(w=0),i[a][f]+=w}i[a][f]>LameInternalFlags.MAX_BITS_PER_CHANNEL&&(i[a][f]=LameInternalFlags.MAX_BITS_PER_CHANNEL),d+=i[a][f]}if(d>LameInternalFlags.MAX_BITS_PER_GRANULE)for(f=0;f<u.channels_out;++f)i[a][f]*=LameInternalFlags.MAX_BITS_PER_GRANULE,i[a][f]/=d}if(u.mode_ext==yr.MPG_MD_MS_LR)for(a=0;a<u.mode_gr;a++)b.reduce_side(i[a],n[a],v*u.channels_out,LameInternalFlags.MAX_BITS_PER_GRANULE);for(a=h=0;a<u.mode_gr;a++)for(f=0;f<u.channels_out;f++)i[a][f]>LameInternalFlags.MAX_BITS_PER_CHANNEL&&(i[a][f]=LameInternalFlags.MAX_BITS_PER_CHANNEL),h+=i[a][f];if(h>o[0])for(a=0;a<u.mode_gr;a++)for(f=0;f<u.channels_out;f++)i[a][f]*=o[0],i[a][f]/=h}},gt=h.assert,bt=function(){var f;this.setModules=function(r){f=r},this.ResvFrameBegin=function(r,t){var n,i=r.internal_flags,e=i.l3_side,o=f.getframebits(r);t.bits=(o-8*i.sideinfo_len)/i.mode_gr;var s=2048*i.mode_gr-8;320<r.brate?n=8*int(1e3*r.brate/(r.out_samplerate/1152)/8+.5):(n=11520,r.strict_ISO&&(n=8*int(32e4/(r.out_samplerate/1152)/8+.5))),i.ResvMax=n-o,i.ResvMax>s&&(i.ResvMax=s),(i.ResvMax<0||r.disable_reservoir)&&(i.ResvMax=0);var a=t.bits*i.mode_gr+Math.min(i.ResvSize,i.ResvMax);return n<a&&(a=n),gt(0==i.ResvMax%8),gt(0<=i.ResvMax),e.resvDrain_pre=0,null!=i.pinfo&&(i.pinfo.mean_bits=t.bits/2,i.pinfo.resvsize=i.ResvSize),a},this.ResvMaxBits=function(r,t,n,i){var e,o=r.internal_flags,s=o.ResvSize,a=o.ResvMax;0!=i&&(s+=t),0!=(1&o.substep_shaping)&&(a*=.9),n.bits=t,9*a<10*s?(e=s-9*a/10,n.bits+=e,o.substep_shaping|=128):(e=0,o.substep_shaping&=127,r.disable_reservoir||0!=(1&o.substep_shaping)||(n.bits-=.1*t));var f=s<6*o.ResvMax/10?s:6*o.ResvMax/10;return(f-=e)<0&&(f=0),f},this.ResvAdjust=function(r,t){r.ResvSize-=t.part2_3_length+t.part2_length},this.ResvFrameEnd=function(r,t){var n,i=r.l3_side;r.ResvSize+=t*r.mode_gr;var e=0;i.resvDrain_post=0,(i.resvDrain_pre=0)!=(n=r.ResvSize%8)&&(e+=n),0<(n=r.ResvSize-e-r.ResvMax)&&(e+=n);var o=Math.min(8*i.main_data_begin,e)/8;i.resvDrain_pre+=8*o,e-=8*o,r.ResvSize-=8*o,i.main_data_begin-=o,i.resvDrain_post+=e,r.ResvSize-=e}},pt=function(){this.getLameVersion=function(){return"3.98.4"},this.getLameShortVersion=function(){return"3.98.4"},this.getLameVeryShortVersion=function(){return"LAME3.98r"},this.getPsyVersion=function(){return"0.93"},this.getLameUrl=function(){return"http://www.mp3dev.org/"},this.getLameOsBitness=function(){return"32bits"}},It=h.System,yt=h.VbrMode,At=h.ShortBlock,kt=h.Arrays,Rt=h.new_byte,Tt=h.assert;function Ot(){var s,f,Y;this.setModules=function(r,t,n){s=r,f=t,Y=n};var l=Ot.NUMTOCENTRIES,h=Ot.MAXFRAMESIZE,r=l+4+4+4+4+4,u=r+9+1+1+8+1+1+3+1+1+2+4+2+2,d="Xing",w="Info",i=[0,49345,49537,320,49921,960,640,49729,50689,1728,1920,51009,1280,50625,50305,1088,52225,3264,3456,52545,3840,53185,52865,3648,2560,51905,52097,2880,51457,2496,2176,51265,55297,6336,6528,55617,6912,56257,55937,6720,7680,57025,57217,8e3,56577,7616,7296,56385,5120,54465,54657,5440,55041,6080,5760,54849,53761,4800,4992,54081,4352,53697,53377,4160,61441,12480,12672,61761,13056,62401,62081,12864,13824,63169,63361,14144,62721,13760,13440,62529,15360,64705,64897,15680,65281,16320,16e3,65089,64001,15040,15232,64321,14592,63937,63617,14400,10240,59585,59777,10560,60161,11200,10880,59969,60929,11968,12160,61249,11520,60865,60545,11328,58369,9408,9600,58689,9984,59329,59009,9792,8704,58049,58241,9024,57601,8640,8320,57409,40961,24768,24960,41281,25344,41921,41601,25152,26112,42689,42881,26432,42241,26048,25728,42049,27648,44225,44417,27968,44801,28608,28288,44609,43521,27328,27520,43841,26880,43457,43137,26688,30720,47297,47489,31040,47873,31680,31360,47681,48641,32448,32640,48961,32e3,48577,48257,31808,46081,29888,30080,46401,30464,47041,46721,30272,29184,45761,45953,29504,45313,29120,28800,45121,20480,37057,37249,20800,37633,21440,21120,37441,38401,22208,22400,38721,21760,38337,38017,21568,39937,23744,23936,40257,24320,40897,40577,24128,23040,39617,39809,23360,39169,22976,22656,38977,34817,18624,18816,35137,19200,35777,35457,19008,19968,36545,36737,20288,36097,19904,19584,35905,17408,33985,34177,17728,34561,18368,18048,34369,33281,17088,17280,33601,16640,33217,32897,16448];function M(r,t){var n=255&r[t+0];return n<<=8,n|=255&r[t+1],n<<=8,n|=255&r[t+2],n<<=8,n|=255&r[t+3]}function D(r,t,n){r[t+0]=255&n>>24,r[t+1]=255&n>>16,r[t+2]=255&n>>8,r[t+3]=255&n}function B(r,t,n){r[t+0]=255&n>>8,r[t+1]=255&n}function a(r,t,n){return 255&(r<<t|n&~(-1<<t))}function c(r,t){var n=r.internal_flags;t[0]=a(t[0],8,255),t[1]=a(t[1],3,7),t[1]=a(t[1],1,r.out_samplerate<16e3?0:1),t[1]=a(t[1],1,r.version),t[1]=a(t[1],2,1),t[1]=a(t[1],1,r.error_protection?0:1),t[2]=a(t[2],4,n.bitrate_index),t[2]=a(t[2],2,n.samplerate_index),t[2]=a(t[2],1,0),t[2]=a(t[2],1,r.extension),t[3]=a(t[3],2,r.mode.ordinal()),t[3]=a(t[3],2,n.mode_ext),t[3]=a(t[3],1,r.copyright),t[3]=a(t[3],1,r.original),t[3]=a(t[3],2,r.emphasis),t[0]=255;var i,e,o=241&t[1];i=1==r.version?128:r.out_samplerate<16e3?32:64,r.VBR==yt.vbr_off&&(i=r.brate),e=r.free_format?0:255&16*s.BitrateIndex(i,r.version,r.out_samplerate),1==r.version?t[1]=255&(10|o):t[1]=255&(2|o),o=13&t[2],t[2]=255&(e|o)}function F(r,t){var n=t^r;return t=t>>8^i[255&n]}this.addVbrFrame=function(r){var t=r.internal_flags,n=Tables.bitrate_table[r.version][t.bitrate_index];Tt(null!=t.VBR_seek_table.bag),function(r,t){if(r.nVbrNumFrames++,r.sum+=t,r.seen++,!(r.seen<r.want)&&(r.pos<r.size&&(r.bag[r.pos]=r.sum,r.pos++,r.seen=0),r.pos==r.size)){for(var n=1;n<r.size;n+=2)r.bag[n/2]=r.bag[n];r.want*=2,r.pos/=2}}(t.VBR_seek_table,n)},this.getVbrTag=function(r){var t=new VBRTagData,n=0;t.flags=0;var i,e,o=r[n+1]>>3&1,s=r[n+2]>>2&3,a=r[n+3]>>6&3,f=r[n+2]>>4&15;if(f=Tables.bitrate_table[o][f],r[n+1]>>4==14?t.samprate=Tables.samplerate_table[2][s]:t.samprate=Tables.samplerate_table[o][s],i=r,e=n+=0!=o?3!=a?36:21:3!=a?21:13,!new String(i,e,d.length(),null).equals(d)&&!new String(i,e,w.length(),null).equals(w))return null;n+=4,t.hId=o;var h=t.flags=M(r,n);if(n+=4,0!=(1&h)&&(t.frames=M(r,n),n+=4),0!=(2&h)&&(t.bytes=M(r,n),n+=4),0!=(4&h)){if(null!=t.toc)for(var u=0;u<l;u++)t.toc[u]=r[n+u];n+=l}t.vbrScale=-1,0!=(8&h)&&(t.vbrScale=M(r,n),n+=4),t.headersize=72e3*(o+1)*f/t.samprate;var c=r[(n+=21)+0]<<4;c+=r[n+1]>>4;var v=(15&r[n+1])<<8;return v+=255&r[n+2],(c<0||3e3<c)&&(c=-1),(v<0||3e3<v)&&(v=-1),t.encDelay=c,t.encPadding=v,t},this.InitVbrTag=function(r){var t,n=r.internal_flags;t=1==r.version?128:r.out_samplerate<16e3?32:64,r.VBR==yt.vbr_off&&(t=r.brate);var i=72e3*(r.version+1)*t/r.out_samplerate,e=n.sideinfo_len+u;if((n.VBR_seek_table.TotalFrameSize=i)<e||h<i)r.bWriteVbrTag=!1;else{n.VBR_seek_table.nVbrNumFrames=0,n.VBR_seek_table.nBytesWritten=0,n.VBR_seek_table.sum=0,n.VBR_seek_table.seen=0,n.VBR_seek_table.want=1,n.VBR_seek_table.pos=0,null==n.VBR_seek_table.bag&&(n.VBR_seek_table.bag=new int[400],n.VBR_seek_table.size=400);var o=Rt(h);c(r,o);for(var s=n.VBR_seek_table.TotalFrameSize,a=0;a<s;++a)f.add_dummy_byte(r,255&o[a],1)}},this.updateMusicCRC=function(r,t,n,i){for(var e=0;e<i;++e)r[0]=F(t[n+e],r[0])},this.getLameTagFrame=function(r,t){var n=r.internal_flags;if(!r.bWriteVbrTag)return 0;if(n.Class_ID!=Lame.LAME_ID)return 0;if(n.VBR_seek_table.pos<=0)return 0;if(t.length<n.VBR_seek_table.TotalFrameSize)return n.VBR_seek_table.TotalFrameSize;kt.fill(t,0,n.VBR_seek_table.TotalFrameSize,0),c(r,t);var i=Rt(l);if(r.free_format)for(var e=1;e<l;++e)i[e]=255&255*e/100;else!function(r,t){if(!(r.pos<=0))for(var n=1;n<l;++n){var i,e,o=n/l,s=0|Math.floor(o*r.pos);s>r.pos-1&&(s=r.pos-1),i=r.bag[s],e=r.sum;var a=0|256*i/e;255<a&&(a=255),t[n]=255&a}}(n.VBR_seek_table,i);var o=n.sideinfo_len;r.error_protection&&(o-=2),r.VBR==yt.vbr_off?(t[o++]=255&w.charAt(0),t[o++]=255&w.charAt(1),t[o++]=255&w.charAt(2),t[o++]=255&w.charAt(3)):(t[o++]=255&d.charAt(0),t[o++]=255&d.charAt(1),t[o++]=255&d.charAt(2),t[o++]=255&d.charAt(3)),D(t,o,15),D(t,o+=4,n.VBR_seek_table.nVbrNumFrames),o+=4;var s=n.VBR_seek_table.nBytesWritten+n.VBR_seek_table.TotalFrameSize;D(t,o,0|s),o+=4,It.arraycopy(i,0,t,o,i.length),o+=i.length,r.error_protection&&f.CRC_writeheader(n,t);for(var a=0,e=0;e<o;e++)a=F(t[e],a);return o+=function(r,t,n,i,e){var o,s,a,f=r.internal_flags,h=0,u=r.encoder_delay,c=r.encoder_padding,v=100-10*r.VBR_q-r.quality,l=Y.getLameVeryShortVersion(),d=[1,5,3,2,4,0,3],w=0|(255<r.lowpassfreq/100+.5?255:r.lowpassfreq/100+.5),M=0,E=0,m=r.internal_flags.noise_shaping,_=0,g=0,b=0,p=0,I=0,y=0!=(1&r.exp_nspsytune),A=0!=(2&r.exp_nspsytune),k=!1,R=!1,T=r.internal_flags.nogap_total,O=r.internal_flags.nogap_current,P=r.ATHtype,L=0;switch(r.VBR){case vbr_abr:a=r.VBR_mean_bitrate_kbps;break;case vbr_off:a=r.brate;break;default:a=r.VBR_min_bitrate_kbps}switch(o=r.VBR.ordinal()<d.length?d[r.VBR.ordinal()]:0,s=0+o,f.findReplayGain&&(510<f.RadioGain&&(f.RadioGain=510),f.RadioGain<-510&&(f.RadioGain=-510),E=8192,E|=3072,0<=f.RadioGain?E|=f.RadioGain:(E|=512,E|=-f.RadioGain)),f.findPeakSample&&(M=Math.abs(0|f.PeakSample/32767*Math.pow(2,23)+.5)),-1!=T&&(0<O&&(R=!0),O<T-1&&(k=!0)),L=P+((y?1:0)<<4)+((A?1:0)<<5)+((k?1:0)<<6)+((R?1:0)<<7),v<0&&(v=0),r.mode){case MONO:_=0;break;case STEREO:_=1;break;case DUAL_CHANNEL:_=2;break;case JOINT_STEREO:_=r.force_ms?4:3;break;case NOT_SET:default:_=7}b=r.in_samplerate<=32e3?0:48e3==r.in_samplerate?2:48e3<r.in_samplerate?3:1,(r.short_blocks==At.short_block_forced||r.short_blocks==At.short_block_dispensed||-1==r.lowpassfreq&&-1==r.highpassfreq||r.scale_left<r.scale_right||r.scale_left>r.scale_right||r.disable_reservoir&&r.brate<320||r.noATH||r.ATHonly||0==P||r.in_samplerate<=32e3)&&(g=1),p=m+(_<<2)+(g<<5)+(b<<6),I=f.nMusicCRC,D(n,i+h,v),h+=4;for(var N=0;N<9;N++)n[i+h+N]=255&l.charAt(N);n[i+(h+=9)]=255&s,n[i+ ++h]=255&w,D(n,i+ ++h,M),B(n,i+(h+=4),E),B(n,i+(h+=2),0),n[i+(h+=2)]=255&L,n[i+ ++h]=255<=a?255:255&a,n[i+ ++h]=255&u>>4,n[i+h+1]=255&(u<<4)+(c>>8),n[i+h+2]=255&c,n[i+(h+=3)]=255&p,h++,n[i+h++]=0,B(n,i+h,r.preset),D(n,i+(h+=2),t),B(n,i+(h+=4),I),h+=2;for(var S=0;S<h;S++)e=F(n[i+S],e);return B(n,i+h,e),h+=2}(r,s,t,o,a),n.VBR_seek_table.TotalFrameSize},this.putVbrTag=function(r,t){var n=r.internal_flags;if(n.VBR_seek_table.pos<=0)return-1;if(t.seek(t.length()),0==t.length())return-1;var i=function(r){r.seek(0);var t=Rt(10);return r.readFully(t),new String(t,"ISO-8859-1").startsWith("ID3")?0:((127&t[6])<<21|(127&t[7])<<14|(127&t[8])<<7|127&t[9])+t.length}(t);t.seek(i);var e=Rt(h),o=getLameTagFrame(r,e);return o>e.length?-1:(o<1||t.write(e,0,o),0)}}Ot.NUMTOCENTRIES=100,Ot.MAXFRAMESIZE=2880;var Pt=Ot,Lt=h.new_byte,Nt=h.assert;function St(){this.setModules=function(r,t){}}function Yt(){this.setModules=function(r,t,n){}}function Dt(){}function Bt(){this.setModules=function(r,t){}}function Ft(){this.dataOffset=0,this.dataLen=0,this.channels=0,this.sampleRate=0}function Ct(r){return r.charCodeAt(0)<<24|r.charCodeAt(1)<<16|r.charCodeAt(2)<<8|r.charCodeAt(3)}Lame=ot,Presets=at,GainAnalysis=cr,QuantizePVT=Cr,Quantize=_t,Takehiro=xr,Reservoir=bt,MPEGMode=_,BitStream=Jr,Ft.RIFF=Ct("RIFF"),Ft.WAVE=Ct("WAVE"),Ft.fmt_=Ct("fmt "),Ft.data=Ct("data"),Ft.readHeader=function(r){var t=new Ft,n=r.getUint32(0,!1);if(Ft.RIFF==n&&(r.getUint32(4,!0),Ft.WAVE==r.getUint32(8,!1)&&Ft.fmt_==r.getUint32(12,!1))){var i=r.getUint32(16,!0),e=20;switch(i){case 16:case 18:t.channels=r.getUint16(e+2,!0),t.sampleRate=r.getUint32(e+4,!0);break;default:throw"extended fmt chunk not implemented"}e+=i;for(var o=Ft.data,s=0;o!=n&&(n=r.getUint32(e,!1),s=r.getUint32(e+4,!0),o!=n);)e+=s+8;return t.dataLen=s,t.dataOffset=e+8,t}};var jt=function(i,r,t){3!=arguments.length&&(console.error("WARN: Mp3Encoder(channels, samplerate, kbps) not specified"),i=1,r=44100,t=128);var e=new Lame,n=new St,o=new GainAnalysis,s=new BitStream,a=new Presets,f=new QuantizePVT,h=new Quantize,u=new Pt,c=new pt,v=new Bt,l=new Reservoir,d=new Takehiro,w=new Yt,M=new Dt;e.setModules(o,s,a,f,h,u,c,v,M),s.setModules(o,M,c,u),v.setModules(s,c),a.setModules(e),h.setModules(s,l,f,d),f.setModules(d,l,e.enc.psy),l.setModules(s),d.setModules(f),u.setModules(e,s,c),n.setModules(w,M),w.setModules(c,v,a);var E=e.lame_init();E.num_channels=i,E.in_samplerate=r,E.brate=t,E.mode=MPEGMode.STEREO,E.quality=3,E.bWriteVbrTag=!1,E.disable_reservoir=!0,E.write_id3tag_automatic=!1,e.lame_init_params(E);var m=1152,_=0|1.25*m+7200,g=Lt(_);this.encodeBuffer=function(r,t){1==i&&(t=r),Nt(r.length==t.length),r.length>m&&(m=r.length,g=Lt(_=0|1.25*m+7200));var n=e.lame_encode_buffer(E,r,t,r.length,g,0,_);return new Int8Array(g.subarray(0,n))},this.flush=function(){var r=e.lame_encode_flush(E,g,0,_);return new Int8Array(g.subarray(0,r))}},Gt=function(r,t){if(!(r instanceof t))throw new TypeError("Cannot call a class as a function")},Ut=function(){function i(r,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(r,i.key,i)}}return function(r,t,n){return t&&i(r.prototype,t),n&&i(r,n),r}}(),Xt=function(){function t(r){Gt(this,t),this.config={sampleRate:44100,bitRate:128},Object.assign(this.config,r),this.mp3Encoder=new jt(1,this.config.sampleRate,this.config.bitRate),this.maxSamples=1152,this.samplesMono=null,this.clearBuffer()}return Ut(t,[{key:"clearBuffer",value:function(){this.dataBuffer=[]}},{key:"appendToBuffer",value:function(r){this.dataBuffer.push(new Int8Array(r))}},{key:"floatTo16BitPCM",value:function(r,t){for(var n=0;n<r.length;n++){var i=Math.max(-1,Math.min(1,r[n]));t[n]=i<0?32768*i:32767*i}}},{key:"convertBuffer",value:function(r){var t=new Float32Array(r),n=new Int16Array(r.length);return this.floatTo16BitPCM(t,n),n}},{key:"encode",value:function(r){this.samplesMono=this.convertBuffer(r);for(var t=this.samplesMono.length,n=0;0<=t;n+=this.maxSamples){var i=this.samplesMono.subarray(n,n+this.maxSamples),e=this.mp3Encoder.encodeBuffer(i);this.appendToBuffer(e),t-=this.maxSamples}}},{key:"finish",value:function(){return this.appendToBuffer(this.mp3Encoder.flush()),this.dataBuffer}}]),t}();return function(){function t(r){Gt(this,t),this.config={bitRate:128,startRecordingAt:300},this.activeStream=null,this.context=null,this.microphone=null,this.processor=null,this.startTime=0,Object.assign(this.config,r)}return Ut(t,[{key:"addMicrophoneListener",value:function(r){var t=this;this.activeStream=r,this.timerToStart=setTimeout(function(){delete t.timerToStart},this.config.startRecordingAt),this.microphone=this.context.createMediaStreamSource(r),this.processor=this.context.createScriptProcessor(0,1,1),this.processor.onaudioprocess=function(r){t.timerToStart||t.lameEncoder.encode(r.inputBuffer.getChannelData(0))},this.microphone.connect(this.processor),this.processor.connect(this.context.destination)}},{key:"stop",value:function(){return this.processor&&this.microphone&&(this.microphone.disconnect(),this.processor.disconnect(),this.context&&"closed"!==this.context.state&&this.context.close(),this.processor.onaudioprocess=null,this.activeStream.getAudioTracks().forEach(function(r){return r.stop()})),this}},{key:"start",value:function(){var i=this;return this.context=new AudioContext,this.config.sampleRate=this.context.sampleRate,this.lameEncoder=new Xt(this.config),new Promise(function(t,n){navigator.mediaDevices.getUserMedia({audio:!0}).then(function(r){i.addMicrophoneListener(r),t(r)}).catch(function(r){n(r)})})}},{key:"getMp3",value:function(){var n=this,i=this.lameEncoder.finish();return new Promise(function(r,t){0===i.length?t(new Error("No buffer to send")):(r([i,new Blob(i,{type:"audio/mp3"})]),n.lameEncoder.clearBuffer())})}}]),t}()}()}(t={exports:{}},t.exports),t.exports),n=window;n.AudioContext||(n.AudioContext=n.webkitAudioContext);var o=new n.AudioContext;return function(t){function n(){var r=null!==t&&t.apply(this,arguments)||this;return r.r=null,r.e=null,r.a=new e({bitRate:64}),r.i=!1,r.f=!1,r.t={},r.v=function(){},r.n=function(){},r.typeId=2,r.typeName="mp3",r}return function(r,t){function n(){this.constructor=r}i(r,t),r.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}(n,t),n.prototype.isEnvSupport=function(){return!!(navigator&&navigator.mediaDevices&&navigator.mediaDevices.getUserMedia)},n.prototype.isSupportMsg=function(r){return"object"==typeof r&&"string"==typeof r.downloadurl&&/(\.mp3|\.m4a|\.wav)(\?|$)/.test(r.downloadurl)},n.prototype.initRecord=function(){var r=this;return n.h?Promise.resolve():(n.h=!0,this.a.start().then(function(){r.a.stop()}))},n.prototype.startRecord=function(){var r=this;return this.i=!0,setTimeout(function(){r.i&&r.finishRecord().then(function(){})},6e4),this.a.start().then(function(){})},n.prototype.finishRecord=function(){var e=this;return this.a.stop().getMp3().then(function(r){r[0];var t=r[1];return Promise.all([n.o(t),e.uploadFile(t),Promise.resolve(t.size)])}).then(function(r){var t=r[0],n=r[1],i=r[2];e.r=t,e.t={datasize:i,downloadurl:n,recordmode:e.getTypeId(),voicetime:e.getDuration().toFixed(2)},e.i=!1,e.v()}).catch(function(r){throw e.i=!1,r})},n.prototype.cancelRecord=function(){this.a.stop(),this.i=!1},n.prototype.isRecording=function(){return this.i},n.prototype.onRecordEnd=function(r){this.v=r},n.prototype.getJsonMsg=function(){return this.t},n.prototype.initWithJsonMsg=function(r){var t=this;return this.t=r,n.u(r.downloadurl).then(function(r){t.r=r})},n.prototype.play=function(){this.stop(),this.e=o.createBufferSource(),this.e.buffer=this.r,this.e.loop=!1,this.e.connect(o.destination),this.e.onended=this.n,this.e.start(),this.f=!0},n.prototype.stop=function(){this.e&&this.f&&(this.f=!1,this.e.stop())},n.prototype.isPlaying=function(){return this.f},n.prototype.onPlayEnd=function(r){var t=this;this.n=function(){t.f=!1,r()}},n.prototype.getDuration=function(){return this.r?this.r.duration:0},n.c=function(r){return new Promise(function(t,n){o.decodeAudioData(r,function(r){t(r)},function(r){n(r)})})},n.o=function(r){var s=this;return new Promise(function(i,e){var o=new FileReader;o.onload=function(r){var t=o.result;if(!t){var n=new Error;return n.name="FileReadError",e(n)}i(s.c(t))},o.readAsArrayBuffer(r)})},n.u=function(i){var e=this;return new Promise(function(r,t){var n=new XMLHttpRequest;n.open("GET",i,!0),n.responseType="arraybuffer",n.onload=function(){r(e.c(n.response))},n.onerror=function(){t(new Error("Failed to fetch "+i))},n.send()})},n.h=!1,n}(r.Recorder)}(u)});function l(){return c.isWechat()}return function(e){e.debug=!1,e.isWeixin=function(){return l()};var o,r,t,s,n,i,a=function(){function r(r,t,n){var i=this;this.rr=null,this.tr=null,this.nr=[],this.socketio=new f.WildEmitter,u.registerRecorder([c,v]),wx&&c.setWXObject(wx),h.setDirtyWords(r),this.newInstance=new f({appKey:t,useMessageType:[h,u]}),this.ir=n,this.newInstance.on("account.login",function(){n.onLogin&&n.onLogin(0,{code:0,message:"ok",data:{userid:i.newInstance.getMyUserId()}})}),this.newInstance.on("account.logout",function(){n.onLogout&&n.onLogout(0,{code:0,message:"ok",data:{userid:i.newInstance.getMyUserId()}})}),this.newInstance.on("account.kickoff",function(){n.onKickOff&&n.onKickOff()}),this.newInstance.on("account.error:UsernameOrTokenError",function(){n.onLogin&&n.onLogin(o.YIMErrorcode_USERNAME_TOKEN_ERROR,{code:o.YIMErrorcode_USERNAME_TOKEN_ERROR,message:"token",data:{userid:i.newInstance.getMyUserId()}})}),this.newInstance.on("room.join:*",function(r,t){n.onJoinChatRoom&&n.onJoinChatRoom(0,{code:0,message:"ok",data:{roomid:t}})}),this.newInstance.on("room.leave:*",function(r,t){n.onLeaveChatRoom&&n.onLeaveChatRoom(0,{code:0,message:"ok",data:{roomid:t}})}),this.newInstance.on("message:send:*",function(r,t){n.onSendMessageStatus&&n.onSendMessageStatus(0,{code:0,message:"ok",data:{msgid:parseInt(t.serial||"0")}})}),this.newInstance.on("message:send-failed:MessageTooLongError:*",function(){n.onSendMessageStatus&&n.onSendMessageStatus(20007,{code:20007,message:"Message too long.",data:{msgid:0}})}),this.newInstance.on("message:send-failed:NotLoginError:*",function(){n.onSendMessageStatus&&n.onSendMessageStatus(20001,{code:20001,message:"Not login.",data:{msgid:0}})}),this.newInstance.on("message:receive:*",function(r,t){n.onRecvMessage&&n.onRecvMessage({msgType:t.message.getTypeId(),senderid:t.serverId,recvid:t.receiverId,messageid:t.serial||"0",createtime:Math.round(t.time.getTime()/1e3),chattype:"user"===t.chatType?1:2,content:t.message.getContent(),final:!1,history:!1})}),this.newInstance.on("signaling.ready",function(){i.socketio.emit("connect")}),this.newInstance.on("signaling.error",function(r){i.socketio.emit("error",r),i.socketio.emit("connect_error",r)}),this.newInstance.on("signaling.send:*",function(r,t){i.socketio.emit("send","yim",JSON.stringify(t),t)}),this.newInstance.on("signaling.receive:*",function(r,t){i.socketio.emit("message",{target:i.newInstance,data:t}),i.socketio.emit("yim",t)}),this.newInstance.on("signaling.status:ended",function(){i.socketio.emit("close",{target:i.newInstance}),i.socketio.emit("disconnect",{target:i.newInstance})}),this.newInstance.on("*",function(r){e.debug&&console.log("[yim] "+r,arguments)})}return r.prototype.ready=function(r){this.newInstance.on("signaling.ready",r)},r.prototype.login=function(r,t){this.newInstance.login(r,t).catch()},r.prototype.logout=function(){this.newInstance.logout()},r.prototype.joinRoom=function(r){this.newInstance.joinRoom(r).catch()},r.prototype.leaveRoom=function(r){this.newInstance.leaveRoom(r).catch()},r.prototype.sendTextMessage=function(r,t,n){var i=new h(n);2===t?this.newInstance.sendToRoom(r,i).catch():this.newInstance.sendToUser(r,i).catch()},r.prototype.initAudioMedia=function(r,t){var n=l()?"weixin":"webrtc";u.isEnvSupport()?u.initRecorder().then(function(){return t({type:n,support:!0})}).catch(function(){return t({type:n,support:!1})}):t({type:n,support:!1})},r.prototype.getSupportAudioMessage=function(){return u.isEnvSupport()},r.prototype.startAudioMessage=function(r,t,n){var e=this;!this.rr||this.rr.isReady()||this.rr.isCanceled()||this.cancelAudioMessage(),this.rr=new u,this.rr.startRecord().then(function(){return n(0,{errCode:0,errMsg:"ok"})}).catch(function(r){switch(r.name){case"DeviceNotSupportedError":n(o.YIMErrorcode_Fail,{errCode:s.WEBRTC_ERROR,errMsg:""});break;case"NotAllowedError":n(o.YIMErrorcode_Fail,{errCode:s.WEBRTC_ERROR,errMsg:""});break;case"RecorderNotStartedError":n(o.YIMErrorcode_Fail,{errCode:s.INVALID_INVOKE,errMsg:""});break;case"RecorderBusyError":n(o.YIMErrorcode_Fail,{errCode:s.DUPLICATE_INVOKE,errMsg:""});break;case"RecordTooShortError":n(o.YIMErrorcode_Fail,{errCode:s.VOICE_TOOSHORT,errMsg:""})}});var i=function(r){if(r&&e.ir.onVoiceMsgSend){var t=e.rr.getContent(),n=t;try{var i=JSON.parse(t);t=i.downloadurl,n=i.mediaid}catch(r){}e.ir.onVoiceMsgSend(0,{msgID:r.serial||"0",voiceTime:e.rr.getDuration(),voiceURL:t,voiceServerID:n})}};2===t?this.newInstance.sendToRoom(r,this.rr).then(i).catch():this.newInstance.sendToUser(r,this.rr).then(i).catch()},r.prototype.cancelAudioMessage=function(){this.rr&&this.rr.cancelRecord()},r.prototype.stopAudioMessage=function(t){this.rr?this.rr.finishRecord().then(function(){return t(0,{errCode:0,errMsg:"ok"})}).catch(function(r){switch(r.name){case"DeviceNotSupportedError":t(o.YIMErrorcode_Fail,{errCode:s.WEBRTC_ERROR,errMsg:""});break;case"NotAllowedError":t(o.YIMErrorcode_Fail,{errCode:s.WEBRTC_ERROR,errMsg:""});break;case"RecorderNotStartedError":t(o.YIMErrorcode_Fail,{errCode:s.INVALID_INVOKE,errMsg:""});break;case"RecorderBusyError":t(o.YIMErrorcode_Fail,{errCode:s.DUPLICATE_INVOKE,errMsg:""});break;case"RecordTooShortError":t(o.YIMErrorcode_Fail,{errCode:s.VOICE_TOOSHORT,errMsg:""})}}):t(o.YIMErrorcode_Fail,{errCode:s.INVALID_INVOKE,errMsg:""})},r.prototype.playAudioMessage=function(r,t){var n=this;this.tr&&this.tr.isPlaying()&&this.tr.stop();var i="//"===r.substr(0,2)||"http://"===r.substr(0,7)||"https:/"===r.substr(0,7)?{downloadurl:r}:{mediaid:r};this.tr=new u,this.tr.initWithContent(JSON.stringify(i)).then(function(){n.tr.play(),n.tr.once("end-play",function(){t(0,{errCode:0,errMsg:"ok"})})})},r.prototype.stopPlayAudioMessage=function(r,t){this.tr&&this.tr.isPlaying()&&(this.tr.stop(),t(0,{errCode:0,errMsg:"ok"}))},r.prototype.initAutoPlayVoiceQueue=function(r){var t=this;u.bindAutoPlayEvent("next",function(){t.nr.unshift()}),u.bindAutoPlayEvent("begin-play",function(){r.beginPlay(t.nr[0])}),u.bindAutoPlayEvent("end-play",function(){r.endPlay(t.nr[0])})},r.prototype.addToAutoPlayVoiceQueue=function(r){var t=this;if("object"==typeof r&&r.content){var n=new u;n.initWithContent(r.content).then(function(){t.nr.push(r),u.addToAutoPlayQueue(n)}).catch()}},r.prototype.getHistoryMessage=function(r,t,n,i){var e=this;this.newInstance.requestHistoryMessage(r,t,n,i).then(function(r){r.forEach(function(r){e.newInstance.emit("message:receive:"+r.chatType+":"+r.withPeer,r)})})},r.prototype.keywordsFilter=function(r){return h.filterDirty(r)},r}();e.getInstance=a,(r=o=e.YIMErrorcode||(e.YIMErrorcode={}))[r.YIMErrorcode_Success=0]="YIMErrorcode_Success",r[r.YIMErrorcode_EngineNotInit=1]="YIMErrorcode_EngineNotInit",r[r.YIMErrorcode_NotLogin=2]="YIMErrorcode_NotLogin",r[r.YIMErrorcode_ParamInvalid=3]="YIMErrorcode_ParamInvalid",r[r.YIMErrorcode_TimeOut=4]="YIMErrorcode_TimeOut",r[r.YIMErrorcode_StatusError=5]="YIMErrorcode_StatusError",r[r.YIMErrorcode_SDKInvalid=6]="YIMErrorcode_SDKInvalid",r[r.YIMErrorcode_AlreadyLogin=7]="YIMErrorcode_AlreadyLogin",r[r.YIMErrorcode_LoginInvalid=8]="YIMErrorcode_LoginInvalid",r[r.YIMErrorcode_ServerError=9]="YIMErrorcode_ServerError",r[r.YIMErrorcode_NetError=10]="YIMErrorcode_NetError",r[r.YIMErrorcode_LoginSessionError=11]="YIMErrorcode_LoginSessionError",r[r.YIMErrorcode_NotStartUp=12]="YIMErrorcode_NotStartUp",r[r.YIMErrorcode_FileNotExist=13]="YIMErrorcode_FileNotExist",r[r.YIMErrorcode_SendFileError=14]="YIMErrorcode_SendFileError",r[r.YIMErrorcode_UploadFailed=15]="YIMErrorcode_UploadFailed",r[r.YIMErrorcode_UsernamePasswordError=16]="YIMErrorcode_UsernamePasswordError",r[r.YIMErrorcode_UserStatusError=17]="YIMErrorcode_UserStatusError",r[r.YIMErrorcode_MessageTooLong=18]="YIMErrorcode_MessageTooLong",r[r.YIMErrorcode_ReceiverTooLong=19]="YIMErrorcode_ReceiverTooLong",r[r.YIMErrorcode_InvalidChatType=20]="YIMErrorcode_InvalidChatType",r[r.YIMErrorcode_InvalidReceiver=21]="YIMErrorcode_InvalidReceiver",r[r.YIMErrorcode_UnknowError=22]="YIMErrorcode_UnknowError",r[r.YIMErrorcode_InvalidAppkey=23]="YIMErrorcode_InvalidAppkey",r[r.YIMErrorcode_ForbiddenSpeak=24]="YIMErrorcode_ForbiddenSpeak",r[r.YIMErrorcode_CreateFileFailed=25]="YIMErrorcode_CreateFileFailed",r[r.YIMErrorcode_UnsupportFormat=26]="YIMErrorcode_UnsupportFormat",r[r.YIMErrorcode_ReceiverEmpty=27]="YIMErrorcode_ReceiverEmpty",r[r.YIMErrorcode_RoomIDTooLong=28]="YIMErrorcode_RoomIDTooLong",r[r.YIMErrorcode_ContentInvalid=29]="YIMErrorcode_ContentInvalid",r[r.YIMErrorcode_NoLocationAuthrize=30]="YIMErrorcode_NoLocationAuthrize",r[r.YIMErrorcode_UnknowLocation=31]="YIMErrorcode_UnknowLocation",r[r.YIMErrorcode_Unsupport=32]="YIMErrorcode_Unsupport",r[r.YIMErrorcode_NoAudioDevice=33]="YIMErrorcode_NoAudioDevice",r[r.YIMErrorcode_AudioDriver=34]="YIMErrorcode_AudioDriver",r[r.YIMErrorcode_DeviceStatusInvalid=35]="YIMErrorcode_DeviceStatusInvalid",r[r.YIMErrorcode_ResolveFileError=36]="YIMErrorcode_ResolveFileError",r[r.YIMErrorcode_ReadWriteFileError=37]="YIMErrorcode_ReadWriteFileError",r[r.YIMErrorcode_NoLangCode=38]="YIMErrorcode_NoLangCode",r[r.YIMErrorcode_TranslateUnable=39]="YIMErrorcode_TranslateUnable",r[r.YIMErrorcode_PTT_Start=40]="YIMErrorcode_PTT_Start",r[r.YIMErrorcode_PTT_Fail=41]="YIMErrorcode_PTT_Fail",r[r.YIMErrorcode_PTT_DownloadFail=42]="YIMErrorcode_PTT_DownloadFail",r[r.YIMErrorcode_PTT_GetUploadTokenFail=43]="YIMErrorcode_PTT_GetUploadTokenFail",r[r.YIMErrorcode_PTT_UploadFail=44]="YIMErrorcode_PTT_UploadFail",r[r.YIMErrorcode_PTT_NotSpeech=45]="YIMErrorcode_PTT_NotSpeech",r[r.YIMErrorcode_PTT_DeviceStatusError=46]="YIMErrorcode_PTT_DeviceStatusError",r[r.YIMErrorcode_PTT_IsSpeeching=47]="YIMErrorcode_PTT_IsSpeeching",r[r.YIMErrorcode_PTT_FileNotExist=48]="YIMErrorcode_PTT_FileNotExist",r[r.YIMErrorcode_PTT_ReachMaxDuration=49]="YIMErrorcode_PTT_ReachMaxDuration",r[r.YIMErrorcode_PTT_SpeechTooShort=50]="YIMErrorcode_PTT_SpeechTooShort",r[r.YIMErrorcode_PTT_StartAudioRecordFailed=51]="YIMErrorcode_PTT_StartAudioRecordFailed",r[r.YIMErrorcode_PTT_SpeechTimeout=52]="YIMErrorcode_PTT_SpeechTimeout",r[r.YIMErrorcode_PTT_IsPlaying=53]="YIMErrorcode_PTT_IsPlaying",r[r.YIMErrorcode_PTT_NotStartPlay=54]="YIMErrorcode_PTT_NotStartPlay",r[r.YIMErrorcode_PTT_CancelPlay=55]="YIMErrorcode_PTT_CancelPlay",r[r.YIMErrorcode_PTT_NotStartRecord=56]="YIMErrorcode_PTT_NotStartRecord",r[r.YIMErrorcode_Fail=57]="YIMErrorcode_Fail",r[r.YIMErrorcode_NOTLOGIN=58]="YIMErrorcode_NOTLOGIN",r[r.YIMErrorcode_INVALID_PARAM=59]="YIMErrorcode_INVALID_PARAM",r[r.YIMErrorcode_INVALID_LOGIN=60]="YIMErrorcode_INVALID_LOGIN",r[r.YIMErrorcode_USERNAME_TOKEN_ERROR=61]="YIMErrorcode_USERNAME_TOKEN_ERROR",r[r.YIMErrorcode_LOGIN_TIMEOUT=62]="YIMErrorcode_LOGIN_TIMEOUT",r[r.YIMErrorcode_SERVICE_OVERLOAD=63]="YIMErrorcode_SERVICE_OVERLOAD",r[r.YIMErrorcode_MSG_TOO_LONG=64]="YIMErrorcode_MSG_TOO_LONG",(t=e.MessageBodyType||(e.MessageBodyType={}))[t.MessageBodyType_Text=0]="MessageBodyType_Text",t[t.MessageBodyType_Voice=1]="MessageBodyType_Voice",t[t.WEIXIN=2]="WEIXIN",(n=s=e.YIMAudioCode||(e.YIMAudioCode={}))[n.INVOKE_TOOFAST=9001]="INVOKE_TOOFAST",n[n.WAITFOR_LASTINVOKE=9002]="WAITFOR_LASTINVOKE",n[n.INVALID_INVOKE=9003]="INVALID_INVOKE",n[n.DUPLICATE_INVOKE=9004]="DUPLICATE_INVOKE",n[n.INVOKE_OUTTIME=9005]="INVOKE_OUTTIME",n[n.VOICE_TOOSHORT=9006]="VOICE_TOOSHORT",n[n.WEBRTC_ERROR=9089]="WEBRTC_ERROR",n[n.INVOKE_ERROR=9090]="INVOKE_ERROR",(i=e.MessageVoiceType||(e.MessageVoiceType={}))[i.WEIXIN=1]="WEIXIN",i[i.WEBRTC=2]="WEBRTC"}(t||(t={})),t});
